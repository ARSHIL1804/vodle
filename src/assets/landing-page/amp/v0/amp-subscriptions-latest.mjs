;
(self.AMP=self.AMP||[]).push({m:1,v:"2203281422000",n:"amp-subscriptions",ev:"0.1",l:!0,f:function(t,s){(()=>{function s(t,s){(null==s||s>t.length)&&(s=t.length);for(var i=0,e=new Array(s);i<s;i++)e[i]=t[i];return e}function i(t,i){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=function(t,i){if(t){if("string"==typeof t)return s(t,i);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?s(t,i):void 0}}(t))||i&&t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var e;function n(){return e||(e=Promise.resolve(void 0))}var r=class{constructor(){this.promise=new Promise(((t,s)=>{this.resolve=t,this.reject=s}))}},{hasOwnProperty:o,toString:h}=Object.prototype;function c(t){const s=Object.create(null);return t&&Object.assign(s,t),s}function u(t,s){return o.call(t,s)}function a(t,s){if("."==s)return t;let e=t;for(var n,r=i(s.split("."),!0);!(n=r()).done;){const t=n.value;if(!(t&&e&&void 0!==e[t]&&"object"==typeof e&&u(e,t))){e=void 0;break}e=e[t]}return e}var{isArray:l}=Array;function f(t){return JSON.parse(t)}function d(t,s){try{return f(t)}catch(t){return null==s||s(t),null}}function p(t,s,i,e,n,r,o,h,c,u,a){return t}function m(t){return(t.ownerDocument||t).defaultView}function g(t,s,i){return function(t,s){for(const i in s)t.setAttribute(i,s[i]);return t}(t.createElement(s),i)}var b=self.AMP_CONFIG||{},_=("string"==typeof b.thirdPartyFrameRegex?new RegExp(b.thirdPartyFrameRegex):b.thirdPartyFrameRegex)||/^d-\d+\.ampproject\.net$/,A=("string"==typeof b.cdnProxyRegex?new RegExp(b.cdnProxyRegex):b.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function P(t){if(!self.document||!self.document.head)return null;if(self.location&&A.test(self.location.origin))return null;const s=self.document.head.querySelector(`meta[name="${t}"]`);return s&&s.getAttribute("content")||null}var y={thirdParty:b.thirdPartyUrl||"https://3p.ampproject.net",thirdPartyFrameHost:b.thirdPartyFrameHost||"ampproject.net",thirdPartyFrameRegex:_,cdn:b.cdnUrl||P("runtime-host")||"https://cdn.ampproject.org",cdnProxyRegex:A,localhostRegex:/^https?:\/\/localhost(:\d+)?$/,errorReporting:b.errorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r",betaErrorReporting:b.betaErrorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r-beta",localDev:b.localDev||!1,trustedViewerHosts:[/(^|\.)google\.(com?|[a-z]{2}|com?\.[a-z]{2}|cat)$/,/(^|\.)gmail\.(com|dev)$/],geoApi:b.geoApiUrl||P("amp-geo-api")},v=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function w(t,s=""){try{return decodeURIComponent(t)}catch(t){return s}}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var E=self.__AMP_LOG;function R(t,s){throw new Error("failed to call initLogConstructor")}function I(t){return E.user||(E.user=T()),function(t,s){return s&&s.ownerDocument.defaultView!=t}(E.user.win,t)?E.userForEmbed||(E.userForEmbed=T()):E.user}function T(t){return R()}function S(){return E.dev||(E.dev=R())}function k(t,s,i,e,n,r,o,h,c,u,a){return t}function M(t,s,i,e,n,r,o,h,c,u,a){return I().assert(t,s,i,e,n,r,o,h,c,u,a)}function V(t,s){return U(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),s)}function x(t,s){return U(L(C(t)),s)}function O(t,s){return function(t,s){const i=D(t,s);if(i)return i;const e=N(t);return e[s]=function(){const t=new r,{promise:s,reject:i,resolve:e}=t;return s.catch((()=>{})),{obj:null,promise:s,resolve:e,reject:i,context:null,ctor:null}}(),e[s].promise}(L(t),s)}function j(t,s){return D(L(t),s)}function C(t){return t.nodeType?(s=m(t),V(s,"ampdoc")).getAmpDoc(t):t;var s}function L(t){const s=C(t);return s.isSingleDoc()?s.win:s}function U(t,s){k($(t,s));const i=N(t)[s];return i.obj||(k(i.ctor),k(i.context),i.obj=new i.ctor(i.context),k(i.obj),i.context=null,i.resolve&&i.resolve(i.obj)),i.obj}function D(t,s){const i=N(t)[s];return i?i.promise?i.promise:(U(t,s),i.promise=Promise.resolve(i.obj)):null}function N(t){let s=t.__AMP_SERVICES;return s||(s=t.__AMP_SERVICES={}),s}function $(t,s){const i=t.__AMP_SERVICES&&t.__AMP_SERVICES[s];return!(!i||!i.ctor)}var F=t=>function(t,s,i,e){const n=j(t,s);if(n)return n;const r=C(t);return r.whenExtensionsKnown().then((()=>{const t=r.getExtensionVersion(i);return t?V(r.win,"extensions").waitForExtension(i,t):null})).then((i=>i?e?j(t,s):O(t,s):null))}(t,"amp-analytics-instrumentation","amp-analytics"),z=t=>U(t,"timer"),K=t=>function(t,s){const i=L(C(t));return $(i,s)?U(i,s):null}(t,"url-replace"),G=t=>x(t,"viewer"),B=t=>x(t,"viewport");function W(t){const s=function(t){return t.readyState}(t);return"loading"!=s&&"uninitialized"!=s}var J=class{constructor(t,s){let i,e,n;const r=t.indexOf(":");-1!=r?(e=t,i=e.substring(0,r),n=e.substring(r+1)):(i=t,e=null,n=null),this.publicationId_=i,this.productId_=e,this.label_=n,this.locked_=s}getPublicationId(){return this.publicationId_}getProductId(){return this.productId_}getLabel(){return this.label_}isLocked(){return this.locked_}};function H(t){console.log.apply(console,arguments)}function Y(t,s){let i=t;do{if(i.nextSibling)return!0}while((i=i.parentNode)&&i!=s);return!1}function Q(t){const s=Object.getOwnPropertyDescriptor(t,"message");if(s&&s.writable)return t;const{message:i,stack:e}=t,n=new Error(i);for(const s in t)n[s]=t[s];return n.stack=e,n}function Z(t){let s=null,i="";for(let t=0;t<arguments.length;t++){const e=arguments[t];e instanceof Error&&!s?s=Q(e):(i&&(i+=" "),i+=e)}return s?i&&(s.message=i+": "+s.message):s=new Error(i),s}var X=class{constructor(t=""){this.suffix_=t}prepareError_(t){this.suffix_&&(t.message?-1===t.message.indexOf(this.suffix_)&&(t.message=this.suffix_):t.message=this.suffix_)}createError(t){const s=Z.apply(null,Array.prototype.slice.call(arguments));return this.prepareError_(s),s}createExpectedError(t){const s=Z.apply(null,Array.prototype.slice.call(arguments));return this.prepareError_(s),s.expected=!0,s}error(t){throw this.createError.apply(this,arguments)}expectedError(t){throw this.createExpectedError.apply(this,arguments)}},q=new X(self.__AMP_TOP?"​​​":"");new X;var tt="__SWG-SEEN__",st=["CreativeWork","Article","NewsArticle","Blog","Comment","Course","HowTo","Message","Review","WebPage"],it=new RegExp(st.join("|")),et=class{constructor(){}checkValue(t,s){return!!t&&this.checkArray(this.toArray_(t),s)}checkString(t,s){return!!t&&this.checkArray(t.split(/\s+/),s)}checkArray(t,s){for(var e,n=i(t,!0);!(e=n()).done;){const t=e.value.replace(/^http:\/\/schema.org\//i,"");if(s.includes(t))return!0}return!1}toArray_(t){return Array.isArray(t)?t:[t]}};function nt(t,s){const i=t.querySelector(`meta[name="${s}"]`);return i?i.getAttribute("content"):null}function rt(t,s,i){return s in t?Object.defineProperty(t,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[s]=i,t}function ot(t,s){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);s&&(e=e.filter((function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),i.push.apply(i,e)}return i}function ht(t){for(var s=1;s<arguments.length;s++){var i=null!=arguments[s]?arguments[s]:{};s%2?ot(Object(i),!0).forEach((function(s){rt(t,s,i[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ot(Object(i)).forEach((function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))}))}return t}var ct="subscriptions-action",ut="started",at={IS_READY_TO_PAY:"isReadyToPay",SUPPORTS_VIEWER:"supportsViewer"},lt={};function ft(t){if("undefined"!=typeof TextDecoder)return new TextDecoder("utf-8").decode(t);const s=function(t){const s=new Array(t.length);for(let i=0;i<t.length;i++)s[i]=String.fromCharCode(t[i]);return s.join("")}(new Uint8Array(t.buffer||t));return decodeURIComponent(escape(s))}function dt(t){const s=new Uint8Array(t.length);for(let i=0;i<t.length;i++){const e=t.charCodeAt(i);p(e<=255),s[i]=e}return s}function pt(t){return"function"==typeof t.then?t:new Promise(((s,i)=>{t.oncomplete=i=>{s(t.result)},t.onerror=i}))}function mt(t){const s=atob(t),i=s.length,e=new Uint8Array(i);for(let t=0;t<i;t++)e[t]=s.charCodeAt(t);return e}var gt,bt=["Webkit","webkit","Moz","moz","ms","O","o"];function _t(t){const s=t.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()));return bt.some((t=>s.startsWith(t+"-")))?`-${s}`:s}function At(t,s,i){if(s.startsWith("--"))return s;gt||(gt=c());let e=gt[s];if(!e||i){if(e=s,void 0===t[s]){const i=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(s),n=function(t,s){for(let i=0;i<bt.length;i++){const e=bt[i]+s;if(void 0!==t[e])return e}return""}(t,i);void 0!==t[n]&&(e=n)}i||(gt[s]=e)}return e}function Pt(t,s){const{style:i}=t;for(const t in s)i.setProperty(_t(At(i,t)),String(s[t]),"important")}function yt(t,s){void 0===s&&(s=t.hasAttribute("hidden")),s?t.removeAttribute("hidden"):t.setAttribute("hidden","")}var vt,wt,Et="SUBSCRIBER",Rt="METERING",It="UNLOCKED",Tt=class{static empty(t){return new Tt({source:"",raw:"",service:t,granted:!1})}constructor(t){const{dataObject:s,decryptedDocumentKey:i,grantReason:e="",granted:n=!1,raw:r="",service:o,source:h}=t;this.raw=r,this.source=h,this.service=o,this.granted=n,this.grantReason=e,this.data=s,this.decryptedDocumentKey=i}json(){return{"source":this.source,"service":this.service,"granted":this.granted,"grantReason":this.grantReason,"data":this.data}}jsonForPingback(){return ht({"raw":this.raw},this.json())}static parseFromJson(t,s=null){t||(t={});const i=s||JSON.stringify(t),e=t.source||"",n=t.granted||!1,r=t.grantReason,o=t.data||null,h=t.decryptedDocumentKey||null;return new Tt({source:e,raw:i,service:"",granted:n,grantReason:r,dataObject:o,decryptedDocumentKey:h})}isSubscriber(){return this.granted&&this.grantReason===Et}isFree(){return this.granted&&this.grantReason===It}},St=new Set(["c","v","a","ad"]),kt=t=>"string"==typeof t?Vt(t):t;function Mt(t){return t.origin||Vt(t.location.href).origin}function Vt(t,s){return vt||(vt=self.document.createElement("a")),function(t,s,i){return t.href="",new URL(s,t.href)}(vt,t)}function xt(t,s,i,e){return function(t,s,i){if(!s)return t;const e=t.split("#",2),n=e[0].split("?",2);let r=n[0]+(n[1]?i?`?${s}&${n[1]}`:`?${n[1]}&${s}`:`?${s}`);return r+=e[1]?`#${e[1]}`:"",r}(t,function(t,s){return`${encodeURIComponent(t)}=${encodeURIComponent(s)}`}(s,i),e)}function Ot(t,s,i="source"){var e;return M(null!=t,"%s %s must be available",s,i),M("https:"==(e=kt(e=t)).protocol||"localhost"==e.hostname||"127.0.0.1"==e.hostname||function(t,s){const i=t.length-s.length;return i>=0&&t.indexOf(s,i)==i}(e.hostname,".localhost")||/^\/\//.test(t),'%s %s must start with "https://" or "//" or be relative and served from either https or from localhost. Invalid value: %s',s,i,t),t}function jt(t,s,i,e){let n=t,r=i,o=t=>{try{return r(t)}catch(t){var s,i;throw null===(s=(i=self).__AMP_REPORT_ERROR)||void 0===s||s.call(i,t),t}};const h=function(){if(void 0!==wt)return wt;wt=!1;try{const t={get capture(){return wt=!0,!1}};self.addEventListener("test-options",null,t),self.removeEventListener("test-options",null,t)}catch(t){}return wt}(),c=!(null==e||!e.capture);return n.addEventListener(s,o,h?e:c),()=>{null==n||n.removeEventListener(s,o,h?e:c),r=null,n=null,o=null}}function Ct(t){return t.data}function Lt(t,s,i,e){let n;try{n=t.open(s,i,e)}catch(t){S().error("DOM","Failed to open url on target: ",i,t)}var r,o;return!n&&"_top"!=i&&("number"!=typeof o&&(o=0),o+"noopener".length>(r=e||"").length||-1===r.indexOf("noopener",o))&&(n=t.open(s,"_top")),n}var Ut=new RegExp("RETURN_URL");function Dt(t,s){return function(t,s){const i=G(t);return parseInt(t.getParam("dialog"),10)?new Nt(i,s):new $t(t.win,i,s)}(t,s).open()}var Nt=class{constructor(t,s){this.viewer=t,this.urlOrPromise=s}getLoginUrl(){let t;return t="string"==typeof this.urlOrPromise?Promise.resolve(this.urlOrPromise):this.urlOrPromise,t.then((t=>Ft(t,"RETURN_URL")))}open(){return this.getLoginUrl().then((t=>this.viewer.sendMessageAwaitResponse("openDialog",{"url":t})))}},$t=class{constructor(t,s,i){this.win=t,this.viewer=s,this.urlOrPromise=i,this.Xs=null,this.kr=null,this.d_t=null,this.__t=null,this.m_t=null,this.A_t=null}open(){return M(!this.Xs,"Dialog already opened"),new Promise(((t,s)=>{this.Xs=t,this.kr=s,this.v_t()})).then((t=>(this.yn(),t)),(t=>{throw this.yn(),t}))}yn(){if(this.Xs=null,this.kr=null,this.d_t){try{this.d_t.close()}catch(t){}this.d_t=null}this.m_t&&(this.win.clearInterval(this.m_t),this.m_t=null),this.A_t&&(this.A_t(),this.A_t=null)}getLoginUrl(){let t;return t="string"==typeof this.urlOrPromise?Promise.resolve(this.urlOrPromise):this.urlOrPromise,t.then((t=>Ft(t,this.P_t())))}v_t(){const{screen:t}=this.win,s=Math.floor(Math.min(700,.9*t.width)),i=Math.floor(Math.min(450,.9*t.height)),e=`height=${i},width=${s},left=${Math.floor((t.width-s)/2)},top=${Math.floor((t.height-i)/2)},resizable=yes,scrollbars=yes`,r=this.P_t();if(this.__t=null,"string"==typeof this.urlOrPromise){const t=Ft(this.urlOrPromise,r);this.d_t=Lt(this.win,t,"_blank",e),this.d_t&&(this.__t=n())}else this.d_t=Lt(this.win,"","_blank",e),this.d_t&&(this.__t=this.urlOrPromise.then((t=>{const s=Ft(t,r);this.d_t.location.replace(s)}),(t=>{throw new Error("failed to resolve url: "+t)})));this.__t?this.__t.then((()=>{this.g_t(r)}),(t=>{this.b_t(null,t)})):this.b_t(null,new Error("failed to open dialog"))}g_t(t){const s=Vt(t).origin;this.m_t=this.win.setInterval((()=>{this.d_t.closed&&(this.win.clearInterval(this.m_t),this.m_t=null,this.win.setTimeout((()=>{this.b_t("")}),3e3))}),500),this.A_t=jt(this.win,"message",(t=>{t.origin==s&&Ct(t)&&"amp"==Ct(t).sentinel&&"result"==Ct(t).type&&(this.d_t&&this.d_t.postMessage({"sentinel":"amp","type":"result-ack"},s),this.b_t(Ct(t).result))}),void 0)}b_t(t,s){this.Xs&&(s?this.kr(s):this.Xs(t),this.yn())}P_t(){const t=this.viewer.getResolvedViewerUrl();let s;return s=`${y.cdn}/v0/amp-login-done-0.1.html`,s+"?url="+encodeURIComponent(t)}};function Ft(t,s){return Ut.test(t)?t.replace(Ut,encodeURIComponent(s)):t+(-1==t.indexOf("?")?"?":"&")+"return="+encodeURIComponent(s)}var zt="local",Kt=function(){var t=function(t,s,i,e){for(i=i||{},e=t.length;e--;i[t[e]]=s);return i},s=[1,3],i=[1,4],e=[1,18],n=[1,19],r=[1,14],o=[1,15],h=[1,16],c=[1,17],u=[1,21],a=[1,22],l=[5,6,7,10],f=[5,6,7,10,15,16,17,18,19,20,21],d=[5,6,7,10,15,16,17,18,19,20,21,25,27],p={trace:function(){},yy:{},NT:{"error":2,"result":3,"search_condition":4,"EOF":5,"OR":6,"AND":7,"NOT":8,"(":9,")":10,"predicate":11,"comparison_predicate":12,"truthy_predicate":13,"scalar_exp":14,"EQ":15,"DEQ":16,"NEQ":17,"LT":18,"LTE":19,"GT":20,"GTE":21,"atom":22,"field_ref":23,"literal":24,"DOT":25,"field_name":26,"[":27,"string":28,"]":29,"NAME":30,"STRING":31,"NUMERIC":32,"TRUE":33,"FALSE":34,"NULL":35,"$accept":0,"$end":1},xT:{2:"error",5:"EOF",6:"OR",7:"AND",8:"NOT",9:"(",10:")",15:"EQ",16:"DEQ",17:"NEQ",18:"LT",19:"LTE",20:"GT",21:"GTE",25:"DOT",27:"[",29:"]",30:"NAME",31:"STRING",32:"NUMERIC",33:"TRUE",34:"FALSE",35:"NULL"},LT:[0,[3,2],[4,3],[4,3],[4,2],[4,3],[4,1],[11,1],[11,1],[12,3],[12,3],[12,3],[12,3],[12,3],[12,3],[12,3],[13,1],[14,1],[14,1],[22,1],[23,3],[23,4],[23,1],[26,1],[28,1],[24,1],[24,1],[24,1],[24,1],[24,1]],performAction:function(t,s,i,e,n,r,o){var h=r.length-1;switch(n){case 1:return r[h-1];case 2:this.$=r[h-2]||r[h];break;case 3:this.$=r[h-2]&&r[h];break;case 4:this.$=!r[h];break;case 5:this.$=r[h-1];break;case 6:case 7:case 8:case 17:case 18:case 19:this.$=r[h];break;case 9:this.$=r[h-2]===r[h];break;case 10:throw new Error('"==" is not allowed, use "="');case 11:this.$=r[h-2]!==r[h];break;case 12:this.$=typeof r[h-2]==typeof r[h]&&r[h-2]<r[h];break;case 13:this.$=typeof r[h-2]==typeof r[h]&&r[h-2]<=r[h];break;case 14:this.$=typeof r[h-2]==typeof r[h]&&r[h-2]>r[h];break;case 15:this.$=typeof r[h-2]==typeof r[h]&&r[h-2]>=r[h];break;case 16:this.$=void 0!==r[h]&&null!==r[h]&&""!==r[h]&&0!==r[h]&&!1!==r[h];break;case 20:this.$="[object Object]"==Object.prototype.toString.call(r[h-2])&&r[h-2].hasOwnProperty(r[h])?r[h-2][r[h]]:null;break;case 21:this.$="[object Object]"==Object.prototype.toString.call(r[h-3])&&r[h-3].hasOwnProperty(r[h-1])?r[h-3][r[h-1]]:null;break;case 22:this.$=void 0!==e[r[h]]?e[r[h]]:null;break;case 23:this.$=t;break;case 24:this.$=t.substring(1,t.length-1);break;case 26:this.$=Number(t);break;case 27:this.$=!0;break;case 28:this.$=!1;break;case 29:this.$=null}},table:[{3:1,4:2,8:s,9:i,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{1:[3]},{5:[1,20],6:u,7:a},{4:23,8:s,9:i,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{4:24,8:s,9:i,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},t(l,[2,6]),t(l,[2,7]),t(l,[2,8]),t(l,[2,16],{15:[1,25],16:[1,26],17:[1,27],18:[1,28],19:[1,29],20:[1,30],21:[1,31]}),t(f,[2,17]),t(f,[2,18],{25:[1,32],27:[1,33]}),t(f,[2,19]),t(d,[2,22]),t(f,[2,25]),t(f,[2,26]),t(f,[2,27]),t(f,[2,28]),t(f,[2,29]),t(d,[2,23]),t([5,6,7,10,15,16,17,18,19,20,21,29],[2,24]),{1:[2,1]},{4:34,8:s,9:i,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{4:35,8:s,9:i,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},t(l,[2,4]),{6:u,7:a,10:[1,36]},{14:37,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{14:38,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{14:39,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{14:40,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{14:41,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{14:42,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{14:43,22:9,23:10,24:11,26:12,28:13,30:e,31:n,32:r,33:o,34:h,35:c},{26:44,30:e},{28:45,31:n},t([5,6,10],[2,2],{7:a}),t(l,[2,3]),t(l,[2,5]),t(l,[2,9]),t(l,[2,10]),t(l,[2,11]),t(l,[2,12]),t(l,[2,13]),t(l,[2,14]),t(l,[2,15]),t(d,[2,20]),{29:[1,46]},t(d,[2,21])],defaultActions:{20:[2,1]},parseError:function(t,s){if(!s.recoverable){var i=new Error(t);throw i.hash=s,i}this.trace(t)},parse:function(t){var s=this,i=[0],e=[null],n=[],r=this.table,o="",h=0,c=0,u=0,a=2,l=1,f=n.slice.call(arguments,1),d=Object.create(this.lexer),p={yy:{}};for(var m in this.yy)Object.prototype.hasOwnProperty.call(this.yy,m)&&(p.yy[m]=this.yy[m]);d.setInput(t,p.yy),p.yy.lexer=d,p.yy.parser=this,void 0===d.yylloc&&(d.yylloc={});var g=d.yylloc;n.push(g);var b=d.options&&d.options.ranges;"function"==typeof p.yy.parseError?this.parseError=p.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var _,A,P,y,v,w,E,R,I,T=function(){var t;return"number"!=typeof(t=d.lex()||l)&&(t=s.NT[t]||t),t},S={};;){if(P=i[i.length-1],this.defaultActions[P]?y=this.defaultActions[P]:(null==_&&(_=T()),y=r[P]&&r[P][_]),void 0===y||!y.length||!y[0]){var k="";for(w in I=[],r[P])this.xT[w]&&w>a&&I.push("'"+this.xT[w]+"'");k=d.showPosition?"Parse error on line "+(h+1)+":\n"+d.showPosition()+"\nExpecting "+I.join(", ")+", got '"+(this.xT[_]||_)+"'":"Parse error on line "+(h+1)+": Unexpected "+(_==l?"end of input":"'"+(this.xT[_]||_)+"'"),this.parseError(k,{text:d.match,token:this.xT[_]||_,line:d.yylineno,loc:g,expected:I})}if(y[0]instanceof Array&&y.length>1)throw new Error("Parse Error: multiple actions possible at state: "+P+", token: "+_);switch(y[0]){case 1:i.push(_),e.push(d.yytext),n.push(d.yylloc),i.push(y[1]),_=null,A?(_=A,A=null):(c=d.yyleng,o=d.yytext,h=d.yylineno,g=d.yylloc,u>0&&u--);break;case 2:if(E=this.LT[y[1]][1],S.$=e[e.length-E],S._$={first_line:n[n.length-(E||1)].first_line,last_line:n[n.length-1].last_line,first_column:n[n.length-(E||1)].first_column,last_column:n[n.length-1].last_column},b&&(S._$.range=[n[n.length-(E||1)].range[0],n[n.length-1].range[1]]),void 0!==(v=this.performAction.apply(S,[o,c,h,p.yy,y[1],e,n].concat(f))))return v;E&&(i=i.slice(0,-1*E*2),e=e.slice(0,-1*E),n=n.slice(0,-1*E)),i.push(this.LT[y[1]][0]),e.push(S.$),n.push(S._$),R=r[i[i.length-2]][i[i.length-1]],i.push(R);break;case 3:return!0}}return!0}},m={EOF:1,parseError:function(t,s){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,s)},setInput:function(t,s){return this.yy=s||this.yy||{},this._input=t,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];return this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t,t.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var s=t.length,i=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-s),this.offset-=s;var e=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var n=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===e.length?this.yylloc.first_column:0)+e[e.length-i.length].length-i[0].length:this.yylloc.first_column-s},this.options.ranges&&(this.yylloc.range=[n[0],n[0]+this.yyleng-s]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),s=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+s+"^"},test_match:function(t,s){var i,e,n;if(this.options.backtrack_lexer&&(n={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(n.yylloc.range=this.yylloc.range.slice(0))),(e=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=e.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:e?e[e.length-1].length-e[e.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],i=this.performAction.call(this,this.yy,this,s,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),i)return i;if(this._backtrack){for(var r in n)this[r]=n[r];return!1}return!1},next:function(){if(this.done)return this.EOF;var t,s,i,e;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var n=this._currentRules(),r=0;r<n.length;r++)if((i=this._input.match(this.rules[n[r]]))&&(!s||i[0].length>s[0].length)){if(s=i,e=r,this.options.backtrack_lexer){if(!1!==(t=this.test_match(i,n[r])))return t;if(this._backtrack){s=!1;continue}return!1}if(!this.options.flex)break}return s?!1!==(t=this.test_match(s,n[e]))&&t:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){return this.next()||this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return(t=this.conditionStack.length-1-Math.abs(t||0))>=0?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(t,s,i,e){switch(i){case 0:break;case 1:return 7;case 2:return 6;case 3:return 8;case 4:return 35;case 5:case 6:return 33;case 7:case 8:return 34;case 9:return 9;case 10:return 10;case 11:return 27;case 12:return 29;case 13:return"|";case 14:return 19;case 15:return 18;case 16:return 21;case 17:return 20;case 18:return 17;case 19:return 16;case 20:return 15;case 21:return 32;case 22:return 30;case 23:case 24:return 31;case 25:return 25;case 26:return"INVALID";case 27:return 5}},rules:[/^(?:\s+)/,/^(?:AND\b)/,/^(?:OR\b)/,/^(?:NOT\b)/,/^(?:NULL\b)/,/^(?:TRUE\b)/,/^(?:true\b)/,/^(?:FALSE\b)/,/^(?:false\b)/,/^(?:\()/,/^(?:\))/,/^(?:\[)/,/^(?:\])/,/^(?:\|)/,/^(?:<=)/,/^(?:<)/,/^(?:>=)/,/^(?:>)/,/^(?:!=)/,/^(?:==)/,/^(?:=)/,/^(?:-?[0-9]+(\.[0-9]+)?\b)/,/^(?:[a-zA-Z_][a-zA-Z0-9_]*)/,/^(?:'[^\']*')/,/^(?:"[^\"]*")/,/^(?:\.)/,/^(?:.)/,/^(?:$)/],conditions:{"INITIAL":{"rules":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27],"inclusive":!0}}};function g(){this.yy={}}return p.lexer=m,g.prototype=p,p.Parser=g,new g}(),Gt=Kt;function Bt(t,s){return function(t,s){try{return Gt.yy=s,!!Gt.parse(t)}finally{Gt.yy=null}}(t,s)}var Wt="_AMP_SUBSCRIPTIONS_CLICK_HANDLED",Jt=class{constructor(t,s,i){this.Ci=t,this.Ec=t.getRootNode(),this.w1=s,this.Ugt=!!this.w1.pingbackAllEntitlements,this.t1=i,this.i1=new class{constructor(t,s){const i=t.getHeadNode();this.PP=K(i),this.o1=s,this.a1=null}setAuthResponse(t){this.a1=t}buildUrl(t,s){return this.h1(s).then((s=>this.PP.expandUrlAsync(t,s)))}collectUrlVars(t,s){return this.h1(s).then((s=>this.PP.collectVars(t,s)))}h1(t){return this.o1.then((s=>{const i={"READER_ID":s,"ACCESS_READER_ID":s};return t&&(i.AUTHDATA=t=>{if(this.a1)return a(this.a1,t)}),i}))}}(this.Ci,this.t1.getReaderId("local")),this.s1=i.getAnalytics(),M(this.w1.actions,"Actions have not been defined in the service config"),this.A_=new class{constructor(t,s,i,e){for(const t in e)Ot(e[t],`action ${t}`);this.Kgt=e,this.Ggt={},this.i1=s,this.oU=i,this.Bgt=null,this.Wgt=0,this.Jgt=Dt.bind(null,t),this.build()}build(){if(0==Object.keys(this.Kgt).length)return null;const t=[];for(const s in this.Kgt)t.push(this.i1.buildUrl(this.Kgt[s],!0).then((t=>{this.Ggt[s]=t})));return Promise.all(t).then((()=>this.Ggt))}execute(t){M(this.Kgt[t],"Action URL is not configured: %s",t);const s=M(this.Ggt[t],"Action URL is not ready: %s",t);return this.os(s,t)}os(t,s){const i=Date.now();if(this.Bgt&&i-this.Wgt<1e3)return this.Bgt;this.oU.actionEvent(zt,s,ut);const e=this.Jgt(t).then((t=>{this.Bgt=null;const i=function(t){const s=c();if(!t)return s;let i;for(;i=v.exec(t);){const t=w(i[1],i[1]),e=i[2]?w(i[2].replace(/\+/g," "),i[2]):"";s[t]=e}return s}(t).success,e="true"==i||"yes"==i||"1"==i;return e?this.oU.actionEvent(zt,s,"success"):this.oU.actionEvent(zt,s,"rejected"),e||!i})).catch((t=>{throw this.oU.actionEvent(zt,s,"failed"),this.Bgt==e&&(this.Bgt=null),t}));return this.Bgt=e,this.Wgt=i,this.Bgt}}(this.Ci,this.i1,this.s1,this.validateActionMap(this.w1.actions)),this.md=new class{constructor(t,s,i){this.Ci=t,this.Ec=t.getRootNode(),this.d_t=s,this.tg=x(t,"templates"),this.t1=i}render(t){return Promise.all([this.Ygt(t),this.Qgt(t)])}reset(){return this.d_t.close(),this.Zgt({},this.Ec,(()=>!1))}Ygt(t){this.Zgt(t,this.Ec,Bt)}Qgt(t){return this.Ci.whenReady().then((()=>{const s=this.Ci.getRootNode().querySelectorAll("[subscriptions-dialog][subscriptions-display]");for(let i=0;i<s.length;i++){const e=s[i],n=e.getAttribute("subscriptions-display");if(n&&Bt(n,t))return e}})).then((s=>{if(!s)return;if("TEMPLATE"==s.tagName)return this.tg.renderTemplate(s,t).then((s=>{const i=t;return this.Zgt(i,s,Bt)}));const i=s.cloneNode(!0);return i.removeAttribute("subscriptions-dialog"),i.removeAttribute("subscriptions-display"),i})).then((t=>{if(t)return this.d_t.open(t,!0)}))}Zgt(t,s,i){return this.Ci.whenReady().then((()=>{const e=s.querySelectorAll('[subscriptions-action], [subscriptions-section="actions"], [subscriptions-actions]');for(let s=0;s<e.length;s++){const n=e[s],r=n.getAttribute("subscriptions-display");r&&i(r,t)?(n.classList.add("i-amphtml-subs-display"),n.getAttribute("subscriptions-service")&&n.getAttribute("subscriptions-action")&&"false"!==n.getAttribute("subscriptions-decorate")&&!n.hasAttribute("i-amphtml-subs-decorated")&&(this.t1.decorateServiceAction(n,n.getAttribute("subscriptions-service"),n.getAttribute("subscriptions-action"),null),n.setAttribute("i-amphtml-subs-decorated",!0))):n.classList.remove("i-amphtml-subs-display")}return s}))}}(this.Ci,i.getDialog(),this.t1)}getPlatformKey(){return"local"}validateActionMap(t){return M(t.login,'Action "login" is not present in action map'),M(t.subscribe,'Action "subscribe" is not present in action map'),t}eJ(){const t=t=>{if(t[Wt])return;t[Wt]=!0;const s=function(t,s){return t.closest?t.closest("[subscriptions-action]"):function(t,s,i){let e;for(e=t;e&&void 0!==e;e=e.parentElement)if(s(e))return e;return null}(t,(t=>function(t,s){const i=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector;return!!i&&i.call(t,"[subscriptions-action]")}(t)))}(t.target);this.Nc(s)};this.Ec.addEventListener("click",t),this.Ec.body&&this.Ec.body.addEventListener("click",t)}Nc(t){if(t){const s=t.getAttribute("subscriptions-action"),i=t.getAttribute("subscriptions-service");if("local"==i)this.executeAction(s,t.id);else if("auto"==(i||"auto"))if("login"==s){const i=this.t1.selectPlatformForLogin();this.t1.delegateActionToService(s,i.getPlatformKey(),t.id)}else this.executeAction(s,t.id);else i&&this.t1.delegateActionToService(s,i,t.id)}}activate(t){this.Xgt(t).then((t=>{this.md.render(t)}))}Xgt(t){const s=t.json();return this.t1.getScoreFactorStates().then((t=>(s.factors=t,this.i1.setAuthResponse(s)))).then((()=>this.A_.build())).then((()=>s))}reset(){this.md.reset()}executeAction(t){return this.A_.execute(t).then((t=>(t&&this.t1.resetPlatforms(),!!t)))}isPrerenderSafe(){return!1}getSupportedScoreFactor(t){return 0}getBaseScore(){return this.w1.baseScore||0}getEntitlements(){}pingback(t){}pingbackReturnsAllEntitlements(){return this.Ugt}isPingbackEnabled(){return!1}decorateUI(t,s,i){}},Ht="__AMP__",Yt=class extends Jt{constructor(t,s,i){super(t,s,i),k("iframe"==this.w1.type),this.Xw=M(this.w1.iframeSrc,'"iframeSrc" URL must be specified'),Ot(this.Xw,"iframe Url"),this.X_t=this.w1.iframeVars||null,this.X_t&&M(l(this.X_t),'"iframeVars" must be an array'),this.Tv=Vt(this.Xw).origin,this.tAt=null,this.iAt=null,this.Mv=t.win.document.createElement("iframe"),yt(this.Mv,!1),this.sAt=new class{constructor(t,s,i){this.i=t,this.eAt=s,this.Tv=i,this.o=null,this.nAt=null,this.rAt=this.yw.bind(this),this.oAt=0,this.hAt={}}connect(t){if(this.nAt)throw new Error("already connected");this.nAt=t,this.i.addEventListener("message",this.rAt)}disconnect(){this.nAt&&(this.nAt=null,this.i.removeEventListener("message",this.rAt))}isConnected(){return null!=this.Tv}getTarget(){const t=this.cAt();if(!t)throw new Error("not connected");return t}cAt(){return this.nAt&&!this.o&&("function"==typeof this.eAt?this.o=this.eAt():this.o=this.eAt),this.o}getTargetOrigin(){if(null==this.Tv)throw new Error("not connected");return this.Tv}sendCommand(t,s){this.rb(void 0,t,s)}sendCommandRsvp(t,s){const i=String(++this.oAt);let e=null;const n=new Promise((t=>{e=t}));return this.hAt[i]={promise:n,resolver:e},this.rb(i,t,s),n}rb(t,s,i){const e=this.getTarget(),n="connect"==s?null!=this.Tv?this.Tv:"*":this.getTargetOrigin();e.postMessage({"sentinel":Ht,"_rsvp":t,"cmd":s,"payload":i||null},n)}yw(t){const s=t,{data:i}=s;if(!i||i.sentinel!=Ht)return;const e=s.origin,n=i.cmd,r=i.payload||null;if(null==this.Tv&&"start"==n&&(this.Tv=e),null==this.Tv&&s.source&&this.cAt()==s.source&&(this.Tv=e),e!=this.Tv)return;const o=i._rsvp,h=!!o&&"rsvp"!=n,c=this.uAt(o,n,r);h&&Promise.resolve(c).then((t=>{this.rb(o,"rsvp",{"result":t})}),(t=>{this.rb(o,"rsvp",{"error":String(t)})}))}uAt(t,s,i){if("rsvp"!=s)return this.nAt(s,i);{const s=t&&this.hAt[t];s&&("error"in i?s.resolver(Promise.reject(new Error(i.error))):s.resolver(i.result),delete this.hAt[t])}}}(this.Ci.win,(()=>this.Mv.contentWindow),this.Tv),this.qb=null,this.eJ()}getEntitlements(){return this.connect().then((()=>this.sAt.sendCommandRsvp("authorize",{}).then((t=>(t.source="local-iframe",t))).then((t=>Tt.parseFromJson(t)))))}isPingbackEnabled(){return!0}pingback(t){return this.connect().then((()=>this.sAt.sendCommandRsvp("pingback",{entitlement:t})))}connect(){if(!this.iAt){const t=new r;this.iAt=t.promise,this.tAt=t.resolve,this.qb=this.pAt(),this.sAt.connect(this.uAt.bind(this)),this.Ci.getBody().appendChild(this.Mv),this.Mv.src=this.Xw}return this.iAt}pAt(){return new Promise((t=>{const s=f(JSON.stringify(this.w1)),i=this.t1.getPageConfig();if(s.pageConfig={publicationId:i.getPublicationId(),productId:i.getProductId(),encryptedDocumentKey:this.t1.getEncryptedDocumentKey("local")||null},this.X_t){const i=this.X_t.join("&");this.i1.collectUrlVars(i,!1).then((i=>{s.iframeVars=i,t(s)}))}else t(s)}))}uAt(t,s){"connect"===t&&this.qb.then((t=>{this.sAt.sendCommandRsvp("start",{"protocol":"amp-subscriptions","config":t}).then((()=>{this.tAt&&(this.tAt(),this.tAt=null)}))}))}},Qt=class extends Jt{constructor(t,s,i){super(t,s,i),this.Cdt=Ot(M(this.w1.authorizationUrl,"Service config does not have authorization Url"),"Authorization Url"),this.eR=V(this.Ci.win,"xhr"),this.Ldt=this.w1.pingbackUrl||null,this.eJ()}getEntitlements(){const t=this.i1.buildUrl(this.Cdt,!1),s=this.t1.loadMeteringState();return Promise.all([t,s]).then((t=>{let s=t[0];const i=t[1];i&&(s=xt(s,"meteringState",btoa(JSON.stringify(i))));const e=this.t1.getEncryptedDocumentKey("local");return e&&(s=xt(s,"crypt",e)),this.eR.fetchJson(s,{credentials:"include"}).then((t=>t.json())).then((t=>{const s=[];return t.metering&&t.metering.state&&s.push(this.t1.saveMeteringState(t.metering.state)),Promise.all(s).then((()=>Tt.parseFromJson(t)))}))}))}isPingbackEnabled(){return!!this.Ldt}qgt(t){if(l(t)){const s=[];return t.forEach((t=>{s.push(t.jsonForPingback())})),JSON.stringify(s)}return JSON.stringify(t.jsonForPingback())}pingback(t){if(!this.isPingbackEnabled)return;const s=k(this.Ldt);return this.i1.buildUrl(s,!0).then((s=>this.eR.sendSignal(s,{method:"POST",credentials:"include",headers:{"Content-Type":"text/plain"},body:this.qgt(t)})))}};function Zt(t,s,i){return"iframe"===s.type?new Yt(t,s,i):new Qt(t,s,i)}var Xt=class{constructor(){this.Tt=null}add(t){return this.Tt||(this.Tt=[]),this.Tt.push(t),()=>{this.remove(t)}}remove(t){this.Tt&&function(t,s){const i=t.indexOf(s);-1!=i&&t.splice(i,1)}(this.Tt,t)}removeAll(){this.Tt&&(this.Tt.length=0)}fire(t){if(this.Tt)for(var s,e=i(this.Tt.slice(),!0);!(s=e()).done;)(0,s.value)(t)}getHandlerCount(){var t,s;return null!==(t=null===(s=this.Tt)||void 0===s?void 0:s.length)&&void 0!==t?t:0}},qt=class{constructor(t,s,i,e,n){this.sbt=e||{},this.ibt=t,this.ebt={},this.nbt={},t.forEach((t=>{this.nbt[t]=new r})),this.rbt=new Xt,this.obt=new Xt,this.hbt=null,this.cbt=null,this.ubt=null,this.abt=null,this.lbt=[],this.fbt=i,this.dbt=Object.assign(lt,s),this.pbt=n||new Xt}resolvePlatform(t,s){this.sbt[t]=s,this.obt.fire({platformKey:t})}resetPlatformStore(){for(const t in this.sbt)this.sbt[t].reset();return new qt(this.ibt,this.dbt,this.fbt,this.sbt,this.pbt)}resetPlatform(t){delete this.ebt[t],this.nbt[t]=new r,this.sbt[t].reset(),this.hbt=null,this.cbt=null,this.ubt=null,this.abt=null}onPlatformResolves(t,s){const i=this.sbt[t];i?s(i):this.obt.add((i=>{i.platformKey===t&&s(this.getPlatform(t))}))}getPlatform(t){const s=this.sbt[t];return k(s),s}mbt(){return this.getPlatform("local")}getAvailablePlatforms(){const t=[];for(const s in this.sbt){const i=this.sbt[s];t.push(i)}return t}onChange(t){this.rbt.add(t)}addOnEntitlementResolvedCallback(t){this.pbt.add(t)}resolveEntitlement(t,s){s&&(s.service=t),this.ebt[t]=s;const i=this.nbt[t];i&&i.resolve(s),-1!==this.lbt.indexOf(t)&&this.lbt.splice(this.lbt.indexOf(t),1),s.granted&&this.gbt(s),this.rbt.fire({platformKey:t,entitlement:s}),this.pbt.fire({platformKey:t,entitlement:s})}getResolvedEntitlementFor(t){return k(this.ebt[t]),this.ebt[t]}getEntitlementPromiseFor(t){return k(this.nbt[t]),this.nbt[t].promise}getScoreFactorStates(){const t={};return Promise.all(this.ibt.map((s=>(t[s]={},Promise.all(Object.values(at).map((i=>this.bbt(s,i).then((e=>{t[s][i]=e}))))))))).then((()=>t))}bbt(t,s){return this.getEntitlementPromiseFor(t).then((()=>this.sbt[t].getSupportedScoreFactor(s)))}getGrantStatus(){if(null!==this.hbt)return this.hbt.promise;this.hbt=new r;for(const t in this.ebt){const s=this.ebt[t];s.granted&&(this.gbt(s),this.hbt.resolve(!0))}return this._bt()?this.hbt.resolve(!1):this.onChange((t=>{const{entitlement:s}=t;s.granted?this.hbt.resolve(!0):this._bt()&&this.hbt.resolve(!1)})),this.hbt.promise}gbt(t){(!this.cbt&&t.granted||this.cbt&&!this.cbt.isSubscriber()&&t.isSubscriber())&&(this.cbt=t)}getGrantEntitlement(){const t=()=>this.cbt&&(this.cbt.isSubscriber()||this.cbt.isFree()),s=()=>t()||this._bt();return this.ubt||(this.ubt=new r,s()?this.ubt.resolve(this.cbt):this.rbt.add((()=>{s()&&this.ubt.resolve(this.cbt)}))),this.ubt.promise}reset(){this.hbt=null}getAllPlatformsEntitlements(){return this.abt||(this.abt=new r,this._bt()?this.abt.resolve(this.Abt()):this.onChange((()=>{this._bt()&&this.abt.resolve(this.Abt())}))),this.abt.promise}Abt(){const t=[];for(const s in this.ebt)u(this.ebt,s)&&t.push(this.ebt[s]);return t}selectPlatform(){return this.getAllPlatformsEntitlements().then((()=>this.Pbt()))}_bt(){return Object.keys(this.ebt).length===this.ibt.length}ybt(t,s){const i=s.getSupportedScoreFactor(t);return"number"!=typeof i?0:this.dbt[t]*Math.min(1,Math.max(-1,i))}Pbt(){k(this._bt());const t=this.getAvailablePlatforms();for(;t.length;){const s=t.pop(),i=this.getResolvedEntitlementFor(s.getPlatformKey());if(i.isSubscriber()||i.isFree())return s}return this.vbt(this.wbt())}wbt(){return this.getAvailablePlatforms().map((t=>({platform:t,weight:this.Ebt(t)})))}Ebt(t){const s=[0],i=t.getBaseScore();for(const i in this.dbt)u(this.dbt,i)&&s.push(this.ybt(i,t));return i+s.reduce(((t,s)=>t+s))}vbt(t){const s=this.mbt();return t.sort(((t,i)=>i.weight===t.weight&&t.platform===s?-1:i.weight-t.weight)),t[0].platform}Rbt(t){const s=this.getAvailablePlatforms().map((s=>{const i=s.getSupportedScoreFactor(t);return{platform:s,weight:"number"==typeof i?i:0}}));return this.vbt(s)}reportPlatformFailureAndFallback(t){if(t===this.mbt().getPlatformKey()&&this.fbt)this.resolveEntitlement(this.mbt().getPlatformKey(),this.fbt);else if(-1===this.lbt.indexOf(t)){const s=Tt.empty(t);this.resolveEntitlement(t,s),this.lbt.push(t)}}selectPlatformForLogin(){return this.Rbt(at.SUPPORTS_VIEWER)}},ts="i-amphtml-subs",ss={"-":"+","_":"/",".":"="};function is(t){return dt(atob(t.replace(/[-_.]/g,(t=>ss[t]))))}function es(t,s,i){if(s[i])return s[i];const e=t.querySelector(`style[${i}], link[${i}]`);return e?(s[i]=e,e):null}function ns(t,s){const i=t.styleSheets;for(let t=0;t<i.length;t++)if(i[t].ownerNode==s)return!0;return!1}var rs=self.__AMP_ERRORS||[];self.__AMP_ERRORS=rs;var os="amp-subscriptions";t.registerServiceForDoc("subscriptions",(function(t){return new class{constructor(t){const s=t.getElementById(os);this.Ci=t,function(t,s,i,e,n){const r=t.getHeadNode(),o=function(t,s,i,e){let n=t.__AMP_CSS_SM;n||(n=t.__AMP_CSS_SM=c());const r=`amp-extension=${e}`;if(r){const i=es(t,n,r);if(i)return"STYLE"==i.tagName&&i.textContent!==s&&(i.textContent=s),i}const o=(t.ownerDocument||t).createElement("style");o.textContent=s;let h=null;return o.setAttribute("amp-extension",e),h=es(t,n,"amp-runtime"),function(t,s,i=null){if(!i)return void function(t,s){t.insertBefore(s,t.firstChild)}(t,s);const e=i.nextSibling;t.insertBefore(s,e)}(t,o,h),r&&(n[r]=o),o}(r,function(t,s){const i=t.__AMP_CSS_TR;return i?i(s):s}(r,'[subscriptions-action]:not(.i-amphtml-subs-display),[subscriptions-actions]:not(.i-amphtml-subs-display),[subscriptions-section=actions]:not(.i-amphtml-subs-display),body.i-amphtml-subs-delegated [subscriptions-section=actions],body.i-amphtml-subs-grant-unk [subscriptions-action],body.i-amphtml-subs-grant-unk [subscriptions-section=actions],body:not(.i-amphtml-subs-grant-no) [subscriptions-section=content-not-granted],body:not(.i-amphtml-subs-grant-yes) [subscriptions-section=content],body:not(.i-amphtml-subs-loading) [subscriptions-section=loading]{display:none!important}amp-subscriptions-dialog{display:block!important;position:fixed!important;bottom:0!important;left:0!important;margin-left:0!important;width:100%!important;z-index:2147483641!important;max-height:90vh;box-sizing:border-box;opacity:1;background-image:none;background-color:#fff;box-shadow:0 0 5px 0 rgba(0,0,0,0.2);margin-bottom:0;transition:transform 0.3s ease-in}.i-amphtml-subs-dialog-close-button{position:absolute;width:28px;height:28px;top:-28px;right:0;background-image:url(\'data:image/svg+xml;charset=utf-8,<svg width="13" height="13" viewBox="341 8 13 13" xmlns="http://www.w3.org/2000/svg"><path fill="%234F4F4F" d="M354 9.31 352.69 8l-5.19 5.19L342.31 8 341 9.31l5.19 5.19-5.19 5.19 1.31 1.31 5.19-5.19 5.19 5.19 1.31-1.31-5.19-5.19z" fill-rule="evenodd"/></svg>\');background-size:13px 13px;background-position:9px;background-color:#fff;background-repeat:no-repeat;box-shadow:0 -1px 1px 0 rgba(0,0,0,0.2);border:none;border-radius:12px 0 0 0;cursor:pointer}body:not(.i-amphtml-subs-grant-yes) .i-amphtml-subs-dialog-close-button{display:none}.i-amphtml-subs-progress{height:2px;background-color:#ccc;position:relative;margin:8px;overflow:hidden}.i-amphtml-subs-progress:after{content:"";background-color:#2196f3;height:2px;position:absolute;left:0;top:0;width:20%;animation:i-amphtml-subs-loading-progress 1500ms ease-in-out infinite}@keyframes i-amphtml-subs-loading-progress{0%{transform:translateX(-100%)}to{transform:translateX(500%)}}@media (min-width:480px){amp-subscriptions-dialog{width:480px!important;left:-240px!important;margin-left:50vw!important}}\n/*# sourceURL=/extensions/amp-subscriptions/0.1/amp-subscriptions.css*/'),0,"amp-subscriptions");if(i){const s=t.getRootNode();if(ns(s,o))return o;const i=setInterval((()=>{ns(s,o)&&clearInterval(i)}),4)}}(t,0,(()=>{})),this.Jl=null,this.md=new class{constructor(t){this.Ci=t,this.wn=x(t,"mutator"),this.setGrantState(null),this.Ibt().classList.add(`${ts}-ready`),this.addLoadingBar()}Ibt(){return this.Ci.getBody()}RF(t,s){this.wn.mutateElement(this.Ci.getBody(),(()=>{this.Ibt().classList.toggle(`${ts}-${t}-unk`,null===s),this.Ibt().classList.toggle(`${ts}-${t}-yes`,!0===s),this.Ibt().classList.toggle(`${ts}-${t}-no`,!1===s)}))}addLoadingBar(){return this.Ci.whenReady().then((()=>{const t=this.Ci.getBody();if(!t.querySelector("[subscriptions-section=loading]")){const i=g(this.Ci.win.document,"div",{"class":"i-amphtml-subs-progress","subscriptions-section":"loading"});t.insertBefore(i,(s=t,p(/^[\w-]+$/.test("footer")),"> footer",s.querySelector(function(t,s){return t.replace(/^|,/g,"$&:scope ")}("> footer"))))}var s}))}Tbt(t,s){this.wn.mutateElement(this.Ci.getBody(),(()=>{this.Ibt().classList.toggle(`${ts}-${t}`,s)}))}setGrantState(t){this.RF("grant",t)}toggleLoading(t){this.Tbt("loading",t)}}(t),this.Sbt=null,this.kbt=null,this.Mbt=null,this.Vbt=I().assertElement(s),this.s1=new class{constructor(t){this.yf=t,this.Wf=[]}registerEventListener(t){this.Wf.push(t)}serviceEvent(t,s,i,e){this.event(t,ht({"serviceId":s},i),e)}event(t,s,i){i=i||{};const e=t!==ct?t:t+`-${i.action}-${i.status}`;s=s||{},function(t,s,i={},e=!0){F(t).then((n=>{n&&n.triggerEventForTarget(t,s,i,e)}))}(this.yf,e,s,!1);for(let e=0;e<this.Wf.length;e++)this.Wf[e](t,s,i)}actionEvent(t,s,i,e){this.serviceEvent(ct,t,e,{"action":s,"status":i})}}(this.Vbt),this.t1=new class{constructor(t){this.xbt=t}getAnalytics(){return this.xbt.getAnalytics()}getDialog(){return this.xbt.getDialog()}getEncryptedDocumentKey(t){return this.xbt.getEncryptedDocumentKey(t)}getPageConfig(){return this.xbt.getPageConfig()}getReaderId(t){return this.xbt.getReaderId(t)}getScoreFactorStates(){return this.xbt.getScoreFactorStates()}delegateActionToLocal(t,s){return this.delegateActionToService(t,"local",s)}delegateActionToService(t,s,i){return this.xbt.delegateActionToService(t,s,i)}decorateServiceAction(t,s,i,e){this.xbt.decorateServiceAction(t,s,i,e)}resetPlatforms(){this.xbt.resetPlatforms()}selectPlatformForLogin(){return this.xbt.selectPlatformForLogin()}loadMeteringState(){return this.xbt.Obt?this.xbt.Obt.loadMeteringState():Promise.resolve(null)}saveMeteringState(t){return this.xbt.Obt?this.xbt.Obt.saveMeteringState(t):n()}rememberMeteringEntitlementsWereFetched(){this.xbt.Obt&&(this.xbt.Obt.entitlementsWereFetchedWithCurrentMeteringState=!0)}}(this),this.d_t=new class{constructor(t){this.Ci=t,this.br=V(t.win,"vsync"),this.Ee=z(t.win),this.bn=B(t),this.Ah=!1,this.mz=null,this.jbt=n();const s=this.Ci.win.document;this.$r=g(s,"amp-subscriptions-dialog",{"role":"dialog"}),yt(this.$r,!1),this.fD=g(s,"button",{"class":"i-amphtml-subs-dialog-close-button"}),this.showCloseAction(!1),this.$r.appendChild(this.fD),this.fD.addEventListener("click",(()=>{this.close()})),this.Ci.getBody().appendChild(this.$r),Pt(this.$r,{transform:"translateY(100%)"})}getRoot(){return this.$r}isVisible(){return this.Ah}open(t,s=!0){return this.fc((()=>this.s$(t,s)))}close(){return this.fc((()=>this.u$()))}fc(t){return this.jbt=this.jbt.then(t)}s$(t,s=!0){return this.mz?this.$r.replaceChild(t,this.mz):this.$r.appendChild(t),this.mz=t,this.Ah?n():(this.Ah=!0,this.br.mutatePromise((()=>{yt(this.$r,!0),this.showCloseAction(s)})).then((()=>this.br.mutatePromise((()=>{Pt(this.$r,{transform:"translateY(0)"})})).then((()=>this.Ee.promise(300))))).then((()=>{let t;return this.br.runPromise({measure:()=>{t=this.$r.offsetHeight},mutate:()=>{this.bn.updatePaddingBottom(t),this.bn.addToFixedLayer(this.$r,!0)}})})))}u$(){return this.Ah?this.br.mutatePromise((()=>{Pt(this.$r,{transform:"translateY(100%)"})})).then((()=>this.Ee.promise(300))).then((()=>this.br.mutatePromise((()=>{yt(this.$r,!1),this.bn.updatePaddingBottom(0),this.Ah=!1})))):n()}showCloseAction(t){yt(this.fD,t)}}(t),this.Cbt=new class{constructor(t){this.Ci=t,this.k_t=null,this.Ee=z(t.win),this.bn=B(t)}scheduleView(t){return this.k_t=null,this.Ci.whenReady().then((()=>new Promise((t=>{this.Ci.isVisible()&&t(),this.Ci.onVisibilityChanged((()=>{this.Ci.isVisible()&&t()}))})).then((()=>this.xAt(t)))))}xAt(t){return this.k_t||(this.k_t=this.jAt(t).catch((t=>{throw this.k_t=null,t}))),this.k_t}jAt(t){if(0==t)return n();const s=[];return new Promise(((i,e)=>{s.push(this.Ci.onVisibilityChanged((()=>{this.Ci.isVisible()||e(new Error("CANCELLED"))})));const n=this.Ee.delay(i,t);s.push((()=>this.Ee.cancel(n))),s.push(this.bn.onScroll(i)),s.push(function(t,s,i,e){let n=i;const r=jt(t,"click",(t=>{try{n(t)}finally{n=null,r()}}),void 0);return r}(this.Ci.getRootNode(),0,i))})).then((()=>{s.forEach((t=>t()))}),(t=>{throw s.forEach((t=>t())),t}))}}(t),this.Ue=G(t),this.Lbt=null,this.Ee=z(t.win),this.Ubt=this.Ue.hasCapability("auth"),this.Dbt=this.Ubt&&this.Ue.hasCapability("paywall"),this.y_t=O(t,"cid"),this.Nbt={},this.$bt=new class{constructor(t){this.Ci=t,this.Fbt=null;const s=this.Ci.getRootNode().querySelector("script[cryptokeys]");this.zbt=null,s&&s.hasAttribute("sha-256-hash")&&(this.zbt=s.getAttribute("sha-256-hash")),this.Kbt=s&&d(s.textContent)||null}isDocumentEncrypted(){return!!this.Kbt&&Object.keys(this.Kbt).length>0}getEncryptedKeys(){return this.Kbt}getEncryptedDocumentKey(t){const s=this.getEncryptedKeys();return s&&s[t]||null}tryToDecryptDocument(t){if(!this.zbt)return this.Gbt(t);const s=(i=t,"undefined"!=typeof TextEncoder?(new TextEncoder).encode(i):dt(unescape(encodeURIComponent(i))));var i;return crypto.subtle.digest("SHA-256",s).then((s=>{var i;return((i=new Uint8Array(s))?Array.prototype.slice.call(i):[]).map((t=>function(t,s,i){if(t.length>=s)return t;s-=t.length;let e="0";for(;s>e.length;)e+="0";return e.slice(0,s)+t}(t.toString(16),2))).join("")!=this.zbt?Promise.reject(new Error("Invalid Document Key")):this.Gbt(t)}))}Gbt(t){return this.Fbt||(this.Fbt=this.Ci.whenReady().then((()=>{return(s=mt(t).buffer,pt((self.msCrypto?self.msCrypto.subtle:self.crypto.subtle).importKey("raw",s,"AES-GCM",!0,["decrypt"]))).then((t=>{const s=this.Ci.getRootNode().querySelectorAll("script[ciphertext]"),i=[];return function(t,s){const{length:i}=t;for(let e=0;e<i;e++)s(t[e])}(s,(s=>{const e=mt(s.textContent.replace(/\s+/g,"")).buffer,n=e.slice(0,12),r=e.slice(12);i.push(function(t,s,i){const e=!!self.msCrypto;return pt((e?self.msCrypto.subtle:self.crypto.subtle).decrypt({name:"AES-GCM",iv:s,tag:e?i.slice(i.byteLength-16):void 0,tagLength:128},t,e?i.slice(0,i.byteLength-16):i)).then((t=>function(t){if("undefined"!=typeof TextDecoder)return new TextDecoder("utf-8").decode(t);const s=new Uint8Array(t.buffer||t),i=new Array(s.length);for(let t=0;t<s.length;t++)i[t]=String.fromCharCode(s[t]);const e=i.join("");return decodeURIComponent(escape(e))}(new Uint8Array(t))))}(t,n,r).then((t=>{s.outerHTML=t})))})),Promise.all(i)}));var s}))),this.Fbt}}(t),this.Obt=null}start(){return this.de().then((()=>{if(this.s1.event("subscriptions-started"),this.md.toggleLoading(!0),M(this.Sbt,"Page config is null"),this.Ubt)return this.Bbt(),void this.Wbt(!1);M(this.kbt.services,"Services not configured in service config");const t=this.kbt.services.map((t=>t.serviceId||"local"));this.Jbt(t),this.kbt.services.forEach((t=>{this.Hbt(t)})),this.Mbt.getAvailablePlatforms().forEach((t=>{this.Ybt(t)})),function(t){return t.waitForBodyOpen().then((()=>{const s=t.getBody(),i=(e=s,n=()=>!!s.firstElementChild,new Promise((t=>{!function(t,s,i){if(s(t))i();else{const e=new(m(t).MutationObserver)((()=>{s(t)&&(e.disconnect(),i())}));e.observe(t,{childList:!0})}}(e,n,t)})));var e,n;return z(t.win).timeoutPromise(2e3,i).then((()=>"AMP-STORY"===s.firstElementChild.tagName),(()=>!1))}))}(this.Ci).then((t=>{t&&this.d_t.getRoot().classList.add("i-amphtml-story-subscriptions-dialog-wrapper"),this.Wbt(!t)}))})),this}getAccessReaderId(){return this.de().then((()=>this.getReaderId("local")))}getAnalytics(){return this.s1}getAuthdataField(t){return this.de().then((()=>this.Mbt.getEntitlementPromiseFor("local"))).then((s=>a(s.json(),t)))}getDialog(){return this.d_t}maybeRenderDialogForSelectedPlatform(){return this.de().then((()=>{if(!this.Ubt&&!this.kbt.alwaysGrant)return this.Qbt()}))}getGrantStatus(){return this.Mbt.getGrantStatus()}addOnEntitlementResolvedCallback(t){this.Mbt.addOnEntitlementResolvedCallback(t)}getEncryptedDocumentKey(t){return this.$bt.getEncryptedDocumentKey(t)}getPageConfig(){return k(this.Sbt)}getReaderId(t){let s=this.Nbt[t];if(!s){const i=n(),e="amp-access"+("local"==t?"":"-"+t);s=this.y_t.then((t=>t.get({scope:e,createCookieIfNotPresent:!0},i))),this.Nbt[t]=s}return s}getScoreFactorStates(){return this.Mbt.getScoreFactorStates()}registerPlatform(t,s){return this.de().then((()=>{if(this.Ubt)return;const i=M(this.kbt.services.filter((s=>(s.serviceId||"local")===t))[0],"No matching services for the ID found"),e=s(i,this.t1);this.Mbt.resolvePlatform(e.getPlatformKey(),e),this.s1.serviceEvent("subscriptions-service-registered",e.getPlatformKey()),this.s1.serviceEvent("subscriptions-platform-registered",e.getPlatformKey()),this.Ybt(e)}))}selectPlatformForLogin(){return this.Mbt.selectPlatformForLogin()}de(){if(!this.Jl){const t=new class{constructor(t){this.Ci=t,this.bn=B(this.Ci)}getWin(){return this.Ci.win}getRootNode(){return this.Ci.getRootNode()}getRootElement(){const t=this.Ci.getRootNode();return t.documentElement||t.body||t}getHead(){return this.Ci.getHeadNode()}getBody(){return this.Ci.isBodyAvailable()?this.Ci.getBody():null}isReady(){return this.Ci.isReady()}whenReady(){return this.Ci.whenReady()}addToFixedLayer(t){return this.bn.addToFixedLayer(t,!0)}}(this.Ci),s=new class{constructor(t){var s;this.doc_=9===(s=t).nodeType||s.document?new class{constructor(t){const s=!!t.document;this.win_=s?t:t.defaultView,this.doc_=s?t.document:t}getWin(){return this.win_}getRootNode(){return this.doc_}getRootElement(){return this.doc_.documentElement}getHead(){return this.doc_.head}getBody(){return this.doc_.body}isReady(){return W(this.doc_)}whenReady(){return t=this.doc_,new Promise((s=>{!function(t,s){!function(t,s,i){if(s(t))return void i(t);let e=!1;const n=()=>{s(t)&&!e&&(i(t),e=!0,t.removeEventListener("readystatechange",n))};t.addEventListener("readystatechange",n)}(t,W,s)}(t,s)}));var t}addToFixedLayer(t){return n()}}(s):s,this.configResolver_=null,this.configPromise_=new Promise((t=>{this.configResolver_=t})),this.metaParser_=new class{constructor(t){this.doc_=t}check(){if(!this.doc_.getBody())return null;const t=nt(this.doc_.getRootNode(),"subscriptions-product-id");if(!t)return null;const s=nt(this.doc_.getRootNode(),"subscriptions-accessible-for-free"),i=!(!s||"false"!==s.toLowerCase());return new J(t,i)}}(this.doc_),this.ldParser_=new class{constructor(t){this.doc_=t,this.checkType_=new et}check(){if(!this.doc_.getBody())return null;const t=this.doc_.isReady(),s=this.doc_.getRootNode().querySelectorAll('script[type="application/ld+json"]');for(let i=0;i<s.length;i++){const e=s[i];if(e[tt]||!e.textContent||!t&&!Y(e))continue;if(e[tt]=!0,!it.test(e.textContent))continue;const n=this.tryExtractConfig_(e);if(n)return n}return null}tryExtractConfig_(t){let s=function(t,s){try{return function(t){return JSON.parse(t)}(t)}catch(t){return}}(t.textContent);if(!s)return null;Array.isArray(s)||(s=[s]);let i=s;for(let t=0;t<i.length;t++){const s=i[t];if(s["@graph"]&&Array.isArray(s["@graph"])&&(i=i.concat(s["@graph"])),!this.checkType_.checkValue(s["@type"],st))continue;let e=null;const n=this.valueArray_(s,"isPartOf");if(n)for(let t=0;t<n.length&&(e=this.discoverProductId_(n[t]),!e);t++);if(!e)continue;const r=this.bool_(this.singleValue_(s,"isAccessibleForFree"),!0);return new J(e,!r)}return null}bool_(t,s){if(null==t||""===t)return s;if("boolean"==typeof t)return t;if("string"==typeof t){const s=t.toLowerCase();if("false"==s)return!1;if("true"==s)return!0}return s}discoverProductId_(t){return this.checkType_.checkValue(t["@type"],["Product"])?this.singleValue_(t,"productID"):null}valueArray_(t,s){const i=t[s];return null==i||""===i?null:Array.isArray(i)?i:[i]}singleValue_(t,s){const i=this.valueArray_(t,s),e=i&&i[0];return null==e||""===e?null:e}}(this.doc_),this.microdataParser_=new class{constructor(t){this.doc_=t,this.access_=null,this.productId_=null,this.checkType_=new et}discoverAccess_(t){const s=t.querySelectorAll("[itemprop='isAccessibleForFree']");for(let i=0;s[i];i++){const e=s[i],n=e.getAttribute("content")||e.textContent;if(n&&this.isValidElement_(e,t,"alreadySeenForAccessInfo")){let t=null;return"true"==n.toLowerCase()?t=!0:"false"==n.toLowerCase()&&(t=!1),t}}return null}isValidElement_(t,s,i){for(let s=t;s&&!s[i];s=s.parentNode)if(s[i]=!0,s.hasAttribute&&s.hasAttribute("itemscope")){const t=s.getAttribute("itemtype");return this.checkType_.checkString(t,st)}return!1}discoverProductId_(t){const s=t.querySelectorAll('[itemprop="productID"]');for(let i=0;s[i];i++){const e=s[i],n=e.getAttribute("content")||e.textContent,r=e.closest("[itemtype][itemscope]");if(!(r.getAttribute("itemtype").indexOf("http://schema.org/Product")<=-1)&&this.isValidElement_(r.parentElement,t,"alreadySeenForProductInfo"))return n}return null}getPageConfig_(){let t=null;return null!=this.access_?t=!this.access_:this.doc_.isReady()&&(t=!1),null!=this.productId_&&null!=t?new J(this.productId_,t):null}tryExtractConfig_(){let t=this.getPageConfig_();if(t)return t;const s=Array.prototype.slice.call(this.doc_.getRootNode().querySelectorAll("[itemscope][itemtype]")).filter((t=>this.checkType_.checkString(t.getAttribute("itemtype"),st)));for(let i=0;s[i]&&null==t;i++){const e=s[i];null==this.access_&&(this.access_=this.discoverAccess_(e)),this.productId_||(this.productId_=this.discoverProductId_(e)),t=this.getPageConfig_()}return t}check(){return this.doc_.getBody()?this.tryExtractConfig_():null}}(this.doc_)}resolveConfig(){return n().then(this.check.bind(this)),this.doc_.whenReady().then(this.check.bind(this)),this.configPromise_}check(){if(!this.configResolver_)return null;let t=this.metaParser_.check();return t||(t=this.ldParser_.check()),t||(t=this.microdataParser_.check()),t?(this.configResolver_(t),this.configResolver_=null):this.doc_.isReady()&&(this.configResolver_(Promise.reject(q.createError("No config could be discovered in the page"))),this.configResolver_=null),function(t){if(/swg.debug=1/.test(self.location.hash)){const t=Array.prototype.slice.call(arguments,0);t.unshift("[Subscriptions]"),H.apply(H,t)}}(t),t}}(t);this.Jl=Promise.all([this.Zbt(),s.resolveConfig()]).then((t=>{this.kbt=t[0],this.Sbt=t[1]})).then((()=>{this.Xbt()}))}return this.Jl}Hbt(t){"local"==(t.serviceId||"local")&&this.Mbt.resolvePlatform("local",Zt(this.Ci,t,this.t1))}Zbt(){return new Promise((t=>{t(d(this.Vbt.textContent,(t=>{throw I().createError('Failed to parse "amp-subscriptions" JSON: ',t)})))}))}qbt(t){this.md.toggleLoading(!1),this.Lbt=this.Cbt.scheduleView(2e3),this.Dbt&&!t||this.md.setGrantState(t)}LAt(t,s){this.Mbt.resolveEntitlement(t,s),s.decryptedDocumentKey&&this.$bt.tryToDecryptDocument(s.decryptedDocumentKey),this.s1.serviceEvent("subscriptions-entitlement-resolved",t)}DAt(t){return t.getEntitlements().then((s=>s&&s.granted&&this.$bt.isDocumentEncrypted()&&!s.decryptedDocumentKey?(("local"==t.getPlatformKey()?I():S()).error(os,`${t.getPlatformKey()}: Subscription granted and encryption enabled, but no decrypted document key returned.`),null):s))}Ybt(t){return this.NAt()?n():(t.isPrerenderSafe()?n():this.Ci.whenFirstVisible()).then((()=>this.Ee.timeoutPromise(3e3,this.DAt(t)).then((s=>(s=s||Tt.empty(t.getPlatformKey()),this.LAt(t.getPlatformKey(),s),s))).catch((s=>{const i=t.getPlatformKey();throw this.Mbt.reportPlatformFailureAndFallback(i),I().createError(`fetch entitlements failed for ${i}`,s)}))))}Jbt(t){const s=this.kbt.fallbackEntitlement?Tt.parseFromJson(this.kbt.fallbackEntitlement):Tt.empty("local");this.Mbt=new qt(t,this.kbt.score,s),this.$At(this.Mbt)}Bbt(){const t=Mt(this.Ci.win);this.Jbt(["local"]),this.kbt.services.forEach((s=>{if("local"==(s.serviceId||"local")){const i=new class{constructor(t,s,i,e){this.Ci=t,this.t1=i,this.Sbt=i.getPageConfig(),this.Kr=Zt(t,s,i),this.Ue=G(this.Ci),this.Ue.onMessage("subscriptionchange",this.FAt.bind(this)),this.e_t=new class{constructor(t){this.win=t,this.n_t=t.crypto&&(t.crypto.subtle||t.crypto.webkitSubtle)||null}decode(t){return this.r_t(t).payload}isVerificationSupported(){return!!this.n_t}decodeAndVerify(t,s){if(!this.n_t)throw new Error("Crypto is not supported on this platform");return new Promise((s=>s(this.r_t(t)))).then((t=>{const i=t.header.alg;if(!i||"RS256"!=i)throw new Error("Only alg=RS256 is supported");return this.o_t(s).then((s=>{const i=is(t.sig);return this.n_t.verify({name:"RSASSA-PKCS1-v1_5"},s,i,dt(t.verifiable))})).then((s=>{if(s)return t.payload;throw new Error("Signature verification failed")}))}))}r_t(t){function s(){throw new Error(`Invalid token: "${t}"`)}const i=t.split(".");3!=i.length&&s();const e=is(i[0]),n=is(i[1]);return{header:d(ft(e),s),payload:d(ft(n),s),verifiable:`${i[0]}.${i[1]}`,sig:i[2]}}o_t(t){return t.then((t=>this.n_t.importKey("spki",function(t){const s=t.trim().replace(/^-+BEGIN[^-]*-+/,"").replace(/-+END[^-]*-+$/,"").replace(/[\r\n]/g,"").trim();return dt(atob(s))}(t),{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"])))}}(t.win),this.KAt=this.Sbt.getPublicationId(),this.GAt=this.Sbt.getProductId(),this.h=e,this.Ee=z(t.win)}isPrerenderSafe(){return!0}getEntitlements(){k(this.GAt);const t={"publicationId":this.KAt,"productId":this.GAt,"origin":this.h};let s;const i=this.Ue.getParam("cryptokeys")||"google.com";if(i){const t=i.split(",");for(let i=0;i!=t.length&&(s=this.t1.getEncryptedDocumentKey(t[i]),!s);i++);}return s&&(t.encryptedDocumentKey=s),this.Ee.timeoutPromise(3e3,this.Ue.sendMessageAwaitResponse("auth",t)).then((t=>{const s=(t=t||{}).error,i=t.authorization,e=t.decryptedDocumentKey;if(s)throw new Error(s.message);return i?this.BAt(i,e).catch((t=>{throw this.WAt(t.message),t})):Tt.empty("local")}))}BAt(t,s){return new Promise((i=>{const e=Mt(this.Ci.win),n=Vt(function(t){if(!function(t){return y.cdnProxyRegex.test(kt(t).origin)}(t=kt(t)))return t.href;const s=t.pathname.split("/"),i=s[1];M(St.has(i),"Unknown path prefix in url %s",t.href);const e=s[2],n="s"==e?"https://"+decodeURIComponent(s[3]):"http://"+decodeURIComponent(e);return M(n.indexOf(".")>0,"Expected a . in origin %s",n),s.splice(1,"s"==e?3:2),n+s.join("/")+function(t,s){if(!t||"?"==t)return"";const i=new RegExp("[?&](amp_(js[^&=]*|gsa|r|kit)|usqp)\\b[^&]*","g"),e=t.replace(i,"").replace(/^[?&]/,"");return e?"?"+e:""}(t.search)+(t.hash||"")}(this.Ci.win.location)).origin,r=this.e_t.decode(t),o=M(this.Sbt.getProductId(),"Product id is null");if(r.aud!=e&&r.aud!=n)throw I().createError(`The mismatching "aud" field: ${r.aud}`);if(r.exp<Math.floor(Date.now()/1e3))throw I().createError("Payload is expired");const h=r.entitlements;let c,u=Tt.empty("local");if(h){if(Array.isArray(h)){for(let t=0;t<h.length;t++)if(-1!==h[t].products.indexOf(o)){c=h[t];break}}else-1!==h.products.indexOf(o)&&(c=h);c&&(u=new Tt({source:"viewer",raw:t,granted:!0,grantReason:c.subscriptionToken?Et:"",dataObject:c,decryptedDocumentKey:s}))}r.metering&&!u.granted&&(u=new Tt({source:r.iss||"",raw:t,granted:!0,grantReason:Rt,dataObject:r.metering,decryptedDocumentKey:s})),u.service="local",i(u)}))}WAt(t){this.Ue.sendMessage("auth-rejected",{"reason":t})}getPlatformKey(){return this.Kr.getPlatformKey()}activate(){}reset(){}isPingbackEnabled(){return this.Kr.isPingbackEnabled()}pingbackReturnsAllEntitlements(){return this.Kr.pingbackReturnsAllEntitlements()}pingback(t){this.Kr.pingback(t)}getSupportedScoreFactor(t){return this.Kr.getSupportedScoreFactor(t)}getBaseScore(){return 0}executeAction(t,s){return this.Kr.executeAction(t,s)}decorateUI(t,s,i){return this.Kr.decorateUI(t,s,i)}FAt(){this.t1.resetPlatforms()}}(this.Ci,s,this.t1,t);this.Mbt.resolvePlatform("local",i),this.DAt(i).then((t=>{k(t),this.LAt("local",t)})).catch((t=>{this.Mbt.reportPlatformFailureAndFallback("local"),S().error(os,"Viewer auth failed:",t)}))}}))}Wbt(t=!0){const s=this.Mbt.getGrantStatus(),i=this.Mbt.getGrantEntitlement();return Promise.all([s,i]).then((s=>{const i=s[0],e=s[1],n=()=>this.JAt({granted:i,shouldActivatePlatform:t});if(!this.Obt)return void n();const r=this.Mbt.getPlatform(this.Obt.platformKey);if(i){if(!e||e.grantReason!==Rt||e.service!==this.Obt.platformKey)return void n();const t=()=>{this.JAt({granted:!0,shouldActivatePlatform:!1})};r.activate(e,e,t)}else this.Obt.entitlementsWereFetchedWithCurrentMeteringState?n():this.Obt.loadMeteringState().then((t=>{if(t)this.resetPlatform(this.Obt.platformKey);else{const t=Tt.empty("local"),s=()=>this.Wbt();r.activate(t,t,s)}}))}))}JAt({granted:t,shouldActivatePlatform:s}){this.qbt(t),this.HAt(),s&&this.Qbt()}Qbt(){return Promise.all([this.Mbt.getGrantStatus(),this.Mbt.selectPlatform(),this.Mbt.getGrantEntitlement()]).then((t=>{const s=t[1],i=t[2],e=this.Mbt.getResolvedEntitlementFor(s.getPlatformKey()),n=i||e;s.activate(e,i),this.s1.serviceEvent("subscriptions-service-activated",s.getPlatformKey()),this.s1.serviceEvent("subscriptions-platform-activated",s.getPlatformKey()),n.granted?this.s1.serviceEvent("subscriptions-access-granted",n.service):(this.s1.serviceEvent("subscriptions-paywall-activated",s.getPlatformKey()),this.s1.serviceEvent("subscriptions-access-denied",s.getPlatformKey()))}))}HAt(){return this.Lbt?this.Lbt.then((()=>{this.Mbt.getAvailablePlatforms().forEach((t=>{t.isPingbackEnabled()&&(t.pingbackReturnsAllEntitlements()?this.Mbt.getAllPlatformsEntitlements().then((s=>t.pingback(s))):this.Mbt.getGrantEntitlement().then((s=>t.pingback(s||Tt.empty("local")))))}))})):null}resetPlatforms(){this.Mbt=this.Mbt.resetPlatformStore(),this.md.toggleLoading(!0),this.Obt&&(this.Obt.entitlementsWereFetchedWithCurrentMeteringState=!1),this.Mbt.getAvailablePlatforms().forEach((t=>{this.Ybt(t)})),this.s1.serviceEvent("subscriptions-service-re-authorized",""),this.s1.serviceEvent("subscriptions-platform-re-authorized",""),this.Wbt()}resetPlatform(t){this.md.toggleLoading(!0),this.Mbt.resetPlatform(t);const s=this.Mbt.getPlatform(t);this.Ybt(s),this.Wbt()}delegateActionToLocal(t,s){return this.delegateActionToService(t,"local",s)}delegateActionToService(t,s,i=null){return new Promise((e=>{this.Mbt.onPlatformResolves(s,(n=>{k(n),this.s1.event("subscriptions-action-delegated",{"action":t,"serviceId":s},{"action":t,"status":ut}),e(n.executeAction(t,i))}))}))}decorateServiceAction(t,s,i,e){this.Mbt.onPlatformResolves(s,(s=>{k(s),s.decorateUI(t,i,e)}))}$At(t){this.NAt()&&t.resolveEntitlement("local",new Tt({source:"",raw:"",granted:!0,grantReason:It,dataObject:{}}))}NAt(){return!this.Sbt.isLocked()||this.kbt.alwaysGrant}Xbt(){const{services:t}=this.kbt,s=t.find((t=>t.enableMetering));s&&(this.Obt=new class{constructor({platformKey:t}){this.entitlementsWereFetchedWithCurrentMeteringState=!1,this.platformKey=t,this.YAt=""}saveMeteringState(t){const s=JSON.stringify(t);return Promise.resolve(this.YAt).then((t=>s!==t)).then((t=>{t&&(this.YAt=s,this.entitlementsWereFetchedWithCurrentMeteringState=!1)}))}loadMeteringState(){return this.YAt?Promise.resolve(JSON.parse(this.YAt)):Promise.resolve(null)}}({platformKey:s.serviceId}))}}(t).start()}))})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-subscriptions-0.1.mjs.map