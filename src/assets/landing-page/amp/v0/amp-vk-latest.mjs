;
(self.AMP=self.AMP||[]).push({m:1,v:"2203281422000",n:"amp-vk",ev:"0.1",l:!0,f:function(t,e){(()=>{var{isArray:e}=Array,{hasOwnProperty:r,toString:i}=Object.prototype;var n=self.AMP_CONFIG||{},s=("string"==typeof n.thirdPartyFrameRegex?new RegExp(n.thirdPartyFrameRegex):n.thirdPartyFrameRegex,("string"==typeof n.cdnProxyRegex?new RegExp(n.cdnProxyRegex):n.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/);function l(t){if(!self.document||!self.document.head)return null;if(self.location&&s.test(self.location.origin))return null;const e=self.document.head.querySelector(`meta[name="${t}"]`);return e&&e.getAttribute("content")||null}n.thirdPartyUrl,n.thirdPartyFrameHost,n.cdnUrl||l("runtime-host"),n.errorReportingUrl,n.betaErrorReportingUrl,n.localDev,n.geoApiUrl||l("amp-geo-api"),self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var o=self.__AMP_LOG;function a(t){return function(t,e){throw new Error("failed to call initLogConstructor")}()}function u(t,e,r,i,n,s,l,o,a,u,h){return t}function h(t,e,r,i,n,s,l,u,h,c,p){return(o.user||(o.user=a()),void o.user.win?o.userForEmbed||(o.userForEmbed=a()):o.user).assert(t,e,r,i,n,s,l,u,h,c,p)}function c(t,e){return d(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),e)}function p(t,e){return d(function(t){const e=f(t);return e.isSingleDoc()?e.win:e}(f(t)),e)}function f(t){return t.nodeType?(e=t,r=(e.ownerDocument||e).defaultView,c(r,"ampdoc")).getAmpDoc(t):t;var e,r}function d(t,e){u(function(t,e){const r=t.__AMP_SERVICES&&t.__AMP_SERVICES[e];return!(!r||!r.ctor)}(t,e));const r=function(t){let e=t.__AMP_SERVICES;return e||(e=t.__AMP_SERVICES={}),e}(t)[e];return r.obj||(u(r.ctor),u(r.context),r.obj=new r.ctor(r.context),u(r.obj),r.context=null,r.resolve&&r.resolve(r.obj)),r.obj}var m,v=t=>p(t,"viewer");function _(t,e,r){if(!e)return t;const i=t.split("#",2),n=i[0].split("?",2);let s=n[0]+(n[1]?r?`?${e}&${n[1]}`:`?${n[1]}&${e}`:`?${e}`);return s+=i[1]?`#${i[1]}`:"",s}function P(t,r){return _(t,function(t){const r=[];for(const l in t){let o=t[l];if(null!=o){o=e(s=o)?s:[s];for(let t=0;t<o.length;t++)r.push((i=l,n=o[t],`${encodeURIComponent(i)}=${encodeURIComponent(n)}`))}}var i,n,s;return r.join("&")}(r))}new Set(["c","v","a","ad"]);var k="post",b="poll",w=class extends t.BaseElement{constructor(t){super(t),this.Mv=null,this.hk=0,this.Xg=null,this.qd=null,this.pk=null,this.fk=null,this.dk=null,this.mk=null,this.vk=null}preconnectCallback(t){var e;(e=this.win,c(e,"preconnect")).url(this.getAmpDoc(),"https://vk.com",t)}_k(){const t=Date.now().toString(16);let e;return this.qd===k?e=this.Pk():this.qd===b&&(e=this.kk()),e.then((e=>_(e,t)))}Pk(){return v(this.element).getReferrerUrl().then((t=>{const e=this.element.offsetWidth,r=this.getAmpDoc().getUrl();return P("https://vk.com/widget_post.php",{"app":"0","width":"100%","_ver":"1","owner_id":this.pk,"post_id":this.fk,"hash":this.dk,"amp":"1","startWidth":e,"url":r,"referrer":t,"title":"AMP Post"})}))}kk(){return v(this.element).getReferrerUrl().then((t=>{const e=this.getAmpDoc().getUrl();return P("https://vk.com/al_widget_poll.php",{"app":this.mk,"width":"100%","_ver":"1","poll_id":this.vk,"amp":"1","url":e,"title":"AMP Poll","description":"","referrer":t})}))}buildCallback(){var t;this.qd=h(this.element.getAttribute("data-embedtype"),"The data-embedtype attribute is required for <amp-vk> %s",this.element),h("post"===(t=this.qd)||"poll"===t,`Unknown data-embedtype: ${this.qd}`),this.qd===k?this.bk():this.qd===b&&this.wk()}bk(){this.pk=h(this.element.getAttribute("data-owner-id"),"The data-owner-id attribute is required for <amp-vk> Post %s",this.element),this.fk=h(this.element.getAttribute("data-post-id"),"The data-post-id attribute is required for <amp-vk> Post %s",this.element),this.dk=h(this.element.getAttribute("data-hash"),"The data-hash attribute is required for <amp-vk> Post %s",this.element)}wk(){this.mk=h(this.element.getAttribute("data-api-id"),"The data-api-id attribute is required for <amp-vk> Poll %s",this.element),this.vk=h(this.element.getAttribute("data-poll-id"),"The data-poll-id attribute is required for <amp-vk> Poll %s",this.element)}layoutCallback(){const t=this.element.ownerDocument.createElement("iframe");return this.Mv=t,this.Xg=function(t,e,r,i){let n=t,s=r,l=t=>{try{return s(t)}catch(t){var e,r;throw null===(e=(r=self).__AMP_REPORT_ERROR)||void 0===e||e.call(r,t),t}};const o=function(){if(void 0!==m)return m;m=!1;try{const t={get capture(){return m=!0,!1}};self.addEventListener("test-options",null,t),self.removeEventListener("test-options",null,t)}catch(t){}return m}();return n.addEventListener(e,l,!!o&&i),()=>{null==n||n.removeEventListener(e,l,!!o&&i),s=null,n=null,l=null}}(this.win,"message",this.gk.bind(this),void 0),this._k().then((e=>(t.src=e,t.setAttribute("name","fXD"),t.setAttribute("scrolling","no"),t.setAttribute("frameborder","0"),t.setAttribute("allowfullscreen","true"),t.classList.add("i-amphtml-fill-content"),this.element.appendChild(t),this.loadPromise(t))))}gk(t){if("https://vk.com"!==t.origin||t.source!==this.Mv.contentWindow)return;const e=t.data;if(e){const t=/\[\"resize",\[(\d+)\]]/.exec(e);if(t&&t[1]){const e=parseInt(t[1],10);this.hk!==e&&(this.hk=e,this.forceChangeHeight(e))}}}isLayoutSupported(t){return"responsive"===t||"flex-item"===t||"fixed"===t}unlayoutOnPause(){return!0}unlayoutCallback(){var t,e;return this.Mv&&(null===(e=(t=this.Mv).parentElement)||void 0===e||e.removeChild(t),this.Mv=null),this.Xg&&this.Xg(),!0}};t.registerElement("amp-vk",w)})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-vk-0.1.mjs.map