;
import{PreactBaseElement as t}from"../bento.mjs";function n(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function e(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function r(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?e(Object(o),!0).forEach((function(e){n(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(o,n))}))}return t}var{hasOwnProperty:o,toString:i}=Object.prototype;function s(t,n){return t.querySelector(function(t,n){return t.replace(/^|,/g,"$&:scope ")}(n))}function l(t,n){const e=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector;return!!e&&e.call(t,n)}import{createElement as a}from"../bento.mjs";import{useEffect as u,useMemo as p,useRef as c}from"../bento.mjs";import{ContainWrapper as d}from"../bento.mjs";import{useCallback as f,useState as h}from"../bento.mjs";var m={info:console.info,warn:console.warn,error:console.error},b={isAndroid:()=>/Android/i.test(self.navigator.userAgent),isIos:()=>/iPhone|iPad|iPod/i.test(self.navigator.userAgent),isSafari(){return/Safari/i.test(self.navigator.userAgent)&&!this.isChrome()&&!this.isEdge()&&!this.isFirefox()&&!this.isOpera()},isChrome(){return/Chrome|CriOS/i.test(self.navigator.userAgent)&&!this.isEdge()&&!this.isOpera()},isFirefox(){return/Firefox|FxiOS/i.test(self.navigator.userAgent)&&!this.isEdge()},isOpera:()=>/OPR\/|Opera|OPiOS/i.test(self.navigator.userAgent),isEdge:()=>/Edge/i.test(self.navigator.userAgent),isWebKit(){return/WebKit/i.test(self.navigator.userAgent)&&!this.isEdge()},isWindows:()=>/Windows/i.test(self.navigator.userAgent),isStandalone(){return this.isIos()&&self.navigator.standalone||this.isChrome()&&self.matchMedia("(display-mode: standalone)").matches},isBot:()=>/bot/i.test(self.navigator.userAgent),getMajorVersion(){return this.isSafari()?this.isIos()?this.getIosMajorVersion()||0:this.Nh(/\sVersion\/(\d+)/,1):this.isChrome()?this.Nh(/(Chrome|CriOS)\/(\d+)/,2):this.isFirefox()?this.Nh(/(Firefox|FxiOS)\/(\d+)/,2):this.isOpera()?this.Nh(/(OPR|Opera|OPiOS)\/(\d+)/,2):this.isEdge()?this.Nh(/Edge\/(\d+)/,1):0},Nh(t,n){if(!self.navigator.userAgent)return 0;const e=self.navigator.userAgent.match(t);return!e||n>=e.length?0:parseInt(e[n],10)},getIosVersionString(){var t,n,e;return this.isIos()&&(null===(t=self.navigator.userAgent)||void 0===t||null===(n=t.match(/OS ([0-9]+[_.][0-9]+([_.][0-9]+)?)\b/))||void 0===n||null===(e=n[1])||void 0===e?void 0:e.replace(/_/g,"."))||""},getIosMajorVersion(){const t=this.getIosVersionString();return""===t?null:Number(t.split(".")[0])}},g=["javascript:","data:","vbscript:"],v={tOt(){return this.Ro||(this.Ro=self.document.createElement("a")),this.Ro},parse(t){const n=this.tOt();return n.href="",new URL(t,n.href)},isProtocolValid(t){const n=this.parse(t);return!g.includes(n.protocol)},assertHttpsUrl(t,n="url"){if(!this.isSecureUrl(t))throw new Error(`${n} must start with "https://" or "//" or be relative and served from either https or from localhost. Invalid value: ${t}`)},isSecureUrl(t){var n;const e=this.parse(t);return"https:"===e.protocol||"localhost"===e.hostname||"127.0.0.1"===e.hostname||(null===(n=e.hostname)||void 0===n?void 0:n.endsWith(".localhost"))}},O={getMetaByName(t){var n;const e=self.document.head.querySelectorAll("meta[name]");return(null===(n=Array.from(e).find((n=>n.getAttribute("name")===t&&n.getAttribute("content"))))||void 0===n?void 0:n.getAttribute("content"))||null},get sourceUrl(){return self.location.href},get canonicalUrl(){var t;const n=self.document,e=null==n||null===(t=n.AMP)||void 0===t?void 0:t.canonicalUrl;if(e)return e;const r=n.querySelector("link[rel=canonical]");return r?v.parse(r.href).href:this.sourceUrl}},A={fetchJson(t,n){return this.fetch(t,n).then((t=>t.json()))},fetch(t,n){return e=this,r=function*(){const e=yield self.fetch(t,n);if(!e.ok)throw new Error(e.statusText);return e},new Promise(((t,n)=>{var o=t=>{try{s(r.next(t))}catch(t){n(t)}},i=t=>{try{s(r.throw(t))}catch(t){n(t)}},s=n=>n.done?t(n.value):Promise.resolve(n.value).then(o,i);s((r=r.apply(e,null)).next())}));var e,r}},w=self.AMP_CONFIG||{},x=("string"==typeof w.thirdPartyFrameRegex?new RegExp(w.thirdPartyFrameRegex):w.thirdPartyFrameRegex,("string"==typeof w.cdnProxyRegex?new RegExp(w.cdnProxyRegex):w.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/);function N(t){if(!self.document||!self.document.head)return null;if(self.location&&x.test(self.location.origin))return null;const n=self.document.head.querySelector(`meta[name="${t}"]`);return n&&n.getAttribute("content")||null}w.thirdPartyUrl,w.thirdPartyFrameHost,w.cdnUrl||N("runtime-host"),w.errorReportingUrl,w.betaErrorReportingUrl,w.localDev,w.geoApiUrl||N("amp-geo-api"),self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var P=self.__AMP_LOG;function E(t,n,e,r){let o;try{o=t.open(n,e,r)}catch(t){(P.dev||(P.dev=function(t,n){throw new Error("failed to call initLogConstructor")}())).error("DOM","Failed to open url on target: ",e,t)}var i,s;return!o&&"_top"!=e&&("number"!=typeof s&&(s=0),s+"noopener".length>(i=r||"").length||-1===i.indexOf("noopener",s))&&(o=t.open(n,"_top")),o}function B(){if(b.isAndroid()&&b.isChrome())return m.info("BENTO-APP-BANNER","Not rendering bento-app-banner:","Browser supports builtin banners."),null;const t=self.document.head.querySelector("link[rel=manifest],link[rel=origin-manifest]");if(!t)return null;const n=t.getAttribute("href");v.assertHttpsUrl(n,void 0,"manifest href");const e=A.fetchJson(n).then(j);return{promise:e,openOrInstall:()=>e.then((t=>{if(!t)return;const{installAppUrl:n,openInAppUrl:e}=t;setTimeout((()=>{(class{static getTop(t){return t.top}static getLocation(t){return t.location}static getDocumentReferrer(t){return t.document.referrer}static getHostname(t){return t.location.hostname}static getUserAgent(t){return t.navigator.userAgent}static getUserLanguage(t){return t.navigator.userLanguage||t.navigator.language}static getDevicePixelRatio(){return self.devicePixelRatio||1}static getSendBeacon(t){if(t.navigator.sendBeacon)return t.navigator.sendBeacon.bind(t.navigator)}static getXMLHttpRequest(t){return t.XMLHttpRequest}static getImage(t){return t.Image}}).getTop(window).location.assign(n)}),1500),E(window,e,"_top")}))}}function j(t){const n=t.related_applications;if(!n)return m.error("BENTO-APP-BANNER","Invalid manifest:","related_applications is missing from manifest.json file"),null;const e=n.find((t=>"play"===t.platform));return e?{installAppUrl:`https://play.google.com/store/apps/details?id=${e.id}`,openInAppUrl:function(t){const n=v.parse(O.canonicalUrl),e=n.protocol.replace(":",""),{host:r,pathname:o}=n;return`android-app://${t}/${e}/${r}${o}`}(e.id)}:(m.error("BENTO-APP-BANNER","Invalid manifest:","Could not find a platform=play app in manifest"),null)}function I(){if(b.isSafari())return m.info("BENTO-APP-BANNER","Not rendering bento-app-banner:","Browser supports builtin banners."),null;const t=O.getMetaByName("apple-itunes-app");if(!t)return m.error("BENTO-APP-BANNER","Not rendering bento-app-banner:",'could not find a <meta name="apple-itunes-app" /> tag'),null;const{installAppUrl:n,openInAppUrl:e}=function(t){const n=function(t){return t.replace(/\s/,"").split(",").reduce(((t,n)=>{const[e,r]=n.split("=");return t[e]=r,t}),{})}(t),e=n["app-id"];let r=n["app-argument"];r?v.isProtocolValid(r)||(m.warn("BENTO-APP-BANNER",`The url in app-argument has invalid protocol: ${r}`),r=""):m.warn("BENTO-APP-BANNER",'<meta name="apple-itunes-app">\'s content should contain app-argument to allow opening an already installed application on iOS.');const o=`https://itunes.apple.com/us/app/id${e}`;return{installAppUrl:o,openInAppUrl:r||o}}(t);return{installAppUrl:n,openInAppUrl:e,openOrInstall:()=>{setTimeout((()=>{E(window,n,"_top")}),1500),E(window,e,"_top")}}}var R=["children","dismissButtonAriaLabel","onDismiss","onInstall"];function S(t){let{children:n,dismissButtonAriaLabel:e="Dismiss",onDismiss:o,onInstall:i}=t,p=function(t,n){if(null==t)return{};var e,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)e=i[r],n.indexOf(e)>=0||(o[e]=t[e]);return o}(t,R);const f=c(null);return u((()=>{let t=f.current.querySelector("button[open-button]");if(!t){const n=f.current.querySelector("slot");n&&(t=function(t,n){const e=t.assignedElements();for(let t=0;t<e.length;t++){const r=e[t];if(l(r,n))return r;const o=s(r,n);if(o)return o}return null}(n,"button[open-button]"))}if(t)return t.addEventListener("click",i),()=>t.removeEventListener("click",i);m.error("BENTO-APP-BANNER","Component children should contain a <button open-button>")}),[i]),a(d,r({},p),a("div",{class:"banner-dd356a4",ref:f},a("div",{class:"banner-padding-dd356a4"}),a("button",{class:"dismiss-dd356a4","aria-label":e,onClick:o}),n))}function y(t){const n=p(I,[]);return n?a(S,r(r({},t),{},{onInstall:n.openOrInstall})):null}function U(t){const n=p(B,[]);return n?a(S,r(r({},t),{},{onInstall:n.openOrInstall})):null}var T=class extends t{};T.Component=function(t){t.id||m.warn("BENTO-APP-BANNER","component should have an id");const[n,e]=function(t,n){const[e,r]=h((()=>{try{var n;const e=null===(n=self.localStorage)||void 0===n?void 0:n.getItem(t);return!!e&&JSON.parse(e)}catch(t){return!1}}));return[e,f((n=>{try{var e;const r=JSON.stringify(n);null===(e=self.localStorage)||void 0===e||e.setItem(t,r)}catch(n){m.warn("useLocalStorage","Could not write value to local storage",t,n)}r(n)}),[t])]}("bento-app-banner:"+t.id);if(n)return null;const o=b.isIos()?y:b.isAndroid()?U:null;return o?a(o,r(r({},t),{},{onDismiss:()=>e(!0)})):(m.info("BENTO-APP-BANNER","Component not rendered:","OS not supported"),null)},T.props={"children":{passthrough:!0},"dismissButtonAriaLabel":{attr:"dismiss-button-aria-label"},"id":{attr:"id"}},T.layoutSizeDefined=!0,T.usesShadowDom=!0,T.shadowCss='.banner-dd356a4{left:0;width:100%;bottom:0!important;z-index:13;position:fixed!important;background:#fff;box-shadow:0 0 5px 0 rgba(0,0,0,0.2)!important;box-sizing:border-box;max-height:100px!important}.banner-padding-dd356a4{top:0;left:0;right:0;height:4px;z-index:15;position:absolute;background:#fff}.dismiss-dd356a4{top:-28px;right:0;width:28px;border:none;height:28px;z-index:14;position:absolute;box-shadow:0 -1px 1px 0 rgba(0,0,0,0.2);border-radius:12px 0 0 0;background-size:13px 13px;background-color:#fff;background-image:url(\'data:image/svg+xml;charset=utf-8,<svg width="13" height="13" viewBox="341 8 13 13" xmlns="http://www.w3.org/2000/svg"><path fill="%234F4F4F" d="M354 9.31 352.69 8l-5.19 5.19L342.31 8 341 9.31l5.19 5.19-5.19 5.19 1.31 1.31 5.19-5.19 5.19 5.19 1.31-1.31-5.19-5.19z" fill-rule="evenodd"/></svg>\');background-repeat:no-repeat;background-position:9px}.dismiss-dd356a4:before{top:-20px;left:-20px;right:0;bottom:0;content:"";position:absolute}[dir=rtl] .dismiss-dd356a4{left:0;right:auto;background-position:6px;border-top-left-radius:0;border-top-right-radius:12px}[dir=rtl] .dismiss-dd356a4:before{left:0;right:-20px}';import{defineBentoElement as _}from"../bento.mjs";_("bento-app-banner",T,void 0);
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
//# sourceMappingURL=bento-app-banner-1.0.mjs.map