;
(self.AMP=self.AMP||[]).push({m:1,v:"2203281422000",n:"amp-imgur",ev:"0.1",l:!0,f:function(t,n){(()=>{var{hasOwnProperty:n,toString:r}=Object.prototype;function e(t){return"[object Object]"===r.call(t)}var i=self.AMP_CONFIG||{},s=("string"==typeof i.thirdPartyFrameRegex?new RegExp(i.thirdPartyFrameRegex):i.thirdPartyFrameRegex,("string"==typeof i.cdnProxyRegex?new RegExp(i.cdnProxyRegex):i.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/);function u(t){if(!self.document||!self.document.head)return null;if(self.location&&s.test(self.location.origin))return null;const n=self.document.head.querySelector(`meta[name="${t}"]`);return n&&n.getAttribute("content")||null}i.thirdPartyUrl,i.thirdPartyFrameHost,i.cdnUrl||u("runtime-host"),i.errorReportingUrl,i.betaErrorReportingUrl,i.localDev,i.geoApiUrl||u("amp-geo-api"),self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var l=self.__AMP_LOG;function o(t){return l.user||(l.user=c()),function(t,n){return n&&n.ownerDocument.defaultView!=t}(l.user.win,t)?l.userForEmbed||(l.userForEmbed=c()):l.user}function c(t){return function(t,n){throw new Error("failed to call initLogConstructor")}()}function f(t,n,r,e,i,s,u,l,o,c,f){return t}var a,h=t=>function(t,n){f(function(t,n){const r=t.__AMP_SERVICES&&t.__AMP_SERVICES[n];return!(!r||!r.ctor)}(t,n));const r=function(t){let n=t.__AMP_SERVICES;return n||(n=t.__AMP_SERVICES={}),n}(t)[n];return r.obj||(f(r.ctor),f(r.context),r.obj=new r.ctor(r.context),f(r.obj),r.context=null,r.resolve&&r.resolve(r.obj)),r.obj}(t,"timer"),m="amp-imgur",p=class extends t.BaseElement{constructor(t){super(t),this.Mv=null,this.Xg=null,this.xw=null}isLayoutSupported(t){return function(t){return"fixed"==t||"fixed-height"==t||"responsive"==t||"fill"==t||"flex-item"==t||"fluid"==t||"intrinsic"==t}(t)}buildCallback(){var t,n,r,e,i,s,u,l,c,f,a;t=this.element.dataset.imgurId,n="The data-imgur-id attribute is required for <amp-imgur> %s",r=this.element,o().assert(t,n,r,e,i,s,u,l,c,f,a)}layoutCallback(){this.Xg=function(t,n,r,e){let i=t,s=r,u=t=>{try{return s(t)}catch(t){var n,r;throw null===(n=(r=self).__AMP_REPORT_ERROR)||void 0===n||n.call(r,t),t}};const l=function(){if(void 0!==a)return a;a=!1;try{const t={get capture(){return a=!0,!1}};self.addEventListener("test-options",null,t),self.removeEventListener("test-options",null,t)}catch(t){}return a}();return i.addEventListener(n,u,!!l&&e),()=>{null==i||i.removeEventListener(n,u,!!l&&e),s=null,i=null,u=null}}(this.win,"message",this.Iw.bind(this),void 0);const t=this.element.dataset.imgurId.replace(/^(a\/)?(.*)/,((t,n,r)=>(n||"")+encodeURIComponent(r)));return this.$w(t).catch((n=>{if(t.startsWith("a/"))throw n;const r=`a/${t}`;return this.$w(r).then((()=>{}))})).catch((()=>{o().error(m,`Failed to load. Is "${t}" a correct id?`)}))}$w(t){const{element:n}=this,r=(e=n.ownerDocument,i={"scrolling":"no","frameborder":"0","allowfullscreen":"true","title":n.title||"imgur post"},function(t,n){for(const r in n)t.setAttribute(r,n[r]);return t}(e.createElement("iframe"),i));var e,i;r.src=`https://imgur.com/${t}/embed?pub=true`,this.Mv&&n.removeChild(this.Mv),this.Mv=r,n.appendChild(r),function(t,n){t.classList.add("i-amphtml-fill-content")}(r);const{promise:s,resolve:u}=new class{constructor(){this.promise=new Promise(((t,n)=>{this.resolve=t,this.reject=n}))}};return this.xw=u,this.loadPromise(this.Mv).then((()=>h(this.win).timeoutPromise(500,s)))}Iw(t){if("https://imgur.com"!=t.origin||t.source!=this.Mv.contentWindow)return;const n=function(t){return t.data}(t);if(!n||!e(n)&&!n.startsWith("{"))return;null==this||this.xw();const r=e(n)?n:function(t,n){try{return function(t){return JSON.parse(t)}(t)}catch(t){return null}}(n);if("resize_imgur"==r.message){const t=r.height;this.attemptChangeHeight(t).catch((()=>{}))}}unlayoutCallback(){var t,n;return this.Mv&&(null===(n=(t=this.Mv).parentElement)||void 0===n||n.removeChild(t),this.Mv=null),this.Xg&&this.Xg(),!0}};t.registerElement(m,p)})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-imgur-0.1.mjs.map