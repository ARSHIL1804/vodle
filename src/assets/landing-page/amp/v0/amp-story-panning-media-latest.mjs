;
(self.AMP=self.AMP||[]).push({m:1,v:"2203281422000",n:"amp-story-panning-media",ev:"0.1",l:!0,f:function(t,i){(()=>{var{isArray:i}=Array,{hasOwnProperty:n,toString:e}=Object.prototype;function s(t,i,n,e,s,r,o,a,u,h,l){return t}var r,o=class{constructor(){this.promise=new Promise(((t,i)=>{this.resolve=t,this.reject=i}))}},a=["Webkit","webkit","Moz","moz","ms","O","o"];function u(t){const i=t.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()));return a.some((t=>i.startsWith(t+"-")))?`-${i}`:i}function h(t,i,n){if(i.startsWith("--"))return i;r||(r=Object.create(null));let e=r[i];if(!e||n){if(e=i,void 0===t[i]){const n=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(i),s=function(t,i){for(let n=0;n<a.length;n++){const e=a[n]+i;if(void 0!==t[e])return e}return""}(t,n);void 0!==t[s]&&(e=s)}n||(r[i]=e)}return e}function l(t,i){const{style:n}=t;for(const t in i)n.setProperty(u(h(n,t)),String(i[t]),"important")}var c=self.AMP_CONFIG||{},f=("string"==typeof c.thirdPartyFrameRegex?new RegExp(c.thirdPartyFrameRegex):c.thirdPartyFrameRegex,("string"==typeof c.cdnProxyRegex?new RegExp(c.cdnProxyRegex):c.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/);function m(t){if(!self.document||!self.document.head)return null;if(self.location&&f.test(self.location.origin))return null;const i=self.document.head.querySelector(`meta[name="${t}"]`);return i&&i.getAttribute("content")||null}function p(t){if(!t)return null;const i=t.match(/^(.*)\/(.*)-([0-9.]+|latest)(\.max)?\.(?:js|mjs)$/i),n=i?i[2]:void 0,e=i?i[3]:void 0;return n&&e?{extensionId:n,extensionVersion:e}:null}c.thirdPartyUrl,c.thirdPartyFrameHost,c.cdnUrl||m("runtime-host"),c.errorReportingUrl,c.betaErrorReportingUrl,c.localDev,c.geoApiUrl||m("amp-geo-api"),self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var d=self.__AMP_LOG;function g(t){return d.user||(d.user=y()),function(t,i){return i&&i.ownerDocument.defaultView!=t}(d.user.win,t)?d.userForEmbed||(d.userForEmbed=y()):d.user}function y(t){return function(t,i){throw new Error("failed to call initLogConstructor")}()}function A(t,i,n,e,s,r,o,a,u,h,l){return t}function P(t,i){return b(t,i)}function _(t,i){A(function(t,i){const n=t.__AMP_SERVICES&&t.__AMP_SERVICES[i];return!(!n||!n.ctor)}(t,i));const n=v(t)[i];return n.obj||(A(n.ctor),A(n.context),n.obj=new n.ctor(n.context),A(n.obj),n.context=null,n.resolve&&n.resolve(n.obj)),n.obj}function b(t,i){const n=v(t)[i];return n?n.promise?n.promise:(_(t,i),n.promise=Promise.resolve(n.obj)):null}function v(t){let i=t.__AMP_SERVICES;return i||(i=t.__AMP_SERVICES={}),i}function w(t,i,n,e,s){return P(t,i)||function(t,i,n,e,s){return(r=t.document,new Promise((t=>function(t,i){!function(t,i,n){if(i())n();else{const s=new(e=t,(e.ownerDocument||e).defaultView).MutationObserver((()=>{i()&&(s.disconnect(),n())}));s.observe(t,{childList:!0})}var e}(t.documentElement,(()=>!!t.body),i)}(r,t)))).then((()=>{const i=function(t,i){return _(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),i)}(t,"extensions");return function(t,i,n){return function(t){if(!t)return[];const i=t.querySelectorAll("script[custom-element],script[custom-template]"),n=[];for(let t=0;t<i.length;t++){const e=i[t],s=e.getAttribute("custom-element")||e.getAttribute("custom-template"),r=p(e.src);s&&r&&n.push({script:e,extensionId:s,extensionVersion:r.extensionVersion})}return n}(t.document.head).some((({extensionId:t,extensionVersion:e})=>i==t&&n==e))}(i.win,n,e)?i.waitForExtension(n,e):null})).then((n=>n?s?P(t,i):function(t,i){return function(t,i){const n=b(t,i);if(n)return n;const e=v(t);return e[i]=function(){const t=new o,{promise:i,reject:n,resolve:e}=t;return i.catch((()=>{})),{obj:null,promise:i,resolve:e,reject:n,context:null,ctor:null}}(),e[i].promise}(t,i)}(t,i):null));var r}(t,i,n,e,s)}var x="AMP_STORY_PANNING_MEDIA",M=class extends t.BaseElement{constructor(t){super(t),this.Aft=null,this.Pft={},this.Mft=null,this.Ift={},this.VG=null,this.OG=null,this.qG=!1,this.Tft=null,this.Rft=null}buildCallback(){return(t=this.win,w(t,"story-store","amp-story","1.0")).then((t=>this.VG=t));var t}layoutCallback(){return this.Aft=this.element.querySelector("amp-img"),this.Rft=this.element.getAttribute("group-id")||this.Aft.getAttribute("src"),this.eJ(),function(t){if(s(function(t){const i=t.tagName;return i.startsWith("AMP-")&&!("AMP-STICKY-AD-TOP-PADDING"==i||"AMP-BODY"==i)}(t)),t.createdCallback)return Promise.resolve(t);if(!t.__AMP_UPG_PRM){const i=new o;t.__AMP_UPG_PRM=i.promise,t.__AMP_UPG_RES=i.resolve}const i=t.__AMP_UPG_PRM;return s(i),i}(this.Aft).then((()=>this.Aft.signals().whenSignal("load-end"))).then((()=>{this.element.querySelector("img").classList="",this.jft()})).catch((()=>g().error(x,"Failed to load the amp-img.")))}eJ(){this.VG.subscribe(39,(()=>{this.Mft={width:this.element.offsetWidth,height:this.element.offsetHeight},this.jft(),this.Vft(),this.uY()}),!0),this.VG.subscribe(33,(t=>{this.qG=t===this.XG(),this.uY()}),!0),this.VG.subscribe(21,(t=>this.kft(t)),!0);const t=new MutationObserver((t=>this.Tft=parseInt(t[0].target.getAttribute("distance"),10)));this.BG()&&t.observe(this.BG(),{attributes:!0,attributeFilter:["distance"]})}Vft(){const t=parseFloat(this.element.getAttribute("data-x")||0),i=parseFloat(this.element.getAttribute("data-y")||0),n=parseFloat(this.element.getAttribute("data-zoom")||1);if(this.element.hasAttribute("lock-bounds")){this.Pft.zoom=n<1?1:n;const{horizontal:e,vertical:s}=this.zft();this.Pft.x=Math.max(-e,Math.min(t,e)),this.Pft.y=Math.max(-s,Math.min(i,s))}else this.Pft={x:t,y:i,zoom:n}}zft(){const{height:t,width:i}=this.Mft,n=this.Aft.getAttribute("width"),e=this.Aft.getAttribute("height");n&&e||g().error(x,'"lock-bounds" requires "width" and "height" to be set on the amp-img child.');const s=i/t<n/e?t/e:i/n,r=s*e;return{horizontal:50*(1-i/(s*n*this.Pft.zoom)),vertical:50*(1-t/(r*this.Pft.zoom))}}uY(){if(!this.qG)return;const t=this.VG.get(21)[this.Rft];if(!t||null!==(i=this.win.matchMedia("(prefers-reduced-motion: reduce)"))&&void 0!==i&&i.matches)return void this.VG.dispatch(3,{[this.Rft]:this.Pft});var i;let n;const e=i=>{n||(n=i);const s=i-n;if(s<1e3){const{x:i,y:n,zoom:o}=this.Pft,a=(r=s/1e3)<.5?2*r*r:1-Math.pow(-2*r+2,2)/2;this.VG.dispatch(3,{[this.Rft]:{x:t.x+(i-t.x)*a,y:t.y+(n-t.y)*a,zoom:t.zoom+(o-t.zoom)*a}}),this.qG&&requestAnimationFrame(e)}else this.VG.dispatch(3,{[this.Rft]:this.Pft});var r};requestAnimationFrame(e)}jft(){const t=this.element.querySelector("img");if(!t)return;const{height:i,width:n}=this.Mft,e=n/i,s=this.Aft.getAttribute("width")/this.Aft.getAttribute("height");this.mutateElement((()=>{e<s?(l(this.Aft,{left:"auto",right:"auto",top:"0",bottom:"0",width:"auto",height:"100%"}),l(t,{width:"auto",height:"100%"})):(l(this.Aft,{left:"0",right:"0",top:"auto",bottom:"auto",width:"100%",height:"auto"}),l(t,{width:"100%",height:"auto"}))}))}kft(t){this.Tft<=1&&t[this.Rft]&&!function(t,n,e=5){if(!isFinite(e)||e<0)throw new Error("Invalid depth: "+e);if(t===n)return!0;const s=[{a:t,b:n,depth:e}];for(;s.length>0;){const{a:t,b:n,depth:e}=s.shift();if(e>0){if(typeof t!=typeof n)return!1;if(i(t)&&i(n)){if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)s.push({a:t[i],b:n[i],depth:e-1});continue}if(t&&n&&"object"==typeof t&&"object"==typeof n){const i=Object.keys(t),a=Object.keys(n);if(i.length!==a.length)return!1;for(var r=0,o=i;r<o.length;r++){const i=o[r];s.push({a:t[i],b:n[i],depth:e-1})}continue}}if(t!==n)return!1}return!0}(this.Ift,t[this.Rft])&&(this.Ift=t[this.Rft],this.Fft())}Fft(){const{x:t,y:i,zoom:n}=this.Ift;return this.mutateElement((()=>{l(this.Aft,{transform:`translate3d(${t}%, ${i}%, ${this.Oft(n)}px)`})}))}Oft(t){const i=(t-1)/t;return isFinite(i)?i:-1e5}XG(){return null==this.OG&&(this.OG=this.BG().getAttribute("id")),this.OG}BG(){return function(t,i,n){let e;for(e=t;e&&void 0!==e;e=e.parentElement)if(i(e))return e;return null}(this.element,(t=>"amp-story-page"===t.tagName.toLowerCase()))}isLayoutSupported(t){return"fill"==t}};t.registerElement("amp-story-panning-media",M,"amp-story-panning-media{display:-ms-flexbox!important;display:flex!important;-ms-flex-pack:center!important;justify-content:center!important;-ms-flex-align:center!important;align-items:center!important;perspective:1px!important}amp-story-panning-media amp-img{-webkit-backface-visibility:hidden!important;backface-visibility:hidden!important}amp-story-grid-layer[template=fill] amp-story-panning-media amp-img img{position:relative!important;display:inline-block!important}\n/*# sourceURL=/extensions/amp-story-panning-media/0.1/amp-story-panning-media.css*/")})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-story-panning-media-0.1.mjs.map