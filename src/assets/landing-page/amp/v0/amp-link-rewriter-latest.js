;
(self.AMP=self.AMP||[]).push({m:0,v:"2203281422000",n:"amp-link-rewriter",ev:"0.1",l:!0,f:function(n,t){!function(){function t(n,r){return(t=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n})(n,r)}function r(n){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)})(n)}function e(n){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}function i(n,t){if(t&&("object"===e(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}(n)}Array.isArray;var u,o=Object.prototype,f=o.hasOwnProperty;function c(n,t){return f.call(n,t)}function s(n,t){return n.replace(/^|,/g,"$&".concat(t," "))}o.toString;var a=self.AMP_CONFIG||{},l=("string"==typeof a.thirdPartyFrameRegex?new RegExp(a.thirdPartyFrameRegex):a.thirdPartyFrameRegex,("string"==typeof a.cdnProxyRegex?new RegExp(a.cdnProxyRegex):a.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/);function h(n){if(!self.document||!self.document.head)return null;if(self.location&&l.test(self.location.origin))return null;var t=self.document.head.querySelector('meta[name="'.concat(n,'"]'));return t&&t.getAttribute("content")||null}a.thirdPartyUrl,a.thirdPartyFrameHost,a.cdnUrl||h("runtime-host"),a.errorReportingUrl,a.betaErrorReportingUrl,a.localDev,a.geoApiUrl||h("amp-geo-api"),self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var v=self.__AMP_LOG;function p(n){return v.user||(v.user=d()),function(n,t){return t&&t.ownerDocument.defaultView!=n}(v.user.win,n)?v.userForEmbed||(v.userForEmbed=d()):v.user}function d(n){return function(n,t){throw new Error("failed to call initLogConstructor")}()}function y(n,t,r,e,i,u,o,f,c,s,a){return n}function w(n,t){return E(m(b(n)),t)}function b(n){return n.nodeType?(r=n,t=(r.ownerDocument||r).defaultView,function(n,t){return E(n=function(n){return n.__AMP_TOP||(n.__AMP_TOP=n)}(n),"ampdoc")}(t)).getAmpDoc(n):n;var t,r}function m(n){var t=b(n);return t.isSingleDoc()?t.win:t}function E(n,t){y(R(n,t));var r=function(n){var t=n.__AMP_SERVICES;return t||(t=n.__AMP_SERVICES={}),t}(n)[t];return r.obj||(y(r.ctor),y(r.context),r.obj=new r.ctor(r.context),y(r.obj),r.context=null,r.resolve&&r.resolve(r.obj)),r.obj}function R(n,t){var r=n.__AMP_SERVICES&&n.__AMP_SERVICES[t];return!(!r||!r.ctor)}var O=function(n){return w(n,"documentInfo").get()},j=(new Set(["c","v","a","ad"]),0);function g(n){var t,r,e,i,o=function(n){try{return function(n){var t,r,e,i,o=(t=n,/^[\w-]+$/.test(r="script"),e=t,i="> ".concat(r),(void 0!==u?u:u=function(n){try{var t=n.ownerDocument,r=t.createElement("div"),e=t.createElement("div");return r.appendChild(e),r.querySelector(":scope div")===e}catch(n){return!1}}(e))?e.querySelectorAll(s(i,":scope")):function(n,t){var r=n.classList,e="i-amphtml-scoped";r.add(e);var i=s(t,".".concat(e)),u=n.querySelectorAll(i);return r.remove(e),u}(e,i)),f=o.length;if(1!==f)throw new Error("Found ".concat(f," <script> children. Expected 1."));var c,a=o[0];if(!function(n){var t;return"SCRIPT"==n.tagName&&"APPLICATION/JSON"==(null===(t=n.getAttribute("type"))||void 0===t?void 0:t.toUpperCase())}(a))throw new Error('<script> child must have type="application/json"');try{var l;return c=null!==(l=a.textContent)&&void 0!==l?l:"",JSON.parse(c)}catch(n){throw new Error("Failed to parse <script> contents. Is it valid JSON?")}}(n)}catch(t){throw p(n).createError("%s: %s","amp-link-rewriter",t)}}(n);return i=o.output,"amp-link-rewriter: output config property is required",p().assert(i,"amp-link-rewriter: output config property is required",undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined),{output:o.output.toString(),section:c(o,"section")?o.section:[],attribute:c(o,"attribute")?(r=o.attribute,e={},Object.keys(r).forEach((function(n){e[n]="^"+r[n]+"$"})),e):{},vars:c(o,"vars")?o.vars:{},scopeDocument:null===(t=o.scopeDocument)||void 0===t||t}}function S(n,t){var r=t.attribute;return Object.keys(r).every((function(t){return new RegExp(r[t]).test(n.getAttribute(t))}))}var C=["href","id","rel","rev"],x=/^vars(.+)/,A=/^(?:https?:)?(?:\/\/)?([^\/?]+)/i,I={"SOURCE_URL":!0,"DOCUMENT_REFERRER":!0,"AMP_GEO":!0},N=function(){function n(n,t,r){var e,i;this.LN=r,this.JR=g(t),this.GR=function(n,t){var r=n.getRootNode(),e=t.section.join(" a, "),i=r.querySelectorAll("a"),u=[];return 0!==t.section.length&&(e+=" a",i=r.querySelectorAll(e)),function(n,r){for(var e=n.length,i=0;i<e;i++)S(o=n[i],t)&&u.push(o);var o}(i),u}(this.LN,this.JR),this.FN=n,this.KR="",this.QR=(e="url-replace",R(i=m(b(t)),e)?E(i,e):null)}var t=n.prototype;return t.handleClick=function(n){if(n&&(this.KR=this.JR.output,!this.XR(n)&&this.YR(n))){var t=O(this.LN).sourceUrl.match(A)[1],r=O(this.LN).canonicalUrl.match(A)[1];this.nC(n,[t,r])||this.tC(n)}},t.XR=function(n){return n.href.match(A)[1]===this.KR.match(A)[1]},t.YR=function(n){return this.JR.scopeDocument?this.rC(n):!!S(t=n,r=this.JR)&&function(n,t){return 0===t.section.length||(r=n,e=t.section.join(","),!!(r.closest?r.closest(e):function(n,t,r){var e;for(e=n;e&&void 0!==e;e=e.parentElement)if(t(e))return e;return null}(r,(function(n){return function(n,t){var r=n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector;return!!r&&r.call(n,t)}(n,e)}))));var r,e}(t,r);var t,r},t.rC=function(n){return null===this.GR||0===this.GR.length||this.GR.filter((function(t){return t===n})).length>0},t.nC=function(n,t){var r=n.href;return t.some((function(n){var t=r.match(A);return!t||A.test(r)&&t[1]===n}))},t.tC=function(n){this.KR=this.eC();var t=this.JR.vars;t instanceof Object&&(n.href=this.iC(n,t))},t.eC=function(){return this.QR.expandUrlSync(this.KR,{DOCUMENT_REFERRER:this.FN},I)},t.iC=function(n,t){var r=this;C.forEach((function(r){n.getAttribute(r)&&(t[r]=n.getAttribute(r))}));var e=function(n,t,r){var e=n.dataset,i={},u=r;for(var o in e){var f=o.match(u);f&&(i[f[1][0].toLowerCase()+f[1].substr(1)]=e[o])}return i}(n,0,x);return Object.assign(t,e),t.random=Math.random().toString(32).substr(2),Object.keys(t).forEach((function(n){t[n]&&(r.KR=r.KR.replace("${"+n+"}",encodeURIComponent(t[n])))})),this.KR=this.KR.replace(/\${[A-Za-z0-9]+}+/,(function(){return""})),this.KR},n}(),T=function(n){!function(n,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(r&&r.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),r&&t(n,r)}(f,n);var e,u,o=(e=f,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(n){return!1}}(),function(){var n,t=r(e);if(u){var o=r(this).constructor;n=Reflect.construct(t,arguments,o)}else n=t.apply(this,arguments);return i(this,n)});function f(n){var t;return(t=o.call(this,n)).uC=null,t.FN="",t}var c=f.prototype;return c.buildCallback=function(){var n=this,t=w(this.getAmpDoc(),"viewer");return this.getAmpDoc().whenReady().then((function(){return t.getReferrerUrl()})).then((function(t){return n.FN=t})).then(this.oC.bind(this))},c.oC=function(){this.uC=new N(this.FN,this.element,this.getAmpDoc()),this.fC()},c.fC=function(){var n,t=this;return(n=this.getAmpDoc(),w(n,"navigation")).registerAnchorMutator((function(n){t.uC.handleClick(n)}),j),!0},c.isLayoutSupported=function(n){return"nodisplay"===n},f}(n.BaseElement);n.registerElement("amp-link-rewriter",T)}();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-link-rewriter-0.1.js.map