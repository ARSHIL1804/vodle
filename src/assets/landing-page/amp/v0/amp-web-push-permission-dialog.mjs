;
(()=>{var{hasOwnProperty:t,toString:s}=Object.prototype,i=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function e(t,s=""){try{return decodeURIComponent(t)}catch(t){return s}}var n,o=self.AMP_CONFIG||{},r=("string"==typeof o.thirdPartyFrameRegex?new RegExp(o.thirdPartyFrameRegex):o.thirdPartyFrameRegex,("string"==typeof o.cdnProxyRegex?new RegExp(o.cdnProxyRegex):o.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/);function h(t){if(!self.document||!self.document.head)return null;if(self.location&&r.test(self.location.origin))return null;const s=self.document.head.querySelector(`meta[name="${t}"]`);return s&&s.getAttribute("content")||null}function c(t){return t.data}function l(t,s){return n||(n=self.document.createElement("a")),function(t,s,i){return t.href="",new URL(s,t.href)}(n,t)}o.thirdPartyUrl,o.thirdPartyFrameHost,o.cdnUrl||h("runtime-host"),o.errorReportingUrl,o.betaErrorReportingUrl,o.localDev,o.geoApiUrl||h("amp-geo-api"),self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null},self.__AMP_LOG,new Set(["c","v","a","ad"]);var a=class{constructor(t){t||(t={debug:!1,windowContext:window}),this.vt={},this.Wf={},this.Uf=t.debug,this.Gf=!1,this.Hf=!1,this.js=!1,this.Df=null,this.Kf=null,this.qf=null,this.Jf=null,this.Bf=null,this.Qf=t.windowContext||window}listen(t){return new Promise(((s,i)=>{this.js?i(new Error("Already connected.")):this.Gf?i(new Error("Already listening for connections.")):Array.isArray(t)?(this.qf=this.Zf.bind(this,t,s,i),this.Qf.addEventListener("message",this.qf),this.Uf):i(new Error("allowedOrigins should be a string array of allowed origins to accept messages from. Got:",t))})).then((()=>{this.send(a.Topics.CONNECT_HANDSHAKE,null),this.js=!0}))}Wl(t,s){const i=l(t).origin;for(let t=0;t<s.length;t++)if(l(s[t]).origin===i)return!0;return!1}Zf(t,s,i,e){const n=c(e),{origin:o,ports:r}=e;this.Uf,this.Wl(o,t)&&n&&n.topic===a.Topics.CONNECT_HANDSHAKE&&(this.Qf.removeEventListener("message",this.qf),this.Kf=r[0],this.Bf=this.Xf.bind(this),this.Kf.addEventListener("message",this.Bf,!1),this.Kf.start(),s())}connect(t,s){return new Promise(((i,e)=>{t||e(new Error("Provide a valid Window context to connect to.")),s||e(new Error("Provide an expected origin for the remote Window or provide the wildcard *.")),this.js?e(new Error("Already connected.")):this.Hf?e(new Error("Already connecting.")):(this.Df=new MessageChannel,this.Kf=this.Df.port1,this.Jf=this.Yf.bind(this,this.Kf,s,i),this.Kf.addEventListener("message",this.Jf),this.Kf.start(),t.postMessage({topic:a.Topics.CONNECT_HANDSHAKE},"*"===s?"*":l(s).origin,[this.Df.port2]))}))}Yf(t,s,i){this.js=!0,this.Uf,t.removeEventListener("message",this.Jf),this.Bf=this.Xf.bind(this),t.addEventListener("message",this.Bf,!1),i()}static get Topics(){return{CONNECT_HANDSHAKE:"topic-connect-handshake",NOTIFICATION_PERMISSION_STATE:"topic-notification-permission-state",SERVICE_WORKER_STATE:"topic-service-worker-state",SERVICE_WORKER_REGISTRATION:"topic-service-worker-registration",SERVICE_WORKER_QUERY:"topic-service-worker-query",STORAGE_GET:"topic-storage-get"}}Xf(t){const s=c(t);if(this.vt[s.id]&&s.isReply){const t=this.vt[s.id];delete this.vt[s.id];const{promiseResolver:i}=t;t.message=s.data,this.Uf,i([s.data,this.td.bind(this,s.id,t.topic)])}else{const t=this.Wf[s.topic];if(!t)return;this.Uf;for(let i=0;i<t.length;i++)(0,t[i])(s.data,this.td.bind(this,s.id,s.topic))}}on(t,s){this.Wf[t]?this.Wf[t].push(s):this.Wf[t]=[s]}off(t,s){if(s){const i=this.Wf[t].indexOf(s);-1!==i&&this.Wf[t].splice(i,1)}else this.Wf[t]&&delete this.Wf[t]}td(t,s,i){const e={id:t,topic:s,data:i,isReply:!0};return this.Kf.postMessage(e),new Promise((t=>{this.vt[e.id]={message:i,topic:s,promiseResolver:t}}))}send(t,s){const i={id:crypto.getRandomValues(new Uint8Array(10)).join(""),topic:t,data:s};return this.Uf,this.Kf.postMessage(i),new Promise((e=>{this.vt[i.id]={message:s,topic:t,promiseResolver:e}}))}};window._ampWebPushPermissionDialog=new class{constructor(t){this.Uf=t&&t.debug,this.Qf=t.windowContext||window,this.ed=new a({debug:this.Uf,windowContext:this.Qf})}isCurrentDialogPopup(){return!!this.Qf.opener&&this.Qf.opener!==this.Qf}requestNotificationPermission(){return new Promise(((t,s)=>{try{this.Qf.Notification.requestPermission((s=>t(s)))}catch(t){s(t)}}))}run(){this.tw(),this.sw(),this.iw(),this.ew(),"denied"!==this.Qf.Notification.permission?this.nw():this.ow()}tw(){const t=this.Qf.document.querySelector("#close");t&&t.addEventListener("click",(()=>{this.closeDialog()}))}closeDialog(){if(this.isCurrentDialogPopup())this.Qf.close();else{const t=function(t){const s=function(t){const s=Object.create(null);return s}();if(!t)return s;let n;for(;n=i.exec(t);){const t=e(n[1],n[1]),i=n[2]?e(n[2].replace(/\+/g," "),n[2]):"";s[t]=i}return s}((this.Qf.fakeLocation||this.Qf.location).search);if(!t.return)throw new Error("Missing required parameter.");const s=e(t.return);this.redirectToUrl(s)}}ow(){navigator.permissions.query({name:"notifications"}).then((t=>{t.onchange=()=>{switch(this.sw(),this.Qf.Notification.permission){case"default":case"granted":this.nw()}}}))}sw(){this.Qf.localStorage.setItem("amp-web-push-notification-permission",this.Qf.Notification.permission)}iw(){const t=this.Qf.document.querySelectorAll("[permission]");for(let s=0;s<t.length;s++){const i=t[s];this.rw(i,!1)}const s=this.Qf.document.querySelector(`[permission=${i=this.Qf.Notification.permission,CSS.escape(i)}]`);var i;s&&this.rw(s,!0)}ew(){const t=this.Qf.document.querySelector("#preload"),s=this.Qf.document.querySelector("#postload");t&&s&&(this.rw(t,!1),this.rw(s,!0))}rw(t,s){if(!t)return;const i="invisible";s?t.classList.remove(i):t.classList.add(i)}nw(){return this.requestNotificationPermission().then((t=>{if(this.sw(),this.isCurrentDialogPopup())return this.ed.connect(opener,"*"),this.ed.send(a.Topics.NOTIFICATION_PERMISSION_STATE,t).then((t=>{const s=t[0];s&&s.closeFrame&&this.closeDialog()}));this.closeDialog()}))}redirectToUrl(t){const s=l(t);!s||"http:"!==s.protocol&&"https:"!==s.protocol||(this.Qf.location.href=t)}}({debug:!1}),window._ampWebPushPermissionDialog.run()})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
//# sourceMappingURL=amp-web-push-permission-dialog.mjs.map