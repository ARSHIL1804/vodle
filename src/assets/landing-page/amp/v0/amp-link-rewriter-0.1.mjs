;
(self.AMP=self.AMP||[]).push({m:1,v:"2203281422000",n:"amp-link-rewriter",ev:"0.1",l:!0,f:function(t,n){(()=>{var{hasOwnProperty:n,toString:r}=Object.prototype;function e(t,r){return n.call(t,r)}var i=self.AMP_CONFIG||{},s=("string"==typeof i.thirdPartyFrameRegex?new RegExp(i.thirdPartyFrameRegex):i.thirdPartyFrameRegex,("string"==typeof i.cdnProxyRegex?new RegExp(i.cdnProxyRegex):i.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/);function o(t){if(!self.document||!self.document.head)return null;if(self.location&&s.test(self.location.origin))return null;const n=self.document.head.querySelector(`meta[name="${t}"]`);return n&&n.getAttribute("content")||null}i.thirdPartyUrl,i.thirdPartyFrameHost,i.cdnUrl||o("runtime-host"),i.errorReportingUrl,i.betaErrorReportingUrl,i.localDev,i.geoApiUrl||o("amp-geo-api"),self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var u=self.__AMP_LOG;function c(t){return u.user||(u.user=l()),function(t,n){return n&&n.ownerDocument.defaultView!=t}(u.user.win,t)?u.userForEmbed||(u.userForEmbed=l()):u.user}function l(t){return function(t,n){throw new Error("failed to call initLogConstructor")}()}function a(t,n,r,e,i,s,o,u,c,l,a){return t}function h(t,n){return v(p(f(t)),n)}function f(t){return t.nodeType?(n=t,r=(n.ownerDocument||n).defaultView,function(t,n){return v(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),n)}(r,"ampdoc")).getAmpDoc(t):t;var n,r}function p(t){const n=f(t);return n.isSingleDoc()?n.win:n}function v(t,n){a(_(t,n));const r=function(t){let n=t.__AMP_SERVICES;return n||(n=t.__AMP_SERVICES={}),n}(t)[n];return r.obj||(a(r.ctor),a(r.context),r.obj=new r.ctor(r.context),a(r.obj),r.context=null,r.resolve&&r.resolve(r.obj)),r.obj}function _(t,n){const r=t.__AMP_SERVICES&&t.__AMP_SERVICES[n];return!(!r||!r.ctor)}var d=t=>h(t,"documentInfo").get(),E=t=>function(t,n){const r=p(f(t));return _(r,n)?v(r,n):null}(t,"url-replace"),R=(new Set(["c","v","a","ad"]),0);function P(t){var n;const r=function(t){try{return function(t){const n=(e=t,/^[\w-]+$/.test("script"),"> script",e.querySelectorAll(function(t,n){return t.replace(/^|,/g,"$&:scope ")}("> script"))),{length:r}=n;var e;if(1!==r)throw new Error(`Found ${r} <script> children. Expected 1.`);const i=n[0];if(!function(t){var n;return"SCRIPT"==t.tagName&&"APPLICATION/JSON"==(null===(n=t.getAttribute("type"))||void 0===n?void 0:n.toUpperCase())}(i))throw new Error('<script> child must have type="application/json"');try{var s;return o=null!==(s=i.textContent)&&void 0!==s?s:"",JSON.parse(o)}catch(t){throw new Error("Failed to parse <script> contents. Is it valid JSON?")}var o}(t)}catch(n){throw c(t).createError("%s: %s","amp-link-rewriter",n)}}(t);return i=r.output,s="amp-link-rewriter: output config property is required",c().assert(i,s,o,u,l,a,h,f,p,v,_),{output:r.output.toString(),section:e(r,"section")?r.section:[],attribute:e(r,"attribute")?w(r.attribute):{},vars:e(r,"vars")?r.vars:{},scopeDocument:null===(n=r.scopeDocument)||void 0===n||n};var i,s,o,u,l,a,h,f,p,v,_}function w(t){const n={};return Object.keys(t).forEach((r=>{n[r]="^"+t[r]+"$"})),n}function A(t,n){const r=n.attribute;return Object.keys(r).every((n=>new RegExp(r[n]).test(t.getAttribute(n))))}var I=["href","id","rel","rev"],m=/^vars(.+)/,g=/^(?:https?:)?(?:\/\/)?([^\/?]+)/i,O={"SOURCE_URL":!0,"DOCUMENT_REFERRER":!0,"AMP_GEO":!0},M=class extends t.BaseElement{constructor(t){super(t),this.uO=null,this.cO=""}buildCallback(){const t=h(this.getAmpDoc(),"viewer");return this.getAmpDoc().whenReady().then((()=>t.getReferrerUrl())).then((t=>this.cO=t)).then(this.lO.bind(this))}lO(){this.uO=new class{constructor(t,n,r){this.hO=r,this.fO=P(n),this.pO=function(t,n){const r=t.getRootNode();let e=n.section.join(" a, "),i=r.querySelectorAll("a");const s=[];return 0!==n.section.length&&(e+=" a",i=r.querySelectorAll(e)),function(t,r){const{length:e}=t;for(let r=0;r<e;r++)A(i=t[r],n)&&s.push(i);var i}(i),s}(this.hO,this.fO),this.cO=t,this.vO="",this._O=E(n)}handleClick(t){if(!t)return;if(this.vO=this.fO.output,this.dO(t))return;if(!this.EO(t))return;const n=d(this.hO).sourceUrl.match(g)[1],r=d(this.hO).canonicalUrl.match(g)[1];this.RO(t,[n,r])||this.PO(t)}dO(t){return t.href.match(g)[1]===this.vO.match(g)[1]}EO(t){return this.fO.scopeDocument?this.wO(t):!!A(n=t,r=this.fO)&&function(t,n){return 0===n.section.length||(r=t,e=n.section.join(","),!!(r.closest?r.closest(e):function(t,n,r){let e;for(e=t;e&&void 0!==e;e=e.parentElement)if(n(e))return e;return null}(r,(t=>function(t,n){const r=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector;return!!r&&r.call(t,n)}(t,e)))));var r,e}(n,r);var n,r}wO(t){return null===this.pO||0===this.pO.length||this.pO.filter((n=>n===t)).length>0}RO(t,n){const{href:r}=t;return n.some((t=>{const n=r.match(g);return!n||g.test(r)&&n[1]===t}))}PO(t){this.vO=this.AO();const{vars:n}=this.fO;n instanceof Object&&(t.href=this.IO(t,n))}AO(){return this._O.expandUrlSync(this.vO,{DOCUMENT_REFERRER:this.cO},O)}IO(t,n){I.forEach((r=>{t.getAttribute(r)&&(n[r]=t.getAttribute(r))}));const r=function(t,n,r){const{dataset:e}=t,i={},s=r;for(const t in e){const n=t.match(s);n&&(i[n[1][0].toLowerCase()+n[1].substr(1)]=e[t])}return i}(t,0,m);return Object.assign(n,r),n.random=Math.random().toString(32).substr(2),Object.keys(n).forEach((t=>{n[t]&&(this.vO=this.vO.replace("${"+t+"}",encodeURIComponent(n[t])))})),this.vO=this.vO.replace(/\${[A-Za-z0-9]+}+/,(()=>"")),this.vO}}(this.cO,this.element,this.getAmpDoc()),this.mO()}mO(){return(t=this.getAmpDoc(),h(t,"navigation")).registerAnchorMutator((t=>{this.uO.handleClick(t)}),R),!0;var t}isLayoutSupported(t){return"nodisplay"===t}};t.registerElement("amp-link-rewriter",M)})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-link-rewriter-0.1.mjs.map