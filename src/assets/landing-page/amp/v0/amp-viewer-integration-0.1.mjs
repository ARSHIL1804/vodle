;
(self.AMP=self.AMP||[]).push({m:1,v:"2203281422000",n:"amp-viewer-integration",ev:"0.1",l:!0,p:"high",f:function(t,e){(()=>{function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,n=new Array(e);s<e;s++)n[s]=t[s];return n}function s(t,s){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,s){if(t){if("string"==typeof t)return e(t,s);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,s):void 0}}(t))||s&&t&&"number"==typeof t.length){n&&(t=n);var i=0;return function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n;function i(){return n||(n=Promise.resolve(void 0))}function r(t,e){const s=t.length-e.length;return s>=0&&t.indexOf(e,s)==s}var{hasOwnProperty:o,toString:h}=Object.prototype;function c(t){const e=Object.create(null);return t&&Object.assign(e,t),e}function u(t,e,s,n,i,r,o,h,c,u,l){return t}var l=self.AMP_CONFIG||{},a=("string"==typeof l.thirdPartyFrameRegex?new RegExp(l.thirdPartyFrameRegex):l.thirdPartyFrameRegex)||/^d-\d+\.ampproject\.net$/,f=("string"==typeof l.cdnProxyRegex?new RegExp(l.cdnProxyRegex):l.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function d(t){if(!self.document||!self.document.head)return null;if(self.location&&f.test(self.location.origin))return null;const e=self.document.head.querySelector(`meta[name="${t}"]`);return e&&e.getAttribute("content")||null}var _={thirdParty:l.thirdPartyUrl||"https://3p.ampproject.net",thirdPartyFrameHost:l.thirdPartyFrameHost||"ampproject.net",thirdPartyFrameRegex:a,cdn:l.cdnUrl||d("runtime-host")||"https://cdn.ampproject.org",cdnProxyRegex:f,localhostRegex:/^https?:\/\/localhost(:\d+)?$/,errorReporting:l.errorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r",betaErrorReporting:l.betaErrorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r-beta",localDev:l.localDev||!1,trustedViewerHosts:[/(^|\.)google\.(com?|[a-z]{2}|com?\.[a-z]{2}|cat)$/,/(^|\.)gmail\.(com|dev)$/],geoApi:l.geoApiUrl||d("amp-geo-api")},p=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function m(t,e=""){try{return decodeURIComponent(t)}catch(t){return e}}function P(t){const e=Object.getOwnPropertyDescriptor(t,"message");if(null!=e&&e.writable)return t;const{message:s,stack:n}=t,i=new Error(s);for(const e in t)i[e]=t[e];return i.stack=n,i}function A(t){let e=null,n="";for(var i,r=s(arguments,!0);!(i=r()).done;){const t=i.value;t instanceof Error&&!e?e=P(t):(n&&(n+=" "),n+=t)}return e?n&&(e.message=n+": "+e.message):e=new Error(n),e}function g(t,...e){const s=A.apply(null,e);s.name=t||s.name,function(t){var e,s;null===(e=(s=self).__AMP_REPORT_ERROR)||void 0===e||e.call(s,t)}(s)}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var E=self.__AMP_LOG;function v(t,e){throw new Error("failed to call initLogConstructor")}function T(t){return E.user||(E.user=y()),function(t,e){return e&&e.ownerDocument.defaultView!=t}(E.user.win,t)?E.userForEmbed||(E.userForEmbed=y()):E.user}function y(t){return v()}function w(){return E.dev||(E.dev=v())}function M(t,e,s,n,i,r,o,h,c,u,l){return t}function R(t,e,s,n,i,r,o,h,c,u,l){return T().assert(t,e,s,n,i,r,o,h,c,u,l)}function I(t,e){return k(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),e)}function b(t,e){return k(x(V(t)),e)}function V(t){return t.nodeType?(e=t,s=(e.ownerDocument||e).defaultView,I(s,"ampdoc")).getAmpDoc(t):t;var e,s}function x(t){const e=V(t);return e.isSingleDoc()?e.win:e}function k(t,e){M(S(t,e));const s=function(t){let e=t.__AMP_SERVICES;return e||(e=t.__AMP_SERVICES={}),e}(t)[e];return s.obj||(M(s.ctor),M(s.context),s.obj=new s.ctor(s.context),M(s.obj),s.context=null,s.resolve&&s.resolve(s.obj)),s.obj}function S(t,e){const s=t.__AMP_SERVICES&&t.__AMP_SERVICES[e];return!(!s||!s.ctor)}var F,H=t=>function(t,e){const s=x(V(t));return S(s,e)?k(s,e):null}(t,"hidden-observer"),N=t=>I(t,"platform"),O=t=>b(t,"viewer"),C=t=>b(t,"viewport"),L=["Webkit","webkit","Moz","moz","ms","O","o"],$={"getPropertyPriority":()=>"","getPropertyValue":()=>""};function j(t){const e=t.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()));return L.some((t=>e.startsWith(t+"-")))?`-${e}`:e}function U(t,e,s){if(J(e))return e;F||(F=c());let n=F[e];if(!n||s){if(n=e,void 0===t[e]){const s=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(e),i=function(t,e){for(let s=0;s<L.length;s++){const n=L[s]+e;if(void 0!==t[n])return n}return""}(t,s);void 0!==t[i]&&(n=i)}s||(F[e]=n)}return n}function z(t,e){const{style:s}=t;for(const t in e)s.setProperty(j(U(s,t)),String(e[t]),"important")}function D(t,e,s,n,i){const r=U(t.style,e,i);if(!r)return;const o=n?s+n:s;t.style.setProperty(j(r),o)}function Y(t,e,s){const n=U(t.style,e,s);if(n)return J(n)?t.style.getPropertyValue(n):t.style[n]}function q(t,e){for(const s in e)D(t,s,e[s])}function X(t,e){const{style:s}=t;u(""!==e&&"none"!==e),u(!s.display),s.display=e}function K(t,e){return t.getComputedStyle(e)||$}function W(t,e){for(let s=0;s<e.length;s++)D(t,e[s],null)}function J(t){return t.startsWith("--")}var B=class{static solveYValueFromXValue(t,e,s,n,i,r,o,h,c){return B.yr(B.Ir(t,e,n,r,h),s,i,o,c)}static Ir(t,e,s,n,i){const r=1e-6;let o=(t-e)/(i-e);if(o<=0)return 0;if(o>=1)return 1;let h=0,c=1,u=0;for(let l=0;l<8;l++){u=B.Mr(o,e,s,n,i);const l=(B.Mr(o+r,e,s,n,i)-u)/r;if(Math.abs(u-t)<r)return o;if(Math.abs(l)<r)break;u<t?h=o:c=o,o-=(u-t)/l}for(let l=0;Math.abs(u-t)>r&&l<8;l++)u<t?(h=o,o=(o+c)/2):(c=o,o=(o+h)/2),u=B.Mr(o,e,s,n,i);return o}static Mr(t,e,s,n,i){if(0==t)return e;if(1==t)return i;let r=B.Rr(e,s,t),o=B.Rr(s,n,t);const h=B.Rr(n,i,t);return r=B.Rr(r,o,t),o=B.Rr(o,h,t),B.Rr(r,o,t)}static yr(t,e,s,n,i){if(0==t)return e;if(1==t)return i;let r=B.Rr(e,s,t),o=B.Rr(s,n,t);const h=B.Rr(n,i,t);return r=B.Rr(r,o,t),o=B.Rr(o,h,t),B.Rr(r,o,t)}static Rr(t,e,s){return t+s*(e-t)}},Z={LINEAR:t=>t,EASE:t=>B.solveYValueFromXValue(t,0,0,.25,.1,.25,1,1,1),EASE_IN:t=>B.solveYValueFromXValue(t,0,0,.42,0,1,1,1,1),EASE_OUT:t=>B.solveYValueFromXValue(t,0,0,0,0,.58,1,1,1),EASE_IN_OUT:t=>B.solveYValueFromXValue(t,0,0,.42,0,.58,1,1,1)},G={"linear":Z.LINEAR,"ease":Z.EASE,"ease-in":Z.EASE_IN,"ease-out":Z.EASE_OUT,"ease-in-out":Z.EASE_IN_OUT};function Q(t){if(!t)return null;if("string"==typeof t){if(-1!=(t=t).indexOf("cubic-bezier")){const r=t.match(/cubic-bezier\((.+)\)/);if(r){const t=r[1].split(",").map(parseFloat);if(4==t.length){for(let e=0;e<4;e++)if(isNaN(t[e]))return null;return e=t[0],s=t[1],n=t[2],i=t[3],t=>B.solveYValueFromXValue(t,0,0,e,s,n,i,1,1)}}return null}return G[t]}var e,s,n,i;return t}var tt,et="Animation",st=function(){},nt=class{static animate(t,e,s,n){return new nt(t).setCurve(n).add(0,e,1).start(s)}constructor(t,e){this.wr=t,this.br=e||I(self,"vsync"),this.Vr=null,this.Sr=[]}setCurve(t){return t&&(this.Vr=Q(t)),this}add(t,e,s,n){return this.Sr.push({delay:t,func:e,duration:s,curve:Q(n)}),this}start(t){return new it(this.br,this.wr,this.Sr,this.Vr,t)}},it=class{constructor(t,e,s,n,i){this.br=t,this.wr=e,this.Sr=[];for(let t=0;t<s.length;t++){const e=s[t];this.Sr.push({delay:e.delay,func:e.func,duration:e.duration,curve:e.curve||n,started:!1,completed:!1})}this.Or=i,this.hr=Date.now(),this.Re=!0,this.mi={};const r=new class{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}};this.Cr=r.promise,this.Xs=r.resolve,this.kr=r.reject,this.Nr=this.br.createAnimTask(this.wr,{mutate:this.Dr.bind(this)}),this.br.canAnimate(this.wr)?this.Nr(this.mi):this.Lr(!1,0)}then(t,e){return t||e?this.Cr.then(t,e):this.Cr}thenAlways(t){const e=t||st;return this.then(e,e)}halt(t){this.Lr(!1,t||0)}Lr(t,e){if(this.Re){if(this.Re=!1,0!=e){this.Sr.length>1&&this.Sr.sort(((t,e)=>t.delay+t.duration-(e.delay+e.duration)));try{if(e>0)for(let t=0;t<this.Sr.length;t++)this.Sr[t].func(1,!0);else for(let t=this.Sr.length-1;t>=0;t--)this.Sr[t].func(0,!1)}catch(e){w().error(et,"completion failed: "+e,e),t=!1}}t?this.Xs():this.kr()}}Dr(t){if(!this.Re)return;const e=Date.now(),s=Math.min((e-this.hr)/this.Or,1);for(let t=0;t<this.Sr.length;t++){const e=this.Sr[t];!e.started&&s>=e.delay&&(e.started=!0)}for(let t=0;t<this.Sr.length;t++){const e=this.Sr[t];e.started&&!e.completed&&this.Ur(e,s)}1==s?this.Lr(!0,0):this.br.canAnimate(this.wr)?this.Nr(this.mi):this.Lr(!1,0)}Ur(t,e){let s,n;if(t.duration>0){if(s=Math.min((e-t.delay)/t.duration,1),n=s,t.curve&&1!=n)try{n=t.curve(s)}catch(t){return w().error(et,"step curve failed: "+t,t),void this.Lr(!1,0)}}else s=1,n=1;1==s&&(t.completed=!0);try{t.func(n,t.completed)}catch(t){return w().error(et,"step mutate failed: "+t,t),void this.Lr(!1,0)}}},rt="FixedLayer",ot="i-amphtml-lightbox",ht="i-amphtml-lightbox-element";function ct(t){return-1!==t.tagName.indexOf("LIGHTBOX")}function ut(t,e,s,n){let i=t,r=s,o=t=>{try{return r(t)}catch(t){var e,s;throw null===(e=(s=self).__AMP_REPORT_ERROR)||void 0===e||e.call(s,t),t}};const h=function(){if(void 0!==tt)return tt;tt=!1;try{const t={get capture(){return tt=!0,!1}};self.addEventListener("test-options",null,t),self.removeEventListener("test-options",null,t)}catch(t){}return tt}(),c=!(null==n||!n.capture);return i.addEventListener(e,o,h?n:c),()=>{null==i||i.removeEventListener(e,o,h?n:c),r=null,i=null,o=null}}function lt(t,e,s,n){return ut(t,e,s,n)}function at(t,e,s,n){let i=s;const r=ut(t,e,(t=>{try{i(t)}finally{i=null,r()}}),n);return r}function ft(t){return"loading"!=t.readyState&&"uninitialized"!=t.readyState}function dt(t,e,s){return 0==e&&0==s||0==t.width&&0==t.height?t:{left:n=t.left+e,top:i=t.top+s,width:r=t.width,height:o=t.height,bottom:i+o,right:n+r,x:n,y:i};var n,i,r,o}function _t(t){return t.node.wholeText[t.offset]}var pt=/[,.\s\u2022()]/;function mt(t){return"’"==t||"‘"==t?"'":"“"==t||"”"==t?'"':t.toLowerCase()}function Pt(t){const e=[];for(let s=0;s<t.length;s++){const n=t[s];pt.test(n)||e.push(mt(n))}return e.join("")}var At=class{constructor(t,e){this.eE=t,this.sE=e,this.matches=[],this.nE={},this.iE=t.length-1;for(let e=0;e<t.length;e++){const s=t[e];this.nE[s]=t.length-1-e}}update(){if(this.iE>0)return void this.iE--;const{sE:t,eE:e}=this,s=t.size();for(let n=0;n<e.length;n++){const i=mt(_t(t.get(s-1-n).pos));if(e[e.length-1-n]==i)continue;let r=this.nE[i];return null==r&&(r=e.length),r-=n,r<1&&(r=1),void(this.iE=r-1)}const n=t.get(s-1),i=n.pos;this.matches.push({start:t.get(s-e.length),end:{pos:{node:i.node,offset:i.offset+1},idx:n.idx+1}})}};function gt(t,e,s,n){for(let i=s;i<n.length;i++){const s=n[i];if(t.node!=s.start.node)return;if(s.start.node=e,s.start.offset-=t.offset,t.node!=s.end.node)return;s.end.node=e,s.end.offset-=t.offset}}function Et(t,e,s,n,i,r){for(;;){if(e.node==s.node){const o=vt(t,e.node,e.offset,s.offset,r);return void(o&&gt(s,o,i+1,n))}const o=Tt(t,e.node);if(vt(t,e.node,e.offset,e.node.wholeText.length,r),!o)break;e={node:o,offset:0}}}function vt(t,e,s,n,i){if(s>=n)return null;const r=t.document,{parentNode:o,wholeText:h}=e;s>0&&o.insertBefore(r.createTextNode(h.substring(0,s)),e);const c=r.createElement("span");c.appendChild(r.createTextNode(h.substring(s,n))),o.insertBefore(c,e),i.push(c);let u=null;return n<h.length&&(u=r.createTextNode(h.substring(n)),o.insertBefore(u,e)),o.removeChild(e),u}function Tt(t,e){let s=!0,n=e;for(;;){if(null==n)return null;if(s){const t=n.nextSibling;t?(n=t,s=!1):n=n.parentNode}else{if(n instanceof t.Text)return n;n.firstChild?n=n.firstChild:s=!0}}}var yt=class{constructor(t,e){if(this.i=t,this.rE=e,this.oE=-1,this.hE=null,e instanceof t.Text)this.oE=0;else if(e instanceof t.Element){const{display:s}=K(t,e);if("none"==s)return;const n=e.firstChild;null!=n&&(this.hE=new yt(t,n))}}next(){if(this.oE>=0)return this.cE();for(;null!=this.hE;){const t=this.hE.next();if(null!=t)return t;const e=this.hE.rE.nextSibling;this.hE=null!=e?new yt(this.i,e):null}return null}cE(){const t=this.rE.wholeText;if(this.oE<t.length){const t=this.oE;return this.oE++,{node:this.rE,offset:t}}return null}},wt=["key","code","location","ctrlKey","shiftKey","altKey","metaKey","repeat","isComposing","charCode","keyCode","which"],Mt="amp-viewer-messaging",Rt="channelOpen",It="__AMPHTML__";function bt(t){if("string"!=typeof t)return t;if("{"!=t.charAt(0))return null;try{return JSON.parse(t)}catch(t){return null}}var Vt,xt=class{constructor(t,e,s){this.i=t,this.h=e,this.o=s}addEventListener(t,e){this.i.addEventListener("message",(t=>{t.origin==this.h&&t.source==this.o&&e(t)}))}postMessage(t){const e="null"===this.h?"*":this.h;this.o.postMessage(t,e)}start(){}},kt=class{static initiateHandshakeWithDocument(t,e){return new Promise((s=>{const n=setInterval((()=>{const i=new MessageChannel,r={app:It,name:"handshake-poll"};t.postMessage(r,"*",[i.port2]);const o=i.port1,h=t=>{const i=bt(t.data);if(i&&i.app===It&&i.name===Rt){clearInterval(n),o.removeEventListener("message",h);const t=new kt(null,o,!1,e,!0);t.t(i.requestid,Rt,null),s(t)}};o.addEventListener("message",h),o.start()}),1e3)}))}static waitForHandshakeFromDocument(t,e,s,n,i){return new Promise((r=>{const o=h=>{const c=bt(h.data);if(c&&(h.origin==s||i&&i.test(h.origin))&&(!h.source||h.source==e)&&c.app===It&&c.name===Rt){t.removeEventListener("message",o);const s=new xt(t,h.origin,e),i=new kt(null,s,!1,n,!0);i.t(c.requestid,Rt,null),r(i)}};t.addEventListener("message",o)}))}constructor(t,e,s,n,i){this.i=t,this.l=e,this.u=!!s,this._=n||null,this.p=!!i,this.g=0,this.m={},this.P={},this.A=null,this.l.addEventListener("message",this.R.bind(this)),this.l.start()}registerHandler(t,e){this.P[t]=e}unregisterHandler(t){delete this.P[t]}setDefaultHandler(t){this.A=t}R(t){const e=bt(t.data);e&&e.app===It&&(this._&&this.p&&e.messagingToken!==this._?this.M(Mt+": handleMessage_ error: ","invalid token"):"q"===e.type?this.q(e):"s"===e.type&&this.v(e))}sendRequest(t,e,s){const n=++this.g;let i;return s&&(i=new Promise(((t,e)=>{this.m[n]={resolve:t,reject:e}}))),this.I({app:It,requestid:n,type:"q",name:t,data:e,rsvp:s}),i}t(t,e,s){this.I({app:It,requestid:t,type:"s",name:e,data:s})}T(t,e,s){const n=this.V(s);this.M(Mt+": sendResponseError_, message name: "+e,n),this.I({app:It,requestid:t,type:"s",name:e,data:null,error:n})}I(t){const e=Object.assign(t,{});this._&&!this.p&&(e.messagingToken=this._),this.l.postMessage(this.u?JSON.stringify(e):e)}q(t){let e=this.P[t.name];if(e||(e=this.A),!e){const e=new Error("Cannot handle request because no default handler is set!");throw e.args=t.name,e}const s=e(t.name,t.data,!!t.rsvp);if(t.rsvp){const e=t.requestid;if(!s)throw this.T(e,t.name,new Error("no response")),new Error("expected response but none given: "+t.name);s.then((s=>{this.t(e,t.name,s)}),(s=>{this.T(e,t.name,s)}))}}v(t){const e=t.requestid,s=this.m[e];s&&(delete this.m[e],t.error?(this.M(Mt+": handleResponse_ error: ",t.error),s.reject(new Error(`Request ${t.name} failed: ${t.error}`))):s.resolve(t.data))}M(t,e){if(!this.i)return;let s="amp-messaging-error-logger: "+t;s+=" data: "+this.V(e),this.i.viewerState=s}V(t){return t?t.message?t.message:String(t):"unknown error"}},St=["altKey","charCode","ctrlKey","detail","eventPhase","key","layerX","layerY","metaKey","pageX","pageY","returnValue","shiftKey","timeStamp","type","which"],Ft=["clientX","clientY","force","identifier","pageX","pageY","radiusX","radiusY","screenX","screenY"],Ht=new Set(["c","v","a","ad"]),Nt=t=>"string"==typeof t?function(t,e){return Vt||(Vt=self.document.createElement("a")),function(t,e,s){return t.href="",new URL(e,t.href)}(Vt,t)}(t):t;new class{constructor(t){this.win=t,this.uE=!1,this.lE=!1,this.aE=null}init(){const t=V(this.win.document),e=O(t);this.uE="1"==e.getParam("webview"),this.lE=e.hasCapability("handshakepoll");const s=e.getParam("messagingToken"),n=e.getParam("origin")||"";if(!this.uE&&!n)return i();if(C(t).createFixedLayer(class{constructor(t,e,s,n,i){this.ampdoc=t,this.br=e,this.fE=s,this.Gr=n,this.dE=n,this._E=i&&t.isSingleDoc(),this.pE=null,this.mE=0,this.ct=[],this.PE=new class{constructor(t,e,s){this.Ee=k(t,"timer"),this.Te=e,this.ye=s||0,this.Ie=-1,this.Me=0,this.Re=!1,this.we=()=>{this.be()}}isPending(){return-1!=this.Ie}schedule(t){let e=t||this.ye;this.Re&&e<10&&(e=10);const s=Date.now()+e;return(!this.isPending()||s-this.Me<-10)&&(this.cancel(),this.Me=s,this.Ie=this.Ee.delay(this.we,e),!0)}be(){this.Ie=-1,this.Me=0,this.Re=!0,this.Te(),this.Re=!1}cancel(){this.isPending()&&(this.Ee.cancel(this.Ie),this.Ie=-1)}}(t.win,(()=>this.update())),this.AE=null,this.gE=[],this.EE=[]}enterLightbox(t,e){const s=this.vE();s&&s.setLightboxMode(!0),t&&e&&e.then((()=>this.TE(t,!0)))}leaveLightbox(){const t=this.vE();t&&t.setLightboxMode(!1);const e=function(t,e){const s=[];let n=0;for(let e=0;e<t.length;e++){const i=t[e];i.lightboxed?s.push(i):(n<e&&(t[n]=i),n++)}return n<t.length&&(t.length=n),s}(this.ct);this.yE(e),this.ct.length||this.wE()}setup(){if(!O(this.ampdoc).isEmbedded())return!1;const t=this.ampdoc.getRootNode(),e=t.styleSheets;if(!e)return!0;this.gE.length=0,this.EE.length=0;for(let t=0;t<e.length;t++){const s=e[t];if(!s)return w().error(rt,"Aborting setup due to null stylesheet."),!0;const{disabled:n,ownerNode:i}=s;n||!i||"STYLE"!=i.tagName||i.hasAttribute("amp-boilerplate")||i.hasAttribute("amp-runtime")||i.hasAttribute("amp-extension")||this.ME(s.cssRules)}this.TE(t),this.ct.length>0&&this.observeHiddenMutations();const s=N(this.ampdoc.win);return this.ct.length>0&&!this._E&&s.isIos(),!0}TE(t,e){this.RE(t,e),this.IE(),this.update()}observeHiddenMutations(){this.bE()}wE(){this.PE.cancel();const t=this.AE;t&&(t(),this.AE=null)}bE(){if(this.AE)return;const t=this.ampdoc.getRootNode(),e=t.documentElement||t,s=H(e);this.AE=s.add((()=>{this.PE.isPending()||this.PE.schedule(16)}))}updatePaddingTop(t,e){this.Gr=t,e||(this.dE=t),this.update()}transformMutate(t){t?this.ct.forEach((e=>{e.fixedNow&&e.top&&(D(e.element,"transition","none"),e.transform&&"none"!=e.transform?D(e.element,"transform",e.transform+" "+t):D(e.element,"transform",t))})):this.ct.forEach((t=>{t.fixedNow&&t.top&&q(t.element,{transform:"",transition:""})}))}addElement(t,e){return this.VE(t,"*","fixed",e)?(this.IE(),this.observeHiddenMutations(),this.update()):i()}removeElement(t){const e=this.xE(t);this.yE(e)}yE(t){t.length>0&&this.pE&&this.br.mutate((()=>{for(let e=0;e<t.length;e++){const s=t[e];"fixed"==s.position&&this.pE.returnFrom(s)}}))}isDeclaredFixed(t){return!!t.__AMP_DECLFIXED}isDeclaredSticky(t){return!!t.__AMP_DECLSTICKY}update(){if(this.ct.filter((t=>!this.ampdoc.contains(t.element))).forEach((t=>this.xE(t.element))),0==this.ct.length)return i();this.PE.cancel();let t=!1;return this.br.runPromise({measure:e=>{const s=this.ct,n=[],{win:i}=this.ampdoc;for(let t=0;t<s.length;t++)z(s[t].element,{top:"",bottom:"-9999vh",transition:"none"});for(let t=0;t<s.length;t++)n.push(K(i,s[t].element).top);for(let t=0;t<s.length;t++)D(s[t].element,"bottom","");for(let o=0;o<s.length;o++){const h=s[o],{element:c,forceTransfer:u}=h,l=K(i,c),{offsetHeight:a,offsetTop:f,offsetWidth:d}=c,{bottom:_,display:p="",position:m="",zIndex:P}=l,A=parseFloat(l.opacity),g=l[U(l,"transform")];let{top:E}=l;const v="fixed"===m&&(u||d>0&&a>0),T=r(m,"sticky");if("none"===p||!v&&!T){e[h.id]={fixed:!1,sticky:!1,transferrable:!1,top:"",zIndex:""};continue}"auto"!==E&&n[o]===E||(E=v&&f===this.dE+this.fE?"0px":"");let y=!1;v&&(y=!0===u||!1!==u&&A>0&&a<300&&!(!E&&!_)),y&&(t=!0),e[h.id]={fixed:v,sticky:T,transferrable:y,top:E,zIndex:P,transform:g}}},mutate:e=>{t&&this._E&&this.vE().update();const s=this.ct;for(let t=0;t<s.length;t++){const n=s[t],i=e[n.id];D(n.element,"transition","none"),D(n.element,"transition",""),i&&this.kE(n,t,i)}}},{}).catch((t=>{w().error(rt,"Failed to mutate fixed elements:",t)}))}RE(t,e){try{this.SE(t,e)}catch(t){w().error(rt,"Failed to setup fixed elements:",t)}}SE(t,e){for(let s=0;s<this.gE.length;s++){const n=this.gE[s],i=t.querySelectorAll(n);for(let t=0;t<i.length&&!(this.ct.length>10);t++)this.VE(i[t],n,"fixed",void 0,e)}for(let s=0;s<this.EE.length;s++){const n=this.EE[s],i=t.querySelectorAll(n);for(let t=0;t<i.length;t++)this.VE(i[t],n,"sticky",void 0,e)}}FE(t){t.hasAttribute("style")&&(Y(t,"top")||Y(t,"bottom"))&&T().error(rt,"Inline styles with `top`, `bottom` and other CSS rules are not supported yet for fixed or sticky elements (#14186). Unexpected behavior may occur.",t)}VE(t,e,s,n,i){if(n||this.FE(t),ct(t))return!1;const r=function(t,e,s){let n;for(n=t;n&&void 0!==n;n=n.parentElement)if(e(n))return n;return null}(t,ct);if(!i&&r)return!1;const o=this.ct,h=[];for(let e=0;e<o.length;e++){const s=o[e].element;if(s===t)break;if(s.contains(t))return!1;t.contains(s)&&h.push(s)}for(let t=0;t<h.length;t++)this.removeElement(h[t]);let c=null;for(let e=0;e<o.length;e++){const n=o[e];if(n.element==t&&n.position==s){c=n;break}}const u="fixed"==s;if(c)c.selectors.includes(e)||c.selectors.push(e);else{const n="F"+this.mE++;t.setAttribute("i-amphtml-fixedid",n),u?t.__AMP_DECLFIXED=!0:t.__AMP_DECLSTICKY=!0,c={id:n,element:t,position:s,selectors:[e],fixedNow:!1,stickyNow:!1,lightboxed:!!r},o.push(c)}return c.forceTransfer=!!u&&n,!0}xE(t){const e=[];for(let s=0;s<this.ct.length;s++){const n=this.ct[s];n.element===t&&(n.lightboxed||this.br.mutate((()=>{D(t,"top","")})),this.ct.splice(s,1),e.push(n))}return this.ct.length||this.wE(),e}IE(){this.ct.sort(((t,e)=>{return(s=t.element)===(n=e.element)?0:s.compareDocumentPosition(n)&(Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINS)?1:-1;var s,n}))}kE(t,e,s){const{element:n,fixedNow:i}=t;t.fixedNow=s.fixed,t.stickyNow=s.sticky,t.top=s.fixed||s.sticky?s.top:"",t.transform=s.transform,!i||s.fixed&&s.transferrable||!this.pE||this.pE.returnFrom(t),s.top&&(s.fixed||s.sticky)&&!t.lightboxed&&(s.fixed||!this._E?D(n,"top",`calc(${s.top} + ${this.Gr}px)`):this.dE===this.Gr?D(n,"top",s.top):D(n,"top",`calc(${s.top} - ${this.dE}px)`)),this._E&&s.fixed&&s.transferrable&&this.vE().transferTo(t,e,s)}vE(){if(!this._E||this.pE)return this.pE;const t=this.ampdoc.win.document;return this.pE=new class{constructor(t,e){var s;this.am=t,this.br=e,this.HE=t.body.cloneNode(!1),this.HE.removeAttribute("style"),q(this.HE,("display"in(s={position:"absolute",top:0,left:0,height:0,width:0,pointerEvents:"none",overflow:"hidden",animation:"none",background:"none",border:"none",borderImage:"none",boxSizing:"border-box",boxShadow:"none",float:"none",margin:0,opacity:1,outline:"none",padding:"none",transform:"none",transition:"none"})&&g("STYLE","`display` style detected. You must use toggle instead."),s)),X(this.HE,"block"),t.documentElement.appendChild(this.HE)}getRoot(){return this.HE}setLightboxMode(t){this.br.mutate((()=>{const e=this.getRoot();t?e.setAttribute(ot,""):e.removeAttribute(ot)}))}update(){const{body:t}=this.am,e=this.HE,s=t.attributes,n=e.attributes;for(let t=0;t<s.length;t++){const e=s[t];"style"!==e.name&&n.setNamedItem(e.cloneNode(!1))}for(let s=0;s<n.length;s++){const{name:i}=n[s];"style"===i||i===ot||t.hasAttribute(i)||(e.removeAttribute(i),s--)}}transferTo(t,e,s){const{element:n}=t;if(n.parentElement!=this.HE){if(!t.placeholder){D(n,"pointer-events","initial");const e=t.placeholder=this.am.createElement("i-amphtml-fpa");!function(t,e){void 0===e&&(e=t.hasAttribute("hidden")),e?t.removeAttribute("hidden"):t.setAttribute("hidden","")}(e,!1),e.setAttribute("i-amphtml-fixedid",t.id)}D(n,"zIndex",`calc(${1e4+e} + ${s.zIndex||0})`),t.lightboxed&&n.classList.add(ht),n.parentElement.replaceChild(t.placeholder,n),this.HE.appendChild(n),t.selectors.some((t=>this.NE(n,t)))||this.returnFrom(t)}}returnFrom(t){if(!t.placeholder||!this.am.contains(t.placeholder))return;const{element:e,placeholder:s}=t;t.lightboxed&&e.classList.remove(ht),this.am.contains(e)?(D(t.element,"zIndex",""),s.parentElement.replaceChild(e,s)):s.parentElement.removeChild(s)}NE(t,e){try{return function(t,e){const s=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector;return!!s&&s.call(t,e)}(t,e)}catch(t){return w().error(rt,"Failed to test query match:",t),!1}}}(t,this.br),this.pE}ME(t){for(let e=0;e<t.length;e++){const s=t[e];if(4!=s.type&&12!=s.type){if(1==s.type){const{selectorText:t}=s,{position:e}=s.style;if("*"===t||!e)continue;"fixed"===e?this.gE.push(t):r(e,"sticky")&&this.EE.push(t)}}else this.ME(s.cssRules)}}animateFixedElements(t,e,s,n,r){return this.updatePaddingTop(t,r),s<=0?i():nt.animate(this.ampdoc.getRootNode(),(s=>{const n=(s=>e-t+(t-e)*s)(s);this.transformMutate(`translateY(${n}px)`)}),s,n).thenAlways((()=>{this.transformMutate(null)}))}}),this.uE||this.lE){const i=(o=this.win).parent&&o.parent!=o?this.win.parent:null;return this.OE(i,n).then((i=>this.CE(e,t,n,new kt(this.win,i,this.uE,s))))}var o;const h=function(t){const e=function(t){const e=c();if(!t)return e;let s;for(;s=p.exec(t);){const t=m(s[1],s[1]),n=s[2]?m(s[2].replace(/\+/g," "),s[2]):"";e[t]=n}return e}(t.win.location.hash).highlight;if(!e||e.length>102400)return null;const s=(n=e,JSON.parse(n));var n;const i=s.s;if(!(i instanceof Array)||i.length>15)return null;let r=0;for(let t=0;t<i.length;t++){const e=i[t];if("string"!=typeof e||!e)return null;if(r+=e.length,r>1500)return null}let o=!1;s.n&&(o=!0);let h=!1;return s.na&&(h=!0),{sentences:i,skipScrollAnimation:h,skipRendering:o}}(t);h&&(this.aE=new class{constructor(t,e){this.Ci=t,this.Ue=O(t),this.bn=C(this.Ci),this.LE=null;const s=N(this.Ci.win);var n;"fragmentDirective"in document&&s.isChrome()&&s.getMajorVersion()>=93?t.whenFirstVisible().then((()=>this.$E(e))):(n=t.win.document,new Promise((t=>{!function(t,e){!function(t,e,s){let n=e(t);if(n)s(t);else{const i=()=>{e(t)&&(n||(n=!0,s(t)),t.removeEventListener("readystatechange",i))};t.addEventListener("readystatechange",i)}}(t,ft,e)}(n,t)}))).then((()=>{this.jE(e)}))}$E(t){const{sentences:e}=t;if(null==e||!e.length)return;const s=e.map((t=>"text="+encodeURIComponent(t))).join("&");this.UE(s)}UE(t){const{hash:e}=this.Ci.win.location;e?this.Ci.win.location.replace(e+":~:"+t):this.Ci.win.location.replace("#:~:"+t)}zE(t,e){const s={"state":t};for(const t in e)s[t]=e[t];this.Ue.sendMessage("highlightState",s)}DE(t){const{win:e}=this.Ci,s=function(t,e,s){if(s=function(t){const e=[];for(let s=0;s<t.length;s++){const n=Pt(t[s]);n&&e.push(n)}return e}(s),s.length<=0)return null;const n=new yt(t,e),i=new class{constructor(t){this.YE=t,this.qE=[],this.xe=0}push(t){this.qE[this.xe]=t,this.xe=(this.xe+1)%this.YE}get(t){return this.qE.length>=this.YE&&(t=(this.xe+t)%this.YE),this.qE[t]}size(){return this.qE.length}}(s.map((t=>t.length)).reduce(((t,e)=>Math.max(t,e)))),r=[new At(s[0],i)];let o=-1;for(;;){o++;const t=n.next();if(null==t)return null;if(!pt.test(_t(t))){i.push({pos:t,idx:o});for(let t=0;t<r.length;t++)r[t].update();if(0!=r[r.length-1].matches.length){if(r.length==s.length)break;r.push(new At(s[r.length],i))}}}const h=[];t:for(let t=s.length-1;t>=0;t--){const e=r[t].matches;if(0==h.length){h.push(e[e.length-1]);continue}const s=h[h.length-1];for(let t=e.length-1;t>=0;t--){const n=e[t];if(s.start.idx>=n.end.idx){h.push(n);continue t}}M(!1)}const c=[];for(let t=h.length-1;t>=0;t--){const e=h[t];c.push({start:e.start.pos,end:e.end.pos})}return c}(e,this.Ci.getBody(),t.sentences);if(!s)return;const n=function(t,e){e=function(t){const e=[];let s=null;for(let n=0;n<t.length;n++){const i=t[n];s&&s.end.node==i.start.node&&s.end.offset==i.start.offset?s.end=i.end:(s=i,e.push(i))}return e}(e);const s=[];for(let n=0;n<e.length;n++){const i=e[n];Et(t,i.start,i.end,e,n,s)}return s}(e,s);n&&0!=n.length&&(this.LE=n)}onVisibleOnce(t){t=function(t){let e=!1,s=null,n=t;return(...t)=>(e||(s=n.apply(self,t),e=!0,n=null),s)}(t),this.Ci.onVisibilityChanged((()=>{"visible"==this.Ci.getVisibilityState()&&t()}))}jE(t){if(this.Ci.win.document.querySelector('script[id="amp-access"]'))return void this.zE("has_amp_access");if(this.DE(t),!this.LE)return void this.zE("not_found");const e=this.XE();if(this.zE("found",{"scroll":e}),t.skipRendering)return;for(let t=0;t<this.LE.length;t++)q(this.LE[t],{backgroundColor:"#fcff00",color:"#000"});const s=this.Ci.getVisibilityState();t.skipScrollAnimation?"visible"==s?this.KE(e):(this.bn.setScrollTop(e),this.onVisibleOnce((()=>{this.KE(this.XE())}))):"visible"==s?this.WE(e):(this.JE(e),this.onVisibleOnce((()=>{this.WE(this.XE())}))),at(this.Ci.getBody(),"click",this.BE.bind(this))}XE(){const t=this.LE;if(!t)return 0;const e=this.bn;let s=Number.MAX_VALUE,n=0;const i=e.getPaddingTop();for(let r=0;r<t.length;r++){const{bottom:o,top:h}=dt(e.getLayoutRect(t[r]),0,-i);s=Math.min(s,h),n=Math.max(n,o)}if(s>=n)return 0;let r=(n+s-(e.getHeight()-i))/2;return r>s-80&&(r=s-80),r>0?r:0}KE(t){this.zE("auto_scroll"),this.bn.setScrollTop(t),this.zE("shown")}JE(t){const e=Math.max(0,t-500);this.bn.setScrollTop(e)}ZE(t){const e=this.XE(),s=this.bn.getScrollTop();if(s==e&&s==t)return null;const n={};return s!=e&&(this.bn.setScrollTop(e),n.nd=s-e),s!=t&&(n.od=s-t),n}WE(t){this.JE(t);const e=this.Ci.win.document.createElement("div");X(e,"block"),q(e,{"position":"absolute","top":Math.floor(t)+"px","height":"1px","left":"0","width":"1px","pointer-events":"none"});const s=this.Ci.getBody();s.appendChild(e),this.zE("auto_scroll"),this.bn.animateScrollIntoView(e).then((()=>{s.removeChild(e),this.zE("shown",this.ZE(t))}))}setupMessaging(t){t.registerHandler("highlightDismiss",this.BE.bind(this))}BE(){if(this.LE)for(let t=0;t<this.LE.length;t++)W(this.LE[t],["backgroundColor","color"])}}(t,h));const u=new xt(this.win,n,this.win.parent);return this.CE(e,t,n,new kt(this.win,u,this.uE,s))}OE(t,e){return new Promise((s=>{const n=lt(this.win,"message",(i=>{const r=bt(i.data);if(r&&i.origin===e&&i.source===t&&"__AMPHTML__"==r.app&&"handshake-poll"==r.name){if(this.uE&&(!i.ports||!i.ports.length))throw new Error("Did not receive communication port from the Viewer!");const t=i.ports&&i.ports.length>0?i.ports[0]:new xt(this.win,e,this.win.parent);s(t),n()}}))}))}CE(t,e,s,n){const i=e.getUrl(),r=function(t){if(!function(t){return _.cdnProxyRegex.test(Nt(t).origin)}(t=Nt(t)))return t.href;const e=t.pathname.split("/"),s=e[1];R(Ht.has(s),"Unknown path prefix in url %s",t.href);const n=e[2],i="s"==n?"https://"+decodeURIComponent(e[3]):"http://"+decodeURIComponent(n);return R(i.indexOf(".")>0,"Expected a . in origin %s",i),e.splice(1,"s"==n?3:2),i+e.join("/")+function(t,e){if(!t||"?"==t)return"";const s=new RegExp("[?&](amp_(js[^&=]*|gsa|r|kit)|usqp)\\b[^&]*","g"),n=t.replace(s,"").replace(/^[?&]/,"");return n?"?"+n:""}(t.search)+(t.hash||"")}(i);return n.sendRequest("channelOpen",{"url":i,"sourceUrl":r},!0).then((()=>{this.Wr(n,t,s)}))}Wr(t,e,s){t.setDefaultHandler(((t,s,n)=>e.receiveMessage(t,s,n))),e.setMessageDeliverer(t.sendRequest.bind(t),s),at(this.win,"unload",this.GE.bind(this,t)),(e.hasCapability("swipe")||e.hasCapability("touch"))&&this.QE(t),e.hasCapability("keyboard")&&this.tT(t),e.hasCapability("focus-rect")&&this.eT(t),null!=this.aE&&this.aE.setupMessaging(t)}GE(t){return t.sendRequest("unloaded",{},!0)}eT(t){new class{constructor(t,e){this.win=t,this.S=e,this.sT()}sT(){lt(this.win.document,"focusin",this.nT.bind(this),{capture:!1})}nT(t){t.defaultPrevented||this.S.sendRequest(t.type,{"focusTargetRect":t.target.getBoundingClientRect()},!1)}}(this.win,t)}QE(t){new class{constructor(t,e){this.win=t,this.S=e,this.iT=!1,this.rT=[],e.registerHandler("scrollLock",this.oT.bind(this)),this.hT()}hT(){const t=this.yw.bind(this),e=this.win.document,s={capture:!1,passive:!this.iT};this.rT.push(lt(e,"touchstart",t,s),lt(e,"touchend",t,s),lt(e,"touchmove",t,s))}Wv(){this.rT.forEach((t=>t())),this.rT.length=0}yw(t){switch(t.type){case"touchstart":case"touchend":case"touchmove":this.cT(t);break;default:return}}cT(t){if(null!=t&&t.shouldViewerCancelPropagation)t.stopImmediatePropagation();else{if(t&&t.type){const e=this.uT(t);this.S.sendRequest(t.type,e,!1)}this.iT&&t.cancelable&&t.preventDefault()}}uT(t){const e=this.lT(t,St);return t.touches&&(e.touches=this.aT(t.touches)),t.changedTouches&&(e.changedTouches=this.aT(t.changedTouches)),e}aT(t){const e=[];for(let s=0;s<t.length;s++)e.push(this.lT(t[s],Ft));return e}lT(t,e){const s={};for(let n=0;n<e.length;n++){const i=e[n];void 0!==t[i]&&(s[i]=t[i])}return s}oT(t,e,s){return this.iT=!!e,this.Wv(),this.hT(),s?Promise.resolve({}):void 0}}(this.win,t)}tT(t){new class{constructor(t,e){this.win=t,this.S=e,this.fT()}fT(){const t=this.yw.bind(this);lt(this.win,"keydown",t),lt(this.win,"keypress",t),lt(this.win,"keyup",t)}yw(t){(function(t){if(t.defaultPrevented)return!0;if("Escape"==t.key)return!1;switch(t.target.nodeName){case"INPUT":return"checkbox"!=t.target.type||" "==t.key;case"TEXTAREA":case"BUTTON":case"SELECT":case"OPTION":return!0}return t.target.hasAttribute&&t.target.hasAttribute("contenteditable")})(t)||this.nT(t)}nT(t){this.S.sendRequest(t.type,function(t){const e={};return wt.forEach((s=>{void 0!==t[s]&&(e[s]=t[s])})),e}(t),!1)}}(this.win,t)}}(t.win).init()})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-viewer-integration-0.1.mjs.map