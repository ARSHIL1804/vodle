"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5004],{5004:(U,g,p)=>{p.r(g),p.d(g,{PreviewpollPageModule:()=>L});var _=p(6362),d=p(587),u=p(8139),o=p(3926),a=p(1951),e=p(260),m=p(6301);function x(i,n){if(1&i&&(e.TgZ(0,"ion-text",7),e._UZ(1,"i",2),e.qZA()),2&i){const t=e.oxw(3);e.xp6(1),e.Q6J("innerHtml",t.p.desc,e.oJD)}}function h(i,n){1&i&&(e.TgZ(0,"span"),e._uU(1,"\xa0"),e.qZA())}function P(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"ion-text",18),e.YNc(1,h,2,0,"span",3),e._uU(2," ("),e.TgZ(3,"ion-text",19),e.NdJ("click",function(){e.CHM(t);const l=e.oxw(3);return l.G.open_url_in_new_tab(l.G.D.fix_url(l.p.url))}),e.ALo(4,"translate"),e.qZA(),e._uU(5,") "),e.qZA()}if(2&i){const t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",""!=(t.p.desc||"")&&""!=(t.p.url||"")),e.xp6(2),e.Q6J("innerHtml",e.lcZ(4,2,"read-more"),e.oJD)}}function f(i,n){if(1&i&&(e.TgZ(0,"p"),e.YNc(1,x,2,1,"ion-text",16),e.YNc(2,P,6,4,"ion-text",17),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",""!=(t.p.desc||"")),e.xp6(1),e.Q6J("ngIf",""!=(t.p.url||""))}}function v(i,n){1&i&&(e._UZ(0,"ion-text",20),e.ALo(1,"translate")),2&i&&e.Q6J("innerHtml",e.lcZ(1,1,"previewpoll.is-in-past"),e.oJD)}function Z(i,n){if(1&i&&(e.TgZ(0,"p")(1,"small"),e._UZ(2,"ion-text",2),e.ALo(3,"translate"),e._uU(4,":\xa0"),e._UZ(5,"ion-text",6),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(2),e.Q6J("innerHtml",e.lcZ(3,2,"draftpoll.language"),e.oJD),e.xp6(3),e.Q6J("innerHtml",t.G.S.language_names[t.p.language],e.oJD)}}function w(i,n){if(1&i&&(e.TgZ(0,"p"),e._UZ(1,"ion-select-option",21),e.ALo(2,"translate"),e._UZ(3,"ion-select-option",22),e.ALo(4,"translate"),e._UZ(5,"ion-select-option",23),e.ALo(6,"translate"),e.TgZ(7,"small"),e._UZ(8,"ion-text",2),e.ALo(9,"translate"),e._uU(10,":\xa0"),e._UZ(11,"ion-text",6),e.ALo(12,"translate"),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("innerHtml",e.lcZ(2,5,"select-server.central"),e.oJD),e.xp6(2),e.Q6J("innerHtml",e.lcZ(4,7,"settings"==t.page?"select-server.same-as-some-poll":"select-server.same-as-other-poll"),e.oJD),e.xp6(2),e.Q6J("innerHtml",e.lcZ(6,9,"select-server.other"),e.oJD),e.xp6(3),e.Q6J("innerHtml",e.lcZ(9,11,"previewpoll.db-label"),e.oJD),e.xp6(3),e.Q6J("innerHtml",e.lcZ(12,13,"poll"==t.p.db?"select-server.same-as-other-poll":"central"==t.p.db?"select-server.central":"select-server.other"),e.oJD)}}function J(i,n){if(1&i&&(e.TgZ(0,"ion-text",7),e._UZ(1,"br")(2,"i",2),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(2),e.Q6J("innerHtml",t.desc,e.oJD)}}function y(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"ion-text",18),e._uU(1,"\xa0 ("),e.TgZ(2,"ion-text",19),e.NdJ("click",function(){e.CHM(t);const l=e.oxw().$implicit,s=e.oxw(2);return s.G.open_url_in_new_tab(s.G.D.fix_url(l.url))}),e.ALo(3,"translate"),e.qZA(),e._uU(4,") "),e.qZA()}2&i&&(e.xp6(2),e.Q6J("innerHtml",e.lcZ(3,1,"read-more"),e.oJD))}function A(i,n){if(1&i&&(e.TgZ(0,"ion-item")(1,"ion-col",5)(2,"p")(3,"ion-text",7)(4,"b"),e._UZ(5,"i",2),e.qZA()(),e.YNc(6,J,3,1,"ion-text",16),e.YNc(7,y,5,3,"ion-text",17),e.qZA()()()),2&i){const t=n.$implicit;e.xp6(5),e.Q6J("innerHtml",t.name,e.oJD),e.xp6(1),e.Q6J("ngIf",""!=(t.desc||"")),e.xp6(1),e.Q6J("ngIf",""!=(t.url||""))}}function D(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"ion-content")(1,"ion-list",4)(2,"ion-item")(3,"ion-col",5)(4,"p"),e._UZ(5,"ion-text",2),e.ALo(6,"translate"),e._uU(7,"\xa0"),e._UZ(8,"ion-text",6),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"ion-text",7)(11,"h3")(12,"span",8),e._UZ(13,"ion-icon",9),e._uU(14,"\xa0 "),e.qZA(),e.TgZ(15,"b"),e._UZ(16,"i",2),e.qZA()()(),e.YNc(17,f,3,2,"p",3),e.TgZ(18,"p"),e._UZ(19,"ion-text",2),e.ALo(20,"translate"),e._uU(21,"\xa0"),e._UZ(22,"ion-text",6),e.ALo(23,"translate"),e.YNc(24,v,2,3,"ion-text",10),e.qZA(),e.YNc(25,Z,6,4,"p",3),e.YNc(26,w,13,15,"p",3),e.TgZ(27,"p")(28,"small")(29,"b"),e._UZ(30,"ion-text",2),e.ALo(31,"translate"),e._uU(32,": "),e.qZA()()()()(),e.YNc(33,A,8,3,"ion-item",11),e.TgZ(34,"ion-item",12)(35,"ion-col",5),e._UZ(36,"p",2),e.ALo(37,"translate"),e.TgZ(38,"small"),e._UZ(39,"p",2),e.ALo(40,"translate"),e.qZA()()(),e.TgZ(41,"ion-item",13)(42,"ion-button",14),e.NdJ("click",function(){return e.CHM(t),e.oxw().publish_button_clicked()}),e._UZ(43,"span",2),e.ALo(44,"translate"),e._uU(45,"\xa0 "),e._UZ(46,"ion-icon",15),e.qZA()()()()}if(2&i){const t=e.oxw();e.xp6(5),e.Q6J("innerHtml",e.lcZ(6,16,"previewpoll.type-label"),e.oJD),e.xp6(3),e.Q6J("innerHtml",e.lcZ(9,18,"draftpoll.type-"+t.p.type)+".",e.oJD),e.xp6(5),e.Q6J("name","winner"==t.p.type?"trophy":"cut"),e.xp6(3),e.Q6J("innerHtml",t.p.title,e.oJD),e.xp6(1),e.Q6J("ngIf",""!=(t.p.desc||"")||""!=(t.p.url||"")),e.xp6(2),e.Q6J("innerHtml",e.lcZ(20,20,"previewpoll.closes"),e.oJD),e.xp6(3),e.Q6J("innerHtml","custom"!=t.p.due_type?e.lcZ(23,22,"draftpoll.due-type-"+t.p.due_type):t.G.D.format_date(t.p.due),e.oJD),e.xp6(2),e.Q6J("ngIf",t.p.due<t.G.P.ref_date),e.xp6(1),e.Q6J("ngIf",""!=(t.p.language||"")&&t.p.language!=t.G.S.language),e.xp6(1),e.Q6J("ngIf","default"!=t.p.db),e.xp6(4),e.Q6J("innerHtml",e.lcZ(31,24,"winner"==t.p.type?"options":"possible-targets"),e.oJD),e.xp6(3),e.Q6J("ngForOf",t.Object.values(t.p.options)),e.xp6(3),e.Q6J("innerHtml",e.lcZ(37,26,"previewpoll.caution1"),e.oJD),e.xp6(3),e.Q6J("innerHtml",e.lcZ(40,28,"previewpoll.caution2"),e.oJD),e.xp6(3),e.Q6J("disabled",t.p.due<t.G.P.ref_date),e.xp6(1),e.Q6J("innerHtml",e.lcZ(44,30,"previewpoll.publish"),e.oJD)}}const G=[{path:"",component:(()=>{class i{constructor(t,r,l,s){this.router=t,this.route=r,this.translate=l,this.G=s,this.Object=Object,this.page="previewpoll",this.ready=!1,this.G.L.entry("PreviewpollPage.constructor"),this.route.params.subscribe(c=>{this.pid=c.pid})}ngOnInit(){this.G.L.entry("PreviewpollPage.ngOnInit")}ionViewWillEnter(){this.G.L.entry("PreviewpollPage.ionViewWillEnter"),this.G.D.page=this}ionViewDidEnter(){this.G.L.entry("PreviewpollPage.ionViewDidEnter"),this.G.D.ready&&this.onDataReady(),this.G.L.debug("PreviewpollPage.ready:",this.ready)}onDataReady(){return this.G.L.entry("PreviewpollPage.onDataReady"),this.pid in this.G.P.polls?(this.p=this.G.P.polls[this.pid],this.p.set_due(),this.G.P.update_ref_date(),"draft"!=this.p.state?(this.G.L.warn("DraftpollPage non-draft pid ignored, redirecting to mypolls page",this.pid),void this.router.navigate(["/mypolls"])):(this.G.L.info("PreviewpollPage showing existing draft",this.pid),void(this.ready=!0))):(this.G.L.warn("PreviewpollPage unknown pid ignored, redirecting to mypolls page",this.pid,this.G.P.polls),void this.router.navigate(["/mypolls"]))}ionViewDidLeave(){this.G.L.entry("PreviewpollPage.ionViewDidLeave"),this.G.D.save_state(),this.G.L.exit("PreviewpollPage.ionViewDidLeave")}publish_button_clicked(){this.G.L.entry("PreviewpollPage.publish_button_clicked"),this.p.set_db_credentials(),this.p.init_password(),this.p.init_myvid(),this.p.start_date=new Date,this.G.D.wait_for_user_db().finally(()=>{this.p.state="running",this.G.D.wait_for_poll_db(this.pid).finally(()=>{if(this.p.init_myratings(),this.p.creator=this.G.S.email,this.G.L.trace("PreviewpollPage.publish_button_clicked poll is_test",this.p.is_test,this.G.D.getp(this.pid,"is_test")),this.p.is_test){for(const t of this.p.oids){const r=JSON.parse(this.G.D.getp(this.pid,"simulated_ratings."+t));if(Array.isArray(r)){this.G.L.trace("PreviewpollPage.publish_button_clicked registering simulated voters...");for(const l in r){const s="simulated"+l,c=r[l];this.G.D.setv_in_polldb(this.pid,"rating."+t,c,s),this.G.P.update_own_rating(this.pid,s,t,c,!1),this.G.L.trace("PreviewpollPage.publish_button_clicked registered simulated voter",l)}}}this.p.tally_all()}this.router.navigate(["/inviteto/"+this.pid]),this.G.L.exit("PreviewpollPage.publish_button_clicked")})})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(a.F0),e.Y36(a.gz),e.Y36(u.sK),e.Y36(m.U))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-previewpoll"]],decls:7,vars:4,consts:[[2,"padding-right","11px"],["slot","start"],[3,"innerHtml"],[4,"ngIf"],["lines","full"],[1,"ion-no-padding","ion-no-margin"],["color","primary",3,"innerHtml"],["color","primary"],[2,"position","relative","top","3px","z-index","10"],["color","primary",3,"name"],["style","color: red;",3,"innerHtml",4,"ngIf"],[4,"ngFor","ngForOf"],["lines","none"],["lines","none","text-wrap","",1,"ion-text-end"],["size","large","color","primary","slot","end","shape","round",3,"disabled","click"],["name","paper-plane"],["color","primary",4,"ngIf"],["style","font-size: smaller;","color","primary",4,"ngIf"],["color","primary",2,"font-size","smaller"],[1,"externallink",3,"innerHtml","click"],[2,"color","red",3,"innerHtml"],["value","central",3,"innerHtml"],["value","poll",3,"innerHtml"],["value","other",3,"innerHtml"]],template:function(t,r){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e._UZ(3,"ion-menu-button"),e.qZA(),e._UZ(4,"ion-title",2),e.ALo(5,"translate"),e.qZA()(),e.YNc(6,D,47,32,"ion-content",3)),2&t&&(e.xp6(4),e.Q6J("innerHtml",e.lcZ(5,2,"previewpoll.-page-title"),e.oJD),e.xp6(2),e.Q6J("ngIf",r.ready&&null!=r.p))},directives:[o.Gu,o.sr,o.Sm,o.fG,o.wd,_.O5,o.W2,o.q_,o.Ie,o.wI,o.yW,o.gu,o.n0,_.sg,o.YG],pipes:[u.X$],styles:[""]}),i})()}];let b=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[a.Bz.forChild(G)],a.Bz]}),i})(),L=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[_.ez,d.u5,o.Pc,b,u.aw.forChild()]]}),i})()}}]);
//# sourceMappingURL=5004.3e74d9244fdce21d.js.map