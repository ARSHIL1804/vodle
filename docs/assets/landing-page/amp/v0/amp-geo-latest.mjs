;
(self.AMP=self.AMP||[]).push({m:1,v:"2203281422000",n:"amp-geo",ev:"0.1",l:!0,f:function(t,n){(()=>{function n(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function e(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var o=0;return function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,{isArray:o}=Array,{hasOwnProperty:i,toString:s}=Object.prototype;function u(t){const n=Object.create(null);return t&&Object.assign(n,t),n}function c(t){return JSON.parse(t)}function a(t,n){const{length:e}=t;for(let r=0;r<e;r++)n(t[r],r)}var l=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function h(t,n=""){try{return decodeURIComponent(t)}catch(t){return n}}function p(t){const n=u();if(!t)return n;let e;for(;e=l.exec(t);){const t=h(e[1],e[1]),r=e[2]?h(e[2].replace(/\+/g," "),e[2]):"";n[t]=r}return n}function f(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function d(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function m(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?d(Object(e),!0).forEach((function(n){f(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):d(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}var v=self.AMP_CONFIG||{},g=("string"==typeof v.thirdPartyFrameRegex?new RegExp(v.thirdPartyFrameRegex):v.thirdPartyFrameRegex)||/^d-\d+\.ampproject\.net$/,y=("string"==typeof v.cdnProxyRegex?new RegExp(v.cdnProxyRegex):v.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function b(t){if(!self.document||!self.document.head)return null;if(self.location&&y.test(self.location.origin))return null;const n=self.document.head.querySelector(`meta[name="${t}"]`);return n&&n.getAttribute("content")||null}var A={thirdParty:v.thirdPartyUrl||"https://3p.ampproject.net",thirdPartyFrameHost:v.thirdPartyFrameHost||"ampproject.net",thirdPartyFrameRegex:g,cdn:v.cdnUrl||b("runtime-host")||"https://cdn.ampproject.org",cdnProxyRegex:y,localhostRegex:/^https?:\/\/localhost(:\d+)?$/,errorReporting:v.errorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r",betaErrorReporting:v.betaErrorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r-beta",localDev:v.localDev||!1,trustedViewerHosts:[/(^|\.)google\.(com?|[a-z]{2}|com?\.[a-z]{2}|cat)$/,/(^|\.)gmail\.(com|dev)$/],geoApi:v.geoApiUrl||b("amp-geo-api")};self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var P=self.__AMP_LOG;function O(t,n){throw new Error("failed to call initLogConstructor")}function E(t){return P.user||(P.user=I()),function(t,n){return n&&n.ownerDocument.defaultView!=t}(P.user.win,t)?P.userForEmbed||(P.userForEmbed=I()):P.user}function I(t){return O()}function _(){return P.dev||(P.dev=O())}function R(t,n,e,r,o,i,s,u,c,a,l){return t}function T(t,n){return S(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),n)}function j(t,n){const e=function(t){const n=w(t);return n.isSingleDoc()?n.win:n}(w(t));return C(e,n)?S(e,n):null}function w(t){return t.nodeType?(n=t,e=(n.ownerDocument||n).defaultView,T(e,"ampdoc")).getAmpDoc(t):t;var n,e}function S(t,n){R(C(t,n));const e=function(t){let n=t.__AMP_SERVICES;return n||(n=t.__AMP_SERVICES={}),n}(t)[n];return e.obj||(R(e.ctor),R(e.context),e.obj=new e.ctor(e.context),R(e.obj),e.context=null,e.resolve&&e.resolve(e.obj)),e.obj}function C(t,n){const e=t.__AMP_SERVICES&&t.__AMP_SERVICES[n];return!(!e||!e.ctor)}var $="__AMP__EXPERIMENT_TOGGLES",G=t=>j(t,"url"),M={"preset-eea":["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IS","IE","IT","LV","LI","LT","LU","MT","NL","NO","PL","PT","RO","SK","SI","ES","SE","GB","AX","IC","EA","GF","PF","TF","GI","GP","GG","JE","MQ","YT","NC","RE","BL","MF","PM","SJ","VA","WF","EZ","CH"],"preset-us-ca":["us-ca"]},x="amp-geo",L="amp-iso-subdivision-",H=new RegExp("amp-iso-country-(\\w+)"),N=new RegExp("amp-iso-subdivision-(\\w{2}-\\w{1,3})"),V="ampGeo",F=/^(?:(\w{2})(?:\s(\w{2}-\w{1,3}))?)?\s*/,U=new RegExp("^amp-iso-country-|^amp-geo-group-|^"+L,"i"),z="unknown",J=class extends t.BaseElement{static prerenderAllowed(){return!0}constructor(t){super(t),this.ov=0,this.gc=!1,this.uv=z,this.cv=z,this.av=[],this.lv=[]}buildCallback(){const{children:t}=this.element;var n,e;t.length&&this.hv(1===t.length&&"SCRIPT"==(n=t[0]).tagName&&"APPLICATION/JSON"==(null===(e=n.getAttribute("type"))||void 0===e?void 0:e.toUpperCase()),`${x} can only have one <script type="application/json"> child`);const r=t.length?function(t,n){try{return c(t)}catch(t){return null==n||n(),null}}(t[0].textContent,(()=>this.hv(!1,`${x} Unable to parse JSON`))):{},o=this.pv(r||{});B.resolve(o)}hv(t,n){return t||(B.resolve(null),function(t,n,e,r,o,i,s,u,c,a,l){return E().assert(t,n,e,r,o,i,s,u,c,a,l)}(t,n))}fv(){return"{{AMP_ISO_COUNTRY_HOTPATCH}}"}dv(t){const n=t.getBody(),i=t.getRootNode().documentElement,s=(null==i?void 0:i.className.match(H))||n.className.match(H),a=F.exec(this.fv()),l=function(t){const{location:n}=t||self;return p(n.originalHash||n.hash)}(this.win)["amp-geo"];if(l&&null!==(h=this.win.AMP_CONFIG)&&void 0!==h&&h.canary){const t=F.exec(l.toLowerCase());t[1]&&(this.uv=t[1],t[2]&&(this.cv=t[2]),this.ov=2)}else if(!s||G(this.element).isProxyOrigin(this.win.location)&&!function(t,n){const r=function(t){var n,r,i,s,a;if(t[$])return t[$];t[$]=u();const l=t[$],h=m(m({},null!==(n=t.AMP_CONFIG)&&void 0!==n?n:{}),null!==(r=t.AMP_EXP)&&void 0!==r?r:c((null===(i=t.__AMP_EXP)||void 0===i?void 0:i.textContent)||"{}"));for(const t in h){const n=h[t];"number"==typeof n&&n>=0&&n<=1&&(l[t]=Math.random()<n)}const f=null===(s=t.AMP_CONFIG)||void 0===s?void 0:s["allow-doc-opt-in"];if(o(f)&&f.length){const n=t.document.head.querySelector('meta[name="amp-experiments-opt-in"]');if(n)for(var d,v,g=e((null===(d=n.getAttribute("content"))||void 0===d?void 0:d.split(","))||[],!0);!(v=g()).done;){const t=v.value;f.includes(t)&&(l[t]=!0)}}Object.assign(l,function(t){var n;let r="";try{var o;"localStorage"in t&&(r=null!==(o=t.localStorage.getItem("amp-experiment-toggles"))&&void 0!==o?o:"")}catch(t){}const i=(null===(n=r)||void 0===n?void 0:n.split(/\s*,\s*/g))||[],s=u();for(var c,a=e(i,!0);!(c=a()).done;){const t=c.value;t&&("-"==t[0]?s[t.substr(1)]=!1:s[t]=!0)}return s}(t));const y=null===(a=t.AMP_CONFIG)||void 0===a?void 0:a["allow-url-opt-in"];if(o(y)&&y.length){const n=p(t.location.originalHash||t.location.hash);for(var b,A=e(y,!0);!(b=A()).done;){const t=b.value,e=n[`e-${t}`];"1"==e&&(l[t]=!0),"0"==e&&(l[t]=!1)}}return l}(t);return!!r["amp-geo-ssr"]}(this.win))a[1]?(this.ov=0,this.uv=a[1].toLowerCase(),a[2]&&(this.cv=a[2].toLowerCase())):""===a[0]&&A.geoApi?this.ov=3:""===a[0]&&(this.gc=!0,_().error(x,"GEONOTPATCHED: amp-geo served unpatched, ISO country not set"));else{this.ov=1,this.uv=s[1];const t=(null==i?void 0:i.className.match(N))||n.className.match(N);t&&(this.cv=t[1])}var h;return 3!==this.ov?r||(r=Promise.resolve(void 0)):this.mv().then((t=>{if(t){const{country:n,subdivision:e}=t;this.uv=n,e&&(this.cv=`${n}-${e}`)}else this.gc=!0,_().error(x,"GEONOTPATCHED: amp-geo served unpatched and API response not valid, ISO country not set")}))}vv(t){return"string"!=typeof t?(E().error(x,"geoApiUrl must be a string URL"),null):G(this.element).isSecure(t)?t:(E().error(x,"geoApiUrl must be secure (https)"),null)}mv(){const t=this.vv(A.geoApi);return t?(n=this.win,S(n,"timer")).timeoutPromise(6e4,(t=>T(t,"xhr"))(this.win).fetchJson(t,{mode:"cors",method:"GET",credentials:"omit"}).then((t=>t.json())).then((t=>/^[a-z]{2}$/i.test(t.country)?{country:t.country.toLowerCase(),subdivision:/^[a-z0-9]{1,3}$/i.test(t.subdivision)?t.subdivision.toLowerCase():null}:(E().error(x,'Invalid API response, expected schema not matched for property "country"'),null))).catch((t=>(E().error(x,"XHR country request failed",t),null))),"Timeout (60 sec) reached waiting for API response").catch((t=>(E().error(x,t),null))):Promise.resolve(null);var n}gv(t){const n=t.ISOCountryGroups,e="<amp-geo> ISOCountryGroups";var r;n&&(this.hv((r=n,"[object Object]"===s.call(r)),`${e} must be an object`),this.lv=Object.keys(n),this.lv.forEach((t=>{this.hv(/^[a-z]+[a-z0-9]*$/i.test(t)&&!/^amp/.test(t),`${e}[${t}] name is invalid`),this.hv(o(n[t]),`${e}[${t}] must be an array`),this.yv(n[t])&&this.av.push(t)})))}yv(t){const n=t.reduce(((t,n)=>/^preset-/.test(n)?(this.hv(o(M[n]),`<amp-geo> preset ${n} not found`),t.concat(M[n])):(n===z||/^[a-zA-Z]{2}(?:-[0-9a-zA-Z]{1,3})?$/.test(n)?t.push(n):E().error(x," country %s not valid, will be ignored",n),t)),[]).map((t=>t.toLowerCase()));return n.includes(this.uv)||this.cv!==z&&n.includes(this.cv)}bv(t,n){const e=new Set;if(n){const{classList:t}=n;a(t,(t=>{U.test(t)&&e.add(t)}))}const{classList:r}=t;return a(r,(t=>{U.test(t)&&e.add(t)})),e}pv(t){const n=this.getAmpDoc(),e={};return n.whenReady().then((()=>n.waitForBodyOpen())).then((t=>this.dv(n).then((()=>t)))).then((r=>{const o=n.getRootNode().documentElement;this.gv(t);let i=new Set;switch(this.ov){case 2:i=this.bv(r,o);case 0:case 3:e.ISOCountry=this.uv,e.ISOSubdivision=this.cv;const s=this.av.map((t=>(e[t]=!0,"amp-geo-group-"+t)));this.av.length||s.push("amp-geo-no-group"),this.gc&&s.push("amp-geo-error"),e.ISOCountryGroups=this.av,s.push("amp-iso-country-"+this.uv),this.cv!==z&&s.push(L+this.cv),this.mutateElement((()=>{const u=o&&o.classList,{classList:c}=r;if(i.add("amp-geo-pending"),i.forEach((t=>{c.remove(t),u&&u.remove(t)})),s.forEach((t=>{u&&u.add(t),c.add(t)})),t.AmpBind){const t=n.getElementById(V);t&&t.parentNode.removeChild(t);const o=n.win.document.createElement("amp-state"),i=n.win.document.createElement("script");i.setAttribute("type","application/json"),i.textContent=JSON.stringify(e),o.appendChild(i),o.id=V,r.appendChild(o)}}),o)}return{ISOCountry:this.uv,ISOSubdivision:this.cv,matchedISOCountryGroups:this.av,allISOCountryGroups:this.lv,isInCountryGroup:this.isInCountryGroup.bind(this)}}))}isInCountryGroup(t){const n=t.trim().split(/,\s*/);return n.filter((t=>this.lv.indexOf(t)>=0)).length!==n.length?1:n.filter((t=>this.av.indexOf(t)>=0)).length>0?2:3}},B=null;B=new class{constructor(){this.promise=new Promise(((t,n)=>{this.resolve=t,this.reject=n}))}},t.registerElement(x,J),t.registerServiceForDoc("geo",(function(){return B.promise}))})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-geo-0.1.mjs.map