;
(self.AMP=self.AMP||[]).push({m:1,v:"2203281422000",n:"amp-user-notification",ev:"0.1",l:!0,f:function(t,i){(()=>{function i(t,i){(null==i||i>t.length)&&(i=t.length);for(var s=0,n=new Array(i);s<i;s++)n[s]=t[s];return n}function s(t,s){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,s){if(t){if("string"==typeof t)return i(t,s);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,s):void 0}}(t))||s&&t&&"number"==typeof t.length){n&&(t=n);var e=0;return function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n;function e(){return n||(n=Promise.resolve(void 0))}var r=class{constructor(){this.promise=new Promise(((t,i)=>{this.resolve=t,this.reject=i}))}},{isArray:o}=Array,{hasOwnProperty:h,toString:u}=Object.prototype;function a(t){const i=Object.getOwnPropertyDescriptor(t,"message");if(null!=i&&i.writable)return t;const{message:s,stack:n}=t,e=new Error(s);for(const i in t)e[i]=t[i];return e.stack=n,e}function l(t){let i=null,n="";for(var e,r=s(arguments,!0);!(e=r()).done;){const t=e.value;t instanceof Error&&!i?i=a(t):(n&&(n+=" "),n+=t)}return i?n&&(i.message=n+": "+i.message):i=new Error(n),i}function c(t){var i,s;null===(i=(s=self).__AMP_REPORT_ERROR)||void 0===i||i.call(s,t)}function f(t){const i=l.apply(null,arguments);setTimeout((()=>{throw c(i),i}))}var d=self.AMP_CONFIG||{},p=("string"==typeof d.thirdPartyFrameRegex?new RegExp(d.thirdPartyFrameRegex):d.thirdPartyFrameRegex,("string"==typeof d.cdnProxyRegex?new RegExp(d.cdnProxyRegex):d.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/);function m(t){if(!self.document||!self.document.head)return null;if(self.location&&p.test(self.location.origin))return null;const i=self.document.head.querySelector(`meta[name="${t}"]`);return i&&i.getAttribute("content")||null}d.thirdPartyUrl,d.thirdPartyFrameHost,d.cdnUrl||m("runtime-host"),d.errorReportingUrl,d.betaErrorReportingUrl,d.localDev,d.geoApiUrl||m("amp-geo-api"),self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var v=self.__AMP_LOG;function w(t,i){throw new Error("failed to call initLogConstructor")}function b(t){return w()}function _(){return v.dev||(v.dev=w())}function y(t,i,s,n,e,r,o,h,u,a,l){return t}function A(t,i,s,n,e,r,o,h,u,a,l){return(v.user||(v.user=b()),void v.user.win?v.userForEmbed||(v.userForEmbed=b()):v.user).assert(t,i,s,n,e,r,o,h,u,a,l)}function P(t,i){return T(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),i)}function g(t,i){return function(t,i){const s=M(t,i);if(s)return s;const n=C(t);return n[i]=function(){const t=new r,{promise:i,reject:s,resolve:n}=t;return i.catch((()=>{})),{obj:null,promise:i,resolve:n,reject:s,context:null,ctor:null}}(),n[i].promise}(R(t),i)}function I(t,i){return M(R(t),i)}function E(t){return t.nodeType?(i=t,s=(i.ownerDocument||i).defaultView,P(s,"ampdoc")).getAmpDoc(t):t;var i,s}function R(t){const i=E(t);return i.isSingleDoc()?i.win:i}function T(t,i){y(S(t,i));const s=C(t)[i];return s.obj||(y(s.ctor),y(s.context),s.obj=new s.ctor(s.context),y(s.obj),s.context=null,s.resolve&&s.resolve(s.obj)),s.obj}function M(t,i){const s=C(t)[i];return s?s.promise?s.promise:(T(t,i),s.promise=Promise.resolve(s.obj)):null}function C(t){let i=t.__AMP_SERVICES;return i||(i=t.__AMP_SERVICES={}),i}function S(t,i){const s=t.__AMP_SERVICES&&t.__AMP_SERVICES[i];return!(!s||!s.ctor)}var j,O=t=>function(t,i){const s=R(E(t));return S(s,i)?T(s,i):null}(t,"url-replace"),V=t=>function(t,i,s,n){const e=I(t,i);if(e)return e;const r=E(t);return r.whenExtensionsKnown().then((()=>{const t=r.getExtensionVersion(s);return t?P(r.win,"extensions").waitForExtension(s,t):null})).then((s=>s?n?I(t,i):g(t,i):null))}(t,"geo","amp-geo",!0),U=t=>P(t,"xhr"),x="notificationUIManager",$=(new Set(["c","v","a","ad"]),t=>"string"==typeof t?function(t,i){return j||(j=self.document.createElement("a")),function(t,i,s){return t.href="",new URL(i,t.href)}(j,t)}(t):t);function N(t,i,s="source"){var n;return A(null!=t,"%s %s must be available",i,s),A("https:"==(n=$(n=t)).protocol||"localhost"==n.hostname||"127.0.0.1"==n.hostname||function(t,i){const s=t.length-i.length;return s>=0&&t.indexOf(i,s)==s}(n.hostname,".localhost")||/^\/\//.test(t),'%s %s must start with "https://" or "//" or be relative and served from either https or from localhost. Invalid value: %s',i,s,t),t}var G="amp-user-notification",k="userNotificationManager",F=class extends t.BaseElement{constructor(t){super(t),this.Ndt=null,this.Gdt=null;const i=new r;this.Fdt=i.promise,this.qdt=i.resolve,this.Qdt=null,this.Bdt=!1,this.Hdt=null,this.Xdt=null,this.Zdt=null,this.Jdt=null,this.aZ="",this.oZ=null,this.PP=null}isAlwaysFixed(){return!0}buildCallback(){const t=this.getAmpDoc();this.PP=O(this.element),this.oZ=g(this.element,"storage"),this.Gdt=A(this.element.id,"amp-user-notification should have an id."),this.aZ="amp-user-notification:"+this.Gdt,this.Hdt=this.element.getAttribute("data-show-if-geo"),this.Xdt=this.element.getAttribute("data-show-if-not-geo"),this.Jdt=this.element.getAttribute("data-show-if-href"),this.Jdt&&N(this.Jdt,this.element),A(!!this.Jdt+!!this.Hdt+!!this.Xdt<=1,'Only one "data-show-if-*" attribute allowed'),this.Hdt&&(this.Zdt=this.Kdt(this.Hdt,!0)),this.Xdt&&(this.Zdt=this.Kdt(this.Xdt,!1)),this.Qdt=this.element.getAttribute("data-dismiss-href"),this.Qdt&&N(this.Qdt,this.element),this.element.getAttribute("role")||this.element.setAttribute("role","alert");const i=this.element.getAttribute("data-persist-dismissal");this.Bdt="false"!=i&&"no"!=i,this.registerDefaultAction((()=>this.dismiss(!1)),"dismiss"),this.registerAction("optoutOfCid",(()=>this.Wdt())),g(t,k).then((t=>{t.registerUserNotification(this.Gdt,this)}))}Kdt(t,i){return V(this.element).then((s=>{A(s,"requires <amp-geo> to use promptIfUnknownForGeoGroup");const n=t.split(/,\s*/).filter((t=>2==s.isInCountryGroup(t)));return!!(i?n.length:!n.length)}))}Ydt(t){const i=this.Jdt;return this.PP.expandUrlAsync(i).then((i=>function(t,i,s){if(!i)return t;const n=t.split("#",2),e=n[0].split("?",2);let r=e[0]+(e[1]?`?${e[1]}&${i}`:`?${i}`);return r+=n[1]?`#${n[1]}`:"",r}(i,function(t){const i=[];for(const r in t){let h=t[r];if(null!=h){h=o(e=h)?e:[e];for(let t=0;t<h.length;t++)i.push((s=r,n=h[t],`${encodeURIComponent(s)}=${encodeURIComponent(n)}`))}}var s,n,e;return i.join("&")}({"elementId":this.Gdt,"ampUserId":t}))))}Nmt(t){return this.Ndt=t,this.Ydt(t).then((t=>U(this.win).fetchJson(t,{credentials:"include"}).then((t=>t.json()))))}Gmt(){const t=this.element.getAttribute("enctype")||"application/json;charset=utf-8";return U(this.win).fetchJson(this.Qdt,this.Qmt(t,this.Gdt,this.Ndt))}Qmt(t,i,s){return{method:"POST",credentials:"include",body:{"elementId":i,"ampUserId":s},headers:{"Content-Type":t}}}Bmt(t){return A("boolean"==typeof t.showNotification,'`showNotification` should be a boolean. Got "%s" which is of type %s.',t.showNotification,typeof t.showNotification),t.showNotification||this.qdt(),Promise.resolve(t.showNotification)}Wdt(){return this.Xmt().then((t=>t.optOut())).then((()=>this.dismiss(!1)),(t=>{_().error(G,"Failed to opt out of Cid",t),this.dismiss(!0)}))}Zmt(){return this.Xmt().then((t=>t.get({scope:G,createCookieIfNotPresent:!0},e(),this.Fdt)))}Xmt(){return g(this.element,"cid")}shouldShow(){return this.isDismissed().then((t=>!t&&(this.Jdt?this.Kmt():!this.Zdt||this.Zdt)))}Kmt(){return this.Zmt().then(this.Nmt.bind(this)).then(this.Bmt.bind(this))}show(){var t,i;return t=this.element,void 0===(i=!0)&&(i=t.hasAttribute("hidden")),i?t.removeAttribute("hidden"):t.setAttribute("hidden",""),this.element.classList.add("amp-active"),this.getViewport().addToFixedLayer(this.element),this.Fdt}isDismissed(){return this.Bdt?this.oZ.then((t=>t.get(this.aZ))).then((t=>!!t),(t=>(_().error(G,"Failed to read storage",t),!1))):Promise.resolve(!1)}dismiss(t){this.element.classList.remove("amp-active"),this.element.classList.add("amp-hidden"),this.qdt(),this.getViewport().removeFromFixedLayer(this.element),this.Bdt&&!t&&this.oZ.then((t=>{t.set(this.aZ,!0)})),this.Qdt&&this.Gmt()}};t.registerServiceForDoc(k,class{constructor(t){this.ampdoc=t,this.Wmt=Object.create(null),this.tvt=Object.create(null),this.ivt=this.ampdoc.whenReady(),this.svt=Promise.all([this.ampdoc.whenFirstVisible(),this.ivt]),this.nvt=g(this.ampdoc,x)}get(t){return this.svt.then((()=>{this.ampdoc.getElementById(t)})),this.evt(t).promise}getNotification(t){return this.ivt.then((()=>this.Wmt[t]))}registerUserNotification(t,i){this.Wmt[t]=i;const s=this.evt(t);return this.svt.then((()=>i.shouldShow())).then((t=>{if(t)return this.nvt.then((t=>t.registerUI(i.show.bind(i))))})).then(s.resolve.bind(this,i)).catch(f.bind(null,"Notification service failed amp-user-notification",t))}evt(t){if(this.tvt[t])return this.tvt[t];const i=new r,{promise:s,resolve:n}=i;return this.tvt[t]={promise:s,resolve:n}}}),t.registerServiceForDoc(x,class{constructor(){this.JK=0,this.KK=e(),this.ZK=()=>{},this.QK=()=>{}}onQueueEmpty(t){this.ZK=t,0==this.JK&&t()}onQueueNotEmpty(t){this.QK=t,this.JK>0&&t()}registerUI(t){0==this.JK&&this.QK(),this.JK++;const i=this.KK.then((()=>t().then((()=>{this.JK--,0==this.JK&&this.ZK()}))));return this.KK=i,i}}),t.registerElement(G,F,"amp-user-notification{position:fixed!important;bottom:0;left:0;overflow:hidden!important;visibility:hidden;background:hsla(0,0%,100%,0.7);z-index:1000;width:100%}amp-user-notification.amp-active{visibility:visible}amp-user-notification.amp-hidden{visibility:hidden}\n/*# sourceURL=/extensions/amp-user-notification/0.1/amp-user-notification.css*/")})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-user-notification-0.1.mjs.map