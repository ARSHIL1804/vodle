;
(self.AMP=self.AMP||[]).push({m:1,v:"2203281422000",n:"amp-access-poool",ev:"0.1",l:!0,f:function(t,n){(()=>{var{isArray:n}=Array;function r(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}function e(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=function(t,n){if(t){if("string"==typeof t)return r(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?r(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var o=0;return function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var{hasOwnProperty:o,toString:i}=Object.prototype;function s(t,n){try{return function(t){return JSON.parse(t)}(t)}catch(t){return null==n||n(t),null}}var u=self.AMP_CONFIG||{},c=("string"==typeof u.thirdPartyFrameRegex?new RegExp(u.thirdPartyFrameRegex):u.thirdPartyFrameRegex,("string"==typeof u.cdnProxyRegex?new RegExp(u.cdnProxyRegex):u.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/);function l(t){if(!self.document||!self.document.head)return null;if(self.location&&c.test(self.location.origin))return null;const n=self.document.head.querySelector(`meta[name="${t}"]`);return n&&n.getAttribute("content")||null}function f(t){const n=Object.getOwnPropertyDescriptor(t,"message");if(null!=n&&n.writable)return t;const{message:r,stack:e}=t,o=new Error(r);for(const n in t)o[n]=t[n];return o.stack=e,o}function a(t){let n=null,r="";for(var o,i=e(arguments,!0);!(o=i()).done;){const t=o.value;t instanceof Error&&!n?n=f(t):(r&&(r+=" "),r+=t)}return n?r&&(n.message=r+": "+n.message):n=new Error(r),n}function h(t){var n,r;null===(n=(r=self).__AMP_REPORT_ERROR)||void 0===n||n.call(r,t)}u.thirdPartyUrl,u.thirdPartyFrameHost,u.cdnUrl||l("runtime-host"),u.errorReportingUrl,u.betaErrorReportingUrl,u.localDev,u.geoApiUrl||l("amp-geo-api"),self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var p,m=self.__AMP_LOG;function d(t){return m.user||(m.user=v()),function(t,n){return n&&n.ownerDocument.defaultView!=t}(m.user.win,t)?m.userForEmbed||(m.userForEmbed=v()):m.user}function v(t){return function(t,n){throw new Error("failed to call initLogConstructor")}()}function A(t,n,r,e,o,i,s,u,c,l,f){return t}function g(t,n,r,e,o,i,s,u,c,l,f){return d().assert(t,n,r,e,o,i,s,u,c,l,f)}function _(t,n){return y(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),n)}function b(t,n){return y(P(R(t)),n)}function w(t,n){return function(t,n){const r=I(t,n);if(r)return r;const e=M(t);return e[n]=function(){const t=new class{constructor(){this.promise=new Promise(((t,n)=>{this.resolve=t,this.reject=n}))}},{promise:n,reject:r,resolve:e}=t;return n.catch((()=>{})),{obj:null,promise:n,resolve:e,reject:r,context:null,ctor:null}}(),e[n].promise}(P(t),n)}function E(t,n){return I(P(t),n)}function R(t){return t.nodeType?(n=t,r=(n.ownerDocument||n).defaultView,_(r,"ampdoc")).getAmpDoc(t):t;var n,r}function P(t){const n=R(t);return n.isSingleDoc()?n.win:n}function y(t,n){A(function(t,n){const r=t.__AMP_SERVICES&&t.__AMP_SERVICES[n];return!(!r||!r.ctor)}(t,n));const r=M(t)[n];return r.obj||(A(r.ctor),A(r.context),r.obj=new r.ctor(r.context),A(r.obj),r.context=null,r.resolve&&r.resolve(r.obj)),r.obj}function I(t,n){const r=M(t)[n];return r?r.promise?r.promise:(y(t,n),r.promise=Promise.resolve(r.obj)):null}function M(t){let n=t.__AMP_SERVICES;return n||(n=t.__AMP_SERVICES={}),n}function $(t,n,r,e){return function(t,n,r,e){const o=E(t,n);if(o)return o;const i=R(t);return i.whenExtensionsKnown().then((()=>{const t=i.getExtensionVersion(r);return t?_(i.win,"extensions").waitForExtension(r,t):null})).then((r=>r?e?E(t,n):w(t,n):null))}(t,n,r,e).then((t=>function(t,n,r){return g(t,"Service %s was requested to be provided through %s, but %s is not loaded in the current page. To fix this problem load the JavaScript file for %s in this page.",n,r,r,r)}(t,n,r)))}var O,T,j=["Webkit","webkit","Moz","moz","ms","O","o"];function S(t,n,r,e,o){const i=function(t,n,r){if(n.startsWith("--"))return n;O||(O=Object.create(null));let e=O[n];if(!e||r){if(e=n,void 0===t[n]){const r=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(n),o=function(t,n){for(let r=0;r<j.length;r++){const e=j[r]+n;if(void 0!==t[e])return e}return""}(t,r);void 0!==t[o]&&(e=o)}r||(O[n]=e)}return e}(t.style,n,o);if(!i)return;const s=e?r+e:r;t.style.setProperty(function(t){const n=t.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()));return j.some((t=>n.startsWith(t+"-")))?`-${n}`:n}(i),s)}function k(t,n){for(const r in n)S(t,r,n[r])}function x(t){return"string"==typeof t&&t.startsWith("amp-")&&-1!=t.indexOf("{")}function C(t){return t.data}function D(t,n,r){if(!n)return t;const e=t.split("#",2),o=e[0].split("?",2);let i=o[0]+(o[1]?r?`?${n}&${o[1]}`:`?${o[1]}&${n}`:`?${n}`);return i+=e[1]?`#${e[1]}`:"",i}function V(t,n){return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`}new Set(["c","v","a","ad"]);var z="unlisten";function U(t,n,r){const e=function(t,n){let{listeningFors:r}=t;return!r&&n&&(r=t.listeningFors=Object.create(null)),r||null}(t,r);if(!e)return e;let o=e[n];return!o&&r&&(o=e[n]=[]),o||null}function N(t,n){for(let r=n;r&&r!=r.parent;r=r.parent)if(r==t)return!0;return!1}function L(t){const n={"sentinel":z};for(let r=t.length-1;r>=0;r--){const e=t[r];if(!e.frame.contentWindow){t.splice(r,1);const{events:o}=e;for(const t in o)o[t].splice(0,1/0).forEach((t=>{t(n)}))}}}function F(t,n,r,e,o,i){A(t.src),A(!t.parentNode),A(r);const u=t.ownerDocument.defaultView;!function(t){t.listeningFors||t.addEventListener("message",(function(n){if(!C(n))return;const r=function(t){return"string"==typeof t&&(t="{"==t.charAt(0)?s(t,(t=>{}))||null:x(t)?function(t){if(!x(t))return null;const n=t.indexOf("{");return s(t.substr(n),(n=>{!function(t){const n=a.apply(null,arguments);setTimeout((()=>{throw h(n),n}))}(new Error(`MESSAGING: Failed to parse message: ${t}\n${n.message}`))}))}(t):null),t}(C(n));if(!r||!r.sentinel)return;const e=function(t,n,r,e){const o=U(t,n);if(!o)return o;let i;for(let t=0;t<o.length;t++){const n=o[t],{contentWindow:r}=n.frame;if(r){if(e==r||N(r,e)){i=n;break}}else setTimeout(L,0,o)}return i?i.events:null}(t,r.sentinel,n.origin,n.source);if(!e)return;let o=e[r.type];if(o){o=o.slice();for(let t=0;t<o.length;t++)(0,o[t])(r,n.source,n.origin,n)}}))}(u);const c=function(t,n,r){const e=function(t,n){return n?t.getAttribute("data-amp-3p-sentinel"):"amp"}(n,r),o=U(t,e,!0);let i;for(let t=0;t<o.length;t++){const r=o[t];if(r.frame===n){i=r;break}}return i||(i={frame:n,events:Object.create(null)},o.push(i)),i.events}(u,t,e),l=(f=t.src,T||(T=self.document.createElement("a")),function(t,n,r){return t.href="",new URL(n,t.href)}(T,f)).origin;var f;let p,m=c[n]||(c[n]=[]),d=function(n,e,s,u){if("amp"==n.sentinel){if(e!=t.contentWindow)return;const n="null"==s&&i;if(l!=s&&!n)return}(o||e==t.contentWindow)&&(n.sentinel!=z?r(n,e,s,u):p())};return m.push(d),p=function(){if(d){const t=m.indexOf(d);t>-1&&m.splice(t,1),d=null,m=null,r=null}}}t.registerServiceForDoc("poool",(function(t){return(t=>$(t,"access","amp-access"))(t.getHeadNode()).then((t=>{const r=t.getVendorSource("poool"),e=new class{constructor(t,n){this.ampdoc=t.ampdoc,this.tR=n,this.wn=b(this.ampdoc,"mutator"),this.nR="https://api.poool.fr/api/v3/amp/access?rid=READER_ID",this.rR="https://assets.poool.fr/amp.html?rid=READER_ID&c=CANONICAL_URL&o=AMPDOC_URL&r=DOCUMENT_REFERRER",this.Ee=y(this.ampdoc.win,"timer"),this.eR=(t=>_(t,"xhr"))(this.ampdoc.win),this.oR=(t=>b(t,"navigation"))(this.ampdoc),this.iR=this.tR.getAdapterConfig(),this.sR=this.iR.bundleID||"",this.uR="",this.cR=this.iR.itemID||"",this.Mv=this.ampdoc.win.document.createElement("iframe"),this.lR(),this.fR()}authorize(){return this.aR().then((t=>({access:t.access})),(t=>{if(!t||!t.response)throw t;const{response:n}=t;if(402!==n.status)throw t;return this.hR(),{access:!1}}))}lR(){this.Mv.setAttribute("id","poool-iframe"),this.Mv.setAttribute("scrolling","no"),this.Mv.setAttribute("frameborder","0"),S(this.Mv,"width","100%"),"unlock"==this.iR.forceWidget?k(this.Mv,{"height":"250px","position":"fixed","bottom":"0"}):k(this.Mv,{"height":"500px","transform":"translateY(-70px)"})}fR(){g(this.sR,"BundleID is incorrect or not provided."),g(this.cR,"ItemID is not provided.")}aR(){const t=function(t,n,r,e){return D(t,V("iid",r),void 0)}(this.nR,0,this.cR);return this.tR.buildUrl(t,!1).then((t=>this.tR.getLoginUrl(t))).then((t=>this.Ee.timeoutPromise(3e3,this.eR.fetchJson(t)).then((t=>t.json()))))}pR(){const t=this.ampdoc.getElementById("poool");return d().assertElement(t,"No element with id #poool found to render paywall into, got")}hR(){const t=this.pR();return this.tR.buildUrl((r=this.rR,e={"bi":this.iR.bundleID,"iid":this.iR.itemID,"ce":this.iR.cookiesEnabled,"d":void 0!==this.iR.debug&&null!==this.iR.debug&&this.iR.debug,"fw":this.iR.forceWidget,"cs":this.iR.customSegment,"lo":this.iR.locale,"co":this.iR.context},D(r,function(t){const r=[];for(const o in t){let i=t[o];if(null!=i){i=n(e=i)?e:[e];for(let t=0;t<i.length;t++)r.push(V(o,i[t]))}}var e;return r.join("&")}(e))),!1).then((n=>{this.Mv.src=n,F(this.Mv,"release",this.mR.bind(this)),F(this.Mv,"resize",this.dR.bind(this)),F(this.Mv,"click",this.vR.bind(this)),t.appendChild(this.Mv)}));var r,e}mR(){const t=this.ampdoc.getRootNode().querySelector("[poool-access-preview]");t&&this.wn.mutateElement(t,(()=>{t.setAttribute("amp-access-hide","")}));const n=this.ampdoc.getRootNode().querySelector("[poool-access-content]");n&&this.wn.mutateElement(n,(()=>{n.removeAttribute("amp-access-hide")})),function(t,n){for(let r=0;r<n.length;r++)S(t,n[r],null)}(this.Mv,["transform"])}dR(t){S(this.Mv,"height",t.height)}vR(t){t.url&&this.oR.navigateTo(this.ampdoc.win,t.url)}pingback(){return p||(p=Promise.resolve(void 0))}}(t,r);return r.getAdapter().registerVendor(e),e}))}))})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-access-poool-0.1.mjs.map