;
(self.AMP=self.AMP||[]).push({m:1,v:"2203281422000",n:"amp-selector",ev:"0.1",l:!0,f:function(t,e){(()=>{var e;function s(){return e||(e=Promise.resolve(void 0))}function i(t){return t?Array.prototype.slice.call(t):[]}function n(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!==e[s])return!1;return!0}var{hasOwnProperty:r,toString:o}=Object.prototype,h="Enter",l="ArrowLeft",c="ArrowUp",a="ArrowRight",u="ArrowDown",d="Home",p="End";function f(t){return"rtl"==(t.body.getAttribute("dir")||t.documentElement.getAttribute("dir")||"ltr")}var _=self.AMP_CONFIG||{},m=("string"==typeof _.thirdPartyFrameRegex?new RegExp(_.thirdPartyFrameRegex):_.thirdPartyFrameRegex,("string"==typeof _.cdnProxyRegex?new RegExp(_.cdnProxyRegex):_.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/);function A(t){if(!self.document||!self.document.head)return null;if(self.location&&m.test(self.location.origin))return null;const e=self.document.head.querySelector(`meta[name="${t}"]`);return e&&e.getAttribute("content")||null}_.thirdPartyUrl,_.thirdPartyFrameHost,_.cdnUrl||A("runtime-host"),_.errorReportingUrl,_.betaErrorReportingUrl,_.localDev,_.geoApiUrl||A("amp-geo-api"),self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var b=self.__AMP_LOG;function P(t){return function(t,e){throw new Error("failed to call initLogConstructor")}()}function g(t,e,s,i,n,r,o,h,l,c,a){return t}function E(t,e,s,i,n,r,o,h,l,c,a){return(b.user||(b.user=P()),void b.user.win?b.userForEmbed||(b.userForEmbed=P()):b.user).assert(t,e,s,i,n,r,o,h,l,c,a)}function v(t,e){const s=function(t){const e=w(t);return e.isSingleDoc()?e.win:e}(w(t));return T(s,e)?R(s,e):null}function w(t){return t.nodeType?(e=t,s=(e.ownerDocument||e).defaultView,function(t,e){return R(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),e)}(s,"ampdoc")).getAmpDoc(t):t;var e,s}function R(t,e){g(T(t,e));const s=function(t){let e=t.__AMP_SERVICES;return e||(e=t.__AMP_SERVICES={}),e}(t)[e];return s.obj||(g(s.ctor),g(s.context),s.obj=new s.ctor(s.context),g(s.obj),s.context=null,s.resolve&&s.resolve(s.obj)),s.obj}function T(t,e){const s=t.__AMP_SERVICES&&t.__AMP_SERVICES[e];return!(!s||!s.ctor)}var I="amp-selector",M="none",k="select",y=class extends t.BaseElement{static prerenderAllowed(){return!0}constructor(t){super(t),this.Zx=!1,this.Xx=[],this.ct=[],this.bO=[],this.fc=null,this.gO=0,this.TO=M}isLayoutSupported(){return!0}buildCallback(){this.fc=v(this.element,"action"),this.Zx=this.element.hasAttribute("multiple"),this.element.hasAttribute("role")||this.element.setAttribute("role","listbox"),this.Zx&&this.element.setAttribute("aria-multiselectable","true"),this.element.hasAttribute("disabled")&&this.element.setAttribute("aria-disabled","true");let t=this.element.getAttribute("keyboard-select-mode");var e;t?(t=t.toLowerCase(),E("none"===(e=t)||"focus"===e||"select"===e,`Unknown keyboard-select-mode: ${t}`),E(!(this.Zx&&t==k),"[keyboard-select-mode=select] not supported for multiple selection amp-selector")):t=M,this.TO=t,this.registerAction("clear",this.MO.bind(this)),this.Cu(),this.element.addEventListener("click",this.kO.bind(this)),this.element.addEventListener("keydown",this.yO.bind(this)),this.registerAction("selectUp",(t=>{const{args:e,trust:s}=t,i=e&&void 0!==e.delta?-e.delta:-1;this.VO(i,s)}),1),this.registerAction("selectDown",(t=>{const{args:e,trust:s}=t,i=e&&void 0!==e.delta?e.delta:1;this.VO(i,s)}),1),this.registerAction("toggle",(t=>{const{args:e,trust:s}=t;return E(e.index>=0,"'index' must be greater than 0"),E(e.index<this.ct.length,"'index' must be less than the length of options in the <amp-selector>"),e&&void 0!==e.index?this.Sx(e.index,e.value,s):Promise.reject("'index' must be specified")}),1),this.fc.addToAllowlist(I,["clear","selectDown","selectUp","toggle"],["email"]),this.element.addEventListener("amp:dom-update",this.xO.bind(this))}mutatedAttributesCallback(t){const e=t.selected;void 0!==e&&this.OO(e);const s=t.disabled;void 0!==s&&(s?this.element.setAttribute("aria-disabled","true"):this.element.removeAttribute("aria-disabled"))}OO(t){let e=Array.isArray(t)?t:[t];if(null===t||0==e.length)return void this.MO();if(this.Zx||(e=e.slice(0,1)),n(this.SO().sort(),e.sort()))return;const s=e.reduce(((t,e)=>(t[e]=!0,t)),Object.create(null));for(let t=0;t<this.ct.length;t++){const e=this.ct[t];s[e.getAttribute("option")]?this.DO(e):this.UO(e)}this.HO(),this.jO()}HO(t){if(this.TO==M)return;this.ct.forEach((t=>{t.tabIndex=-1}));let e=t;e||(e=this.Zx?this.ct[0]:this.Xx[0]||this.ct[0]),e&&(this.gO=this.ct.indexOf(e),e.tabIndex=0)}xO(t){const e=i(this.element.querySelectorAll("[option]"));n(this.ct,e)||this.Cu(e)}Cu(t){this.Xx.length=0;const e=t||i(this.element.querySelectorAll("[option]"));e.forEach((t=>{t.hasAttribute("role")||t.setAttribute("role","option"),t.hasAttribute("disabled")&&t.setAttribute("aria-disabled","true"),t.hasAttribute("selected")?this.DO(t):this.UO(t),t.tabIndex=0})),this.ct=e,this.HO(),this.jO()}jO(){const t=[],e=this.element.getAttribute("name");if(!e||this.element.hasAttribute("disabled"))return t;const s=this.element.getAttribute("form");this.bO.forEach((t=>{this.element.removeChild(t)})),this.bO=[];const i=this.win.document,n=i.createDocumentFragment();return this.Xx.forEach((r=>{if(!r.hasAttribute("disabled")){const o=i.createElement("input"),h=r.getAttribute("option");o.setAttribute("type","hidden"),o.setAttribute("name",e),o.setAttribute("value",h),s&&o.setAttribute("form",s),this.bO.push(o),n.appendChild(o),t.push(h)}})),this.element.appendChild(n),t}FO(t){t.hasAttribute("disabled")||this.mutateElement((()=>{t.hasAttribute("selected")?this.Zx&&(this.UO(t),this.jO()):(this.DO(t),this.jO()),this.HO(t),this.LO(t,3)}))}SO(){return this.Xx.map((t=>t.getAttribute("option")))}kO(t){if(this.element.hasAttribute("disabled"))return;let e=t.target;var s;e&&(e.hasAttribute("option")||("[option]",e=(s=e).closest?s.closest("[option]"):function(t,e,s){let i;for(i=t;i&&void 0!==i;i=i.parentElement)if(e(i))return i;return null}(s,(t=>function(t,e){const s=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector;return!!s&&s.call(t,"[option]")}(t)))),e&&this.FO(e))}Sx(t,e,i){const n=this.ct[t],r=n.hasAttribute("selected"),o=void 0!==e?e:!r,h=this.ct.indexOf(this.Xx[0]);return o===r?s():this.mutateElement((()=>{if(h!==t){this.DO(n);const t=this.ct[h];t&&this.UO(t)}else this.UO(n);this.LO(n,i)}))}LO(t,e){const s=function(t,e,s,i){const n={detail:s};return Object.assign(n,void 0),new t.CustomEvent("amp-selector.select",n)}(this.win,0,{"targetOption":t.getAttribute("option"),"selectedOptions":this.SO()});this.fc.trigger(this.element,"select",s,e)}VO(t,e){const s=this.ct.indexOf(this.Xx[0]),i=(n=-1===s&&t<0?t:s+t,r=this.ct.length,n>0&&r>0?n%r:(n%r+r)%r);var n,r;const o=this.ct[i];this.DO(o);const h=this.ct[s];h&&this.UO(h),this.jO(),this.LO(o,e)}yO(t){if(this.element.hasAttribute("disabled"))return s();const{key:e}=t;switch(e){case l:case c:case a:case u:case d:case p:return this.TO!=M?this.CO(t):s();case h:case" ":return this.$O(t),s()}return s()}CO(t){const e=this.win.document;let i=0;switch(t.key){case l:i=f(e)?1:-1;break;case c:case p:i=-1;break;case a:i=f(e)?-1:1;break;case u:case d:i=1;break;default:return s()}return t.preventDefault(),this.ct[this.gO].tabIndex=-1,this.zO().then((e=>{const s=this.gO;switch(t.key){case d:this.gO=this.ct.length-1;break;case p:this.gO=0}do{this.gO=(this.gO+i)%this.ct.length,this.gO<0&&(this.gO=this.gO+this.ct.length)}while(V(this.ct[this.gO],e[this.gO])&&this.gO!=s);const n=this.ct[this.gO];n.tabIndex=0,function(t){try{t.focus()}catch(t){}}(n);const r=this.ct[this.gO];this.TO==k&&this.FO(r)}))}$O(t){const{key:e}=t;if((" "==e||e==h)&&this.ct.includes(t.target)){t.preventDefault();const e=t.target;this.FO(e)}}UO(t){t.removeAttribute("selected"),t.setAttribute("aria-selected","false");const e=this.Xx.indexOf(t);-1!==e&&this.Xx.splice(e,1)}MO(){for(;this.Xx.length>0;){const t=this.Xx.pop();this.UO(t)}this.jO()}DO(t){this.Xx.includes(t)||(this.Zx||this.MO(),t.setAttribute("selected",""),t.setAttribute("aria-selected","true"),this.Xx.push(t))}getElementsForTesting(){return this.ct}getSelectedElementsForTesting(){return this.Xx}zO(){return this.measureElement((()=>this.ct.map((t=>t.getBoundingClientRect()))))}};function V(t,e){const{height:s,width:i}=e;return t.hidden||0==i||0==s}t.registerElement(I,y,"amp-selector [option]{cursor:pointer}amp-selector [option][selected]{cursor:auto;outline:1px solid rgba(0,0,0,0.7)}amp-selector[multiple] [option][selected]{cursor:pointer;outline:1px solid rgba(0,0,0,0.7)}amp-selector [disabled][option],amp-selector[disabled] [option],amp-selector[disabled] [selected],amp-selector [selected][disabled]{cursor:auto;outline:none}\n/*# sourceURL=/extensions/amp-selector/0.1/amp-selector.css*/")})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-selector-0.1.mjs.map