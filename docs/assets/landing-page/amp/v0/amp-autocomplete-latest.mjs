;
(self.AMP=self.AMP||[]).push({m:1,v:"2203281422000",n:"amp-autocomplete",ev:"0.1",l:!0,f:function(t,e){(()=>{var e,i,s,r=Object.create,n=Object.defineProperty,o=Object.getOwnPropertyDescriptor,h=Object.getOwnPropertyNames,u=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,l=(e={"third_party/fuzzysearch/index.js"(t,e){e.exports=function(t,e){var i=e.length,s=t.length;if(s>i)return!1;if(s===i&&t===e)return!0;t:for(var r=0,n=0;r<s;r++){for(var o=t.charCodeAt(r);n<i;)if(e.charCodeAt(n++)===o)continue t;return!1}return!0}}},function(){return i||(0,e[Object.keys(e)[0]])((i={exports:{}}).exports,i),i.exports});function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function p(){return s||(s=Promise.resolve(void 0))}function m(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function d(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function f(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?d(Object(i),!0).forEach((function(e){m(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):d(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var{isArray:_}=Array;function b(t,e,i){return"number"!=typeof i&&(i=0),!(i+e.length>t.length)&&-1!==t.indexOf(e,i)}var{hasOwnProperty:A,toString:g}=Object.prototype;function P(t){const e=Object.create(null);return t&&Object.assign(e,t),e}function v(t,e){return A.call(t,e)}function I(t,e){return v(t,e)?t[e]:void 0}function x(t,e){if("."==e)return t;let i=t;for(var s,r=function(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(i)return(i=i.call(t)).next.bind(i);if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return c(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?c(t,e):void 0}}(t))||t&&"number"==typeof t.length){i&&(t=i);var s=0;return function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(e.split("."));!(s=r()).done;){const t=s.value;if(!(t&&i&&void 0!==i[t]&&"object"==typeof i&&v(i,t))){i=void 0;break}i=i[t]}return i}function y(t,e,i,s,r,n,o,h,u,a,l){return t}function R(t,e){try{return function(t){return JSON.parse(t)}(t)}catch(t){return null==e||e(t),null}}function E(t){try{t.focus()}catch(t){}}function T(t,e){void 0===e&&(e=t.hasAttribute("hidden")),e?t.removeAttribute("hidden"):t.setAttribute("hidden","")}var w=self.AMP_CONFIG||{},M=("string"==typeof w.thirdPartyFrameRegex?new RegExp(w.thirdPartyFrameRegex):w.thirdPartyFrameRegex)||/^d-\d+\.ampproject\.net$/,O=("string"==typeof w.cdnProxyRegex?new RegExp(w.cdnProxyRegex):w.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function j(t){if(!self.document||!self.document.head)return null;if(self.location&&O.test(self.location.origin))return null;const e=self.document.head.querySelector(`meta[name="${t}"]`);return e&&e.getAttribute("content")||null}var V={thirdParty:w.thirdPartyUrl||"https://3p.ampproject.net",thirdPartyFrameHost:w.thirdPartyFrameHost||"ampproject.net",thirdPartyFrameRegex:M,cdn:w.cdnUrl||j("runtime-host")||"https://cdn.ampproject.org",cdnProxyRegex:O,localhostRegex:/^https?:\/\/localhost(:\d+)?$/,errorReporting:w.errorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r",betaErrorReporting:w.betaErrorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r-beta",localDev:w.localDev||!1,trustedViewerHosts:[/(^|\.)google\.(com?|[a-z]{2}|com?\.[a-z]{2}|cat)$/,/(^|\.)gmail\.(com|dev)$/],geoApi:w.geoApiUrl||j("amp-geo-api")},S=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function U(t,e=""){try{return decodeURIComponent(t)}catch(t){return e}}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var $=self.__AMP_LOG;function k(t){return $.user||($.user=F()),function(t,e){return e&&e.ownerDocument.defaultView!=t}($.user.win,t)?$.userForEmbed||($.userForEmbed=F()):$.user}function F(t){return function(t,e){throw new Error("failed to call initLogConstructor")}()}function C(t,e,i,s,r,n,o,h,u,a,l){return t}function z(t,e,i,s,r,n,o,h,u,a,l){return k().assert(t,e,i,s,r,n,o,h,u,a,l)}function D(t,e){return J(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),e)}function N(t,e){return J(q(L(t)),e)}function H(t,e){const i=q(L(t));return W(i,e)?J(i,e):null}function L(t){return t.nodeType?(e=t,i=(e.ownerDocument||e).defaultView,D(i,"ampdoc")).getAmpDoc(t):t;var e,i}function q(t){const e=L(t);return e.isSingleDoc()?e.win:e}function J(t,e){C(W(t,e));const i=function(t){let e=t.__AMP_SERVICES;return e||(e=t.__AMP_SERVICES={}),e}(t)[e];return i.obj||(C(i.ctor),C(i.context),i.obj=new i.ctor(i.context),C(i.obj),i.context=null,i.resolve&&i.resolve(i.obj)),i.obj}function W(t,e){const i=t.__AMP_SERVICES&&t.__AMP_SERVICES[e];return!(!i||!i.ctor)}function B(t,e,i,s){const r={detail:i};return Object.assign(r,s),new t.CustomEvent(e,r)}function G(t){return!!t&&"function"==typeof t.getFormData}var Z,K=new Set(["c","v","a","ad"]),Q="__amp_source_origin",X=t=>"string"==typeof t?Y(t):t;function Y(t,e){return Z||(Z=self.document.createElement("a")),function(t,e,i){return t.href="",new URL(e,t.href)}(Z,t)}function tt(t,e){return`${encodeURIComponent(t)}=${encodeURIComponent(e)}`}function et(t,e,i,s){return function(t,e,i){if(!e)return t;const s=t.split("#",2),r=s[0].split("?",2);let n=r[0]+(r[1]?i?`?${e}&${r[1]}`:`?${r[1]}&${e}`:`?${e}`);return n+=s[1]?`#${s[1]}`:"",n}(t,tt(e,i),s)}var it=["GET","POST"],st=[_,function(t){return"[object Object]"===g.call(t)}];function rt(t,e){const i=f({},e);if(G(e.body)){const t=e.body;i.headers["Content-Type"]="multipart/form-data;charset=utf-8",i.body=function(t){const e=[];for(let i=t.next();!i.done;i=t.next())e.push(i.value);return e}(t.entries())}return{input:t,init:i}}var nt,ot,ht=(nt=l(),((t,e,i)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of h(e))a.call(t,s)||"default"===s||n(t,s,{get:()=>e[s],enumerable:!(i=o(e,s))||i.enumerable});return t})((ot=n(null!=nt?r(u(nt)):{},"default",nt&&nt.__esModule&&"default"in nt?{get:()=>nt.default,enumerable:!0}:{value:nt,enumerable:!0}),n(ot,"__esModule",{value:!0})),nt)),ut={NONE:0,OPT_IN:1,ALL:2};function at(t,e,i,s){const r=(t=>H(t,"url-replace"))(t);return(i>=ut.OPT_IN?r.expandUrlAsync(e):Promise.resolve(e)).then((e=>{if(i===ut.OPT_IN){const e=r.collectDisallowedVarsSync(t);if(e.length>0)throw k().createError(`URL variable substitutions in CORS fetches from dynamic URLs (e.g. via amp-bind) require opt-in. Please add data-amp-replace="${e.join(" ")}" to the <${t.tagName}> element. See https://bit.ly/amp-var-subs.`)}const n={};return t.hasAttribute("credentials")&&(n.credentials=t.getAttribute("credentials")),s&&(n.cache="reload"),{"xhrUrl":e,"fetchOpt":n}}))}var lt="amp-autocomplete",ct="none",pt=class extends t.BaseElement{constructor(t){super(t),this.dn=null,this.Iq=null,this.Vq=null,this.Uq="",this.mI="",this.Fq=1,this.Cq=null,this.zq=!1,this.Dq=!1,this.Nq=!1,this.Hq="",this.Lq="",this.qq=-1,this.Jq=null,this.wC=t.id?t.id:Math.floor(100*Math.random()),this.cf=null,this.ML=!1,this.Wq=null,this.tg=null,this.Bq=!1,this.getSsrTemplateHelper=function(t){let e=!1,i=null,s=t;return(...t)=>(e||(i=s.apply(self,t),e=!0,s=null),i)}((()=>new class{constructor(t,e,i){this.Ue=e,this.tg=i,this.Dj=t}isEnabled(){const t=this.Ue.getAmpDoc();return!(!t.isSingleDoc()||!t.getRootNode().documentElement.hasAttribute("allow-viewer-render-template"))&&this.Ue.hasCapability("viewerRenderTemplate")}assertTrustedViewer(t){return this.Ue.isTrustedViewer().then((e=>{z(e,"Refused to attempt SSR in untrusted viewer: ",t)}))}ssr(t,e,i=null,s={}){let r;return i||(r=this.tg.maybeFindTemplate(t)),this.assertTrustedViewer(t).then((()=>this.Ue.sendMessageAwaitResponse("viewerRenderTemplate",this.Cj(e,r,i,s))))}applySsrOrCsrTemplate(t,e){let i;return this.isEnabled()?(z("string"==typeof e.html,"Skipping template rendering due to failed fetch"),i=this.assertTrustedViewer(t).then((()=>this.tg.findAndSetHtmlForTemplate(t,e.html)))):i=_(e)?this.tg.findAndRenderTemplateArray(t,e):this.tg.findAndRenderTemplate(t,e),i}Cj(t,e,i,s={}){const r={"type":this.Dj},n=i&&i.successTemplate?i.successTemplate:e;n&&(r.successTemplate={"type":"amp-mustache","payload":n.innerHTML});const o=i&&i.errorTemplate?i.errorTemplate:null;return o&&(r.errorTemplate={"type":"amp-mustache","payload":o.innerHTML}),s&&Object.assign(r,s),{"originalRequest":rt(t.xhrUrl,t.fetchOpt),"ampComponent":r}}}(lt,N(this.element,"viewer"),this.tg))),this.Gq=!1,this.fc=null,this.bn=null,this.Zq=!1,this.Kq=t.id?t.id:Math.floor(100*Math.random())+"_AMP_content_"}buildCallback(){this.tg=N(this.element,"templates"),this.fc=H(this.element,"action"),this.bn=(t=>N(t,"viewport"))(this.element),this.Vq=this.Qq();const t=this.Vq.getAttribute("type");z(!this.Vq.hasAttribute("type")||"text"===t||"search"===t,'%s requires the "type" attribute to be "text" or "search" if present on <input>. %s',lt,this.element),this.dn=this.Xq(),this.Lq=this.element.getAttribute("query"),this.Hq=this.element.getAttribute("src");const e=this.element.querySelector('script[type="application/json"]');e?this.Iq=this.Yq(e):this.element.hasAttribute("src"),this.Vq.setAttribute("dir","auto"),this.Vq.setAttribute("aria-autocomplete","both"),this.Vq.setAttribute("role","textbox"),this.Vq.setAttribute("aria-controls",this.Kq),"INPUT"===this.Vq.tagName&&(this.element.setAttribute("role","combobox"),this.Vq.setAttribute("aria-multiline","false")),this.element.setAttribute("aria-haspopup","listbox"),this.element.setAttribute("aria-expanded","false"),this.element.setAttribute("aria-owns",this.Kq);const i=this.tJ();var s;i&&i.hasAttribute("autocomplete")&&(this.Wq=i.getAttribute("autocomplete")),this.Gq=this.getSsrTemplateHelper().isEnabled(),this.Bq=this.tg.hasTemplate(this.element,"template, script[template]"),this.Gq&&(z(this.Hq,'%s requires data to be provided via "src" attribute for server-side rendering. %s',lt,this.element),z(this.Bq,`${lt} should provide a <template> or <script type="plain/text"> element.`),z(!this.element.hasAttribute("filter"),`${lt} does not support client-side filter when server-side render is required.`)),this.mI=this.element.getAttribute("filter")||ct,z("substring"===(s=this.mI)||"prefix"===s||"token-prefix"===s||"fuzzy"===s||"custom"===s||"none"===s,"Unexpected filter: %s. %s",this.mI,this.element),this.Fq=this.element.hasAttribute("min-characters")?parseInt(this.element.getAttribute("min-characters"),10):1,this.element.hasAttribute("max-entries");const r=this.element.getAttribute("max-items")||this.element.getAttribute("max-entries");return this.Cq=r?parseInt(r,10):null,this.zq=this.dn.shouldSuggestFirst(),this.Nq=this.element.hasAttribute("highlight-user-entry"),this.cf=this.YL(),this.element.appendChild(this.cf),this.eJ(),p()}eJ(){this.Vq.addEventListener("touchstart",(()=>{this.iJ()}),{passive:!0}),this.Vq.addEventListener("input",(()=>{this.sJ()})),this.Vq.addEventListener("keydown",(t=>{this.yO(t)})),this.Vq.addEventListener("focus",(()=>{this.iJ().then((()=>{const t=this.dn.shouldShowOnFocus();this.rJ(t)}))})),this.Vq.addEventListener("blur",(()=>{this.rJ(!1)})),this.cf.addEventListener("mousedown",(t=>{this.nJ(t)}))}Qq(){const t=this.element.querySelectorAll("input,textarea");return z(1==t.length,"%s should contain exactly one <input> or <textarea> descendant %s",lt,this.element),t[0]}tJ(){return this.Vq.form||null}Xq(){return this.element.hasAttribute("inline")?new class{constructor(t){const{element:e}=t;this.yf=e,this.Pe=this.yf.getAttribute("inline"),z(""!==this.Pe,'Empty value for the "inline" attr is unsupported, %s. %s',"amp-autocomplete",e),z(""!==this.Pe,"AutocompleteBindingInline does not support an empty value in the constructor."),this.oJ=null;const i=this.Pe.replace(/([()[{*+.$^\\|?])/g,"\\$1"),s=`((${i}|^${i})(\\w+)?)`;this.hJ=new RegExp(s,"gm")}shouldAutocomplete(t){const e=this.uJ(this.hJ,t);return this.oJ=e,!!e}uJ(t,e){if(!t)return null;const{selectionStart:i,value:s}=e;let r,n;for(;null!==(r=t.exec(s))&&!(r[0].length+I(r,"index")>i);)n=r;return!n||n[0].length+I(n,"index")<i?null:n}getUserInputForUpdate(t){return this.oJ&&this.oJ[0]?this.oJ[0].slice(this.Pe.length):""}getUserInputForUpdateWithSelection(t,e,i){if(!this.oJ)return e.value;let s=e.selectionStart;const r=Number(I(this.oJ,"index")),n=i.length;s>=r+n&&(s-=n),E(e),s=s+t.length+1,e.setSelectionRange(s,s),this.oJ=null;const{value:o}=e;return o.slice(0,r+this.Pe.length)+t+" "+o.slice(r+this.Pe.length+n)}resetInputOnWrapAround(t,e){}shouldSuggestFirst(){return this.yf.hasAttribute("suggest-first")}shouldShowOnFocus(){return!1}displayActiveItemInInput(t,e,i){}removeSelectionHighlighting(t){}shouldPreventDefaultOnEnter(t){return t}}(this):new class{constructor(t){const{element:e}=t;this.zq=e.hasAttribute("suggest-first");const i=e.getAttribute("filter");this.zq&&"prefix"!==i&&(this.zq=!1),this.aJ=e.hasAttribute("submit-on-enter")}shouldAutocomplete(t){return!0}getUserInputForUpdate(t){return t.value||""}getUserInputForUpdateWithSelection(t,e,i){return t}resetInputOnWrapAround(t,e){e.value=t}shouldSuggestFirst(){return this.zq}shouldShowOnFocus(){return!0}displayActiveItemInInput(t,e,i){t.value=e,this.zq&&t.setSelectionRange(i.length,e.length)}removeSelectionHighlighting(t){const e=t.value.length;t.setSelectionRange(e,e)}shouldPreventDefaultOnEnter(t){return!this.aJ}}(this)}Yq(t){const e=x(R(t.textContent,(t=>{throw t})),this.element.getAttribute("items")||"items");return e?k().assertArray(e):[]}lJ(){const t=this.getAmpDoc(),e=ut.ALL,i=this.element.getAttribute("items")||"items";return this.cJ(),this.Gq?at(this.element,this.element.getAttribute("src"),e,!1).then((t=>{var e,s,r;t.xhrUrl=(e=this.win,s=t.xhrUrl,r=t.fetchOpt,y("string"==typeof s),!1!==r.ampCors&&(s=function(t,e){!function(t){const e=function(t){const e=P();if(!t)return e;let i;for(;i=S.exec(t);){const t=U(i[1],i[1]),s=i[2]?U(i[2].replace(/\+/g," "),i[2]):"";e[t]=s}return e}(Y(t).search);z(!(Q in e),"Source origin is not allowed in %s",t)}(e);const i=function(t){return Y(function(t){if(!function(t){return V.cdnProxyRegex.test(X(t).origin)}(t=X(t)))return t.href;const e=t.pathname.split("/"),i=e[1];z(K.has(i),"Unknown path prefix in url %s",t.href);const s=e[2],r="s"==s?"https://"+decodeURIComponent(e[3]):"http://"+decodeURIComponent(s);return z(r.indexOf(".")>0,"Expected a . in origin %s",r),e.splice(1,"s"==s?3:2),r+e.join("/")+function(t,e){if(!t||"?"==t)return"";const i=new RegExp("[?&](amp_(js[^&=]*|gsa|r|kit)|usqp)\\b[^&]*","g"),s=t.replace(i,"").replace(/^[?&]/,"");return s?"?"+s:""}(t.search)+(t.hash||"")}(t)).origin}(t.location.href);return et(e,Q,i)}(e,s)),s),t.fetchOpt=function(t,e,i){i=i||{};const s=function(t){return t.origin||Y(t.location.href).origin}(t);return s==Y(e).origin&&(i.headers=i.headers||{},i.headers["AMP-Same-Origin"]="true"),i}(this.win,t.xhrUrl,t.fetchOpt),function(t){const e=function(t,e){const i=t||{},s=i.credentials;return y(void 0===s||"include"==s||"omit"==s),i.method=void 0===(r=i.method)?"GET":(r=r.toUpperCase(),y(it.includes(r)),r),i.headers=i.headers||{},i.headers.Accept=e,y(null!==i.body),i;var r}(t,"application/json");if("POST"==e.method&&!G(e.body)){y(st.some((t=>t(e.body)))),e.headers["Content-Type"]=e.headers["Content-Type"]||"text/plain;charset=utf-8";const t=e.headers["Content-Type"];e.body="application/x-www-form-urlencoded"===t?function(t){const e=[];for(const s in t){let r=t[s];if(null!=r){r=_(i=r)?i:[i];for(let t=0;t<r.length;t++)e.push(tt(s,r[t]))}}var i;return e.join("&")}(e.body):JSON.stringify(e.body)}}(t.fetchOpt);const n={"ampAutocompleteAttributes":{"items":i,"maxItems":this.Cq}};return this.getSsrTemplateHelper().ssr(this.element,t,null,n)})):function(t,e,i={}){const{expr:s=".",urlReplacement:r=ut.NONE,refresh:n=!1,xssiPrefix:o,url:h=e.getAttribute("src")}=i;!function(t,e,i="source"){var s;z(null!=t,"%s %s must be available",e,i),z("https:"==(s=X(s=t)).protocol||"localhost"==s.hostname||"127.0.0.1"==s.hostname||function(t,e){const i=t.length-e.length;return i>=0&&t.indexOf(e,i)==i}(s.hostname,".localhost")||/^\/\//.test(t),'%s %s must start with "https://" or "//" or be relative and served from either https or from localhost. Invalid value: %s',e,i,t)}(h,e);const u=D(t.win,"batched-xhr");return at(e,h,r,n).then((t=>u.fetchJson(t.xhrUrl,t.fetchOpt))).then((e=>(t=>D(t,"xhr"))(t.win).xssiJson(e,o))).then((t=>{if(null==t)throw new Error("Response is undefined.");return x(t,s||".")})).catch((t=>{throw k().createError("failed fetching JSON data",t)}))}(t,this.element,{expr:i,urlReplacement:e}).catch((()=>[]))}cJ(){if(!this.Lq)return;const t=this.pJ(this.Uq);this.element.setAttribute("src",t)}pJ(t=""){return et(this.Hq,this.Lq,t)}YL(){const t=this.element.ownerDocument.createElement("div");return t.classList.add("i-amphtml-autocomplete-results"),this.mJ()&&t.classList.add("i-amphtml-autocomplete-results-up"),t.setAttribute("role","listbox"),t.setAttribute("id",this.Kq),T(t,!1),t}layoutCallback(){return this.Vq.setAttribute("autocomplete","off"),this.element.hasAttribute("prefetch")&&this.iJ(),this.dJ(this.Iq,this.Uq)}mutatedAttributesCallback(t){const e=t.src;return null==e?p():"string"==typeof e?(this.Hq=e,this.lJ().then((t=>{this.Iq=t||[],this.dJ(this.Iq,this.Uq)}),(t=>{this.fJ(t)}))):"object"==typeof e?(this.Iq=e.items||[],this.dJ(this.Iq,this.Uq)):void k().error(lt,'Unexpected "src" type: '+e)}_J(t,e=""){const i=this.element.ownerDocument.createElement("div");i.classList.add("i-amphtml-autocomplete-item"),i.setAttribute("role","option"),i.setAttribute("data-value",t),i.setAttribute("dir","auto"),i.textContent=t;const s=i.childNodes[0],r=t.toLocaleLowerCase(),n=e.toLocaleLowerCase();if(this.Nq&&e&&e.length<=t.length&&b(r,n)){const o=r.indexOf(n),h=this.element.ownerDocument.createElement("span");h.classList.add("autocomplete-partial"),h.appendChild(this.element.ownerDocument.createTextNode(t.slice(o,o+e.length)));const u=s.splitText(o);u.splitText(e.length),i.replaceChild(h,u)}return i}sJ(){return this.dn.shouldAutocomplete(this.Vq)?this.bJ():this.mutateElement((()=>{this.AJ()}))}bJ(){const t=0===this.Uq.length&&1===this.Vq.value.length;return this.Uq=this.dn.getUserInputForUpdate(this.Vq),(this.Gq||this.Lq?this.lJ():Promise.resolve(this.Iq)).then((e=>(this.Iq=e,this.mutateElement((()=>{this.dJ(this.Iq,this.Uq).then((()=>{this.gJ(t)}))})))))}gJ(t){this.PJ(!0),this.zq&&(this.Dq&&!t||this.vJ(1),this.Dq=!1)}nJ(t){const e=t.target,i=this.IJ(e),{selectedObject:s,selectedText:r}=this.xJ(i);return this.mutateElement((()=>{this.yJ(r,s)}))}dJ(t,e=""){return this.AJ(),!t||e.length<this.Fq?p():this.Gq?v(t,"html")?this.RJ(t,this.cf,e):p():this.EJ(t,e)}EJ(t,e){if(!t.length)return p();const i=this.TJ(t,e).map((t=>{let e=t;return"object"==typeof t&&(e=f(f({},t),{},{objToJson:()=>JSON.stringify(t)})),e}));return this.RJ(i,this.cf,e)}RJ(t,e,i){let s=p();return this.wJ(),this.Bq?s=this.getSsrTemplateHelper().applySsrOrCsrTemplate(this.element,t).then((t=>{(_(t)?t:[t]).forEach((t=>{t.hasAttribute("data-disabled")?t.setAttribute("aria-disabled","true"):t.hasAttribute("data-value"),t.classList.add("i-amphtml-autocomplete-item"),t.setAttribute("role","option"),e.appendChild(t)}))})):t.forEach((t=>{z("string"==typeof t,"%s data must provide template for non-string items. %s",lt,this.element),e.appendChild(this._J(t,i))})),s}TJ(t,e){if(this.mI===ct)return this.MJ(t);e=e.toLocaleLowerCase();const i=this.element.getAttribute("filter-value")||"value",s=t.filter((t=>{switch("object"==typeof t&&(t=x(t,i)),z("string"==typeof t,'%s data property "%s" must map to string type. %s',lt,i,this.element),t=t.toLocaleLowerCase(),this.mI){case"substring":return b(t,e);case"prefix":return t.startsWith(e);case"token-prefix":return this.OJ(t,e);case"fuzzy":return(0,ht.default)(e,t);case"custom":throw new Error("Filter not yet supported: %s",this.mI,this.element);default:throw new Error("Unexpected filter: %s",this.mI,this.element)}}));return this.MJ(s)}OJ(t,e){if(""===e)return!0;const i=this.jJ(t),s=this.jJ(e),r=this.VJ(i),n=s[s.length-1];s.splice(s.length-1,1);let o=!0;for(let t=0;t<s.length;t++){const e=s[t];if(""===e)continue;if(!v(r,e)){o=!1;break}const i=Number(I(r,e));i>1?r[e]=i-1:delete r[e]}const h=Object.keys(r);return o&&(""===n||h.some((t=>t.startsWith(n))))}jJ(t){return(t=t.replace(/[\.]+/g,"")).split(/[`~(){}_|+\-;:\'",\[\]\\\/ ]+/g)}VJ(t){const e=P();return t.forEach((t=>{const i=v(e,t)?I(e,t)+1:1;e[t]=i})),e}MJ(t){return this.Cq&&this.Cq<t.length&&(t=t.slice(0,this.Cq)),t}PJ(t){this.Vq.setAttribute("aria-expanded",t),T(this.cf,t)}rJ(t){const e=this.tJ();e&&(t?e.setAttribute("autocomplete","off"):this.Wq?e.setAttribute("autocomplete",this.Wq):e.removeAttribute("autocomplete"));let i=!1;return this.measureMutateElement((()=>{i=this.mJ()}),(()=>{t||(this.Uq=this.Vq.value,this.dJ(this.Iq,this.Uq),this.wJ()),this.SJ(i),this.PJ(t)}))}iJ(){return this.Zq||!this.element.hasAttribute("src")?p():(this.Zq=!0,this.lJ().then((t=>{this.Iq=t,this.dJ(this.Iq)}),(t=>{this.fJ(t)})))}SJ(t){this.cf.classList.toggle("i-amphtml-autocomplete-results-up",t)}mJ(){const t=this.bn.getHeight()||0;return this.Vq.getBoundingClientRect().top>t/2}UJ(){return!this.cf.hasAttribute("hidden")&&this.cf.children.length>0}IJ(t){return null===t?null:t.classList.contains("i-amphtml-autocomplete-item")?t:this.IJ(t.parentElement)}xJ(t){if(null===t||t.hasAttribute("data-disabled"))return{selectedObject:null,selectedText:null};const e=this.$J(t);return this.kJ(e),{selectedObject:this.FJ(t),selectedText:e}}kJ(t){this.Vq.value=this.dn.getUserInputForUpdateWithSelection(t,this.Vq,this.Uq),this.Uq=this.dn.getUserInputForUpdate(this.Vq)}$J(t){return t.getAttribute("data-value")||t.textContent||""}FJ(t){return t.hasAttribute("data-json")?R(t.getAttribute("data-json"),(t=>{throw t})):null}yJ(t,e){null!==t&&(this.CJ(t,e),this.AJ(),this.PJ(!1))}CJ(t,e){const i=f({value:t},e&&{valueAsObject:e}),s=B(this.win,"amp-autocomplete.select",i);this.fc.trigger(this.element,"select",s,3);const r=B(this.win,"change",i,{bubbles:!0});this.Vq.dispatchEvent(r)}vJ(t){if(0===t||!this.UJ()||this.ML)return p();const e=-1===this.qq&&t<0?t:this.qq+t,i=this.zJ();if(0===i.length)return p();const s=(r=e,n=i.length,r>0&&n>0?r%n:(r%n+n)%n);var r,n;const o=i[s],h=o.getAttribute("data-value");let u,a;return this.dn.displayActiveItemInInput(this.Vq,h,this.Uq),this.measureMutateElement((()=>{const{offsetHeight:e,offsetTop:i}=o,{offsetHeight:s,scrollTop:r}=this.cf;u=r>i||r+s<i+e,a=t>0?i+e-s:i}),(()=>{u&&(this.cf.scrollTop=a),this.wJ(),o.classList.add("i-amphtml-autocomplete-item-active"),o.setAttribute("aria-selected","true");let t=o.getAttribute("id");t||(t=this.wC+"_AMP_content_"+s,o.setAttribute("id",t)),this.Vq.setAttribute("aria-activedescendant",t),this.qq=s,this.Jq=o,E(this.Jq)}))}zJ(){return this.cf.querySelectorAll(".i-amphtml-autocomplete-item:not([data-disabled])")}DJ(){this.dn.resetInputOnWrapAround(this.Uq,this.Vq),this.wJ()}wJ(){this.Jq&&(this.Jq.classList.toggle("i-amphtml-autocomplete-item-active",!1),this.Jq.removeAttribute("aria-selected"),"autocomplete-selected"===this.Jq.getAttribute("id")&&this.Jq.removeAttribute("id"),this.Vq.removeAttribute("aria-activedescendent"),this.Jq=null,this.qq=-1)}AJ(){this.ML=!1,function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}(this.cf)}yO(t){switch(t.key){case"ArrowDown":return t.preventDefault(),this.UJ()?this.qq===this.zJ().length-1?(this.DJ(),p()):this.vJ(1):this.mutateElement((()=>{this.dJ(this.Iq,this.Uq),this.PJ(!0)}));case"ArrowUp":return t.preventDefault(),0===this.qq?(this.DJ(),p()):this.vJ(-1);case"Enter":const e=this.dn.shouldPreventDefaultOnEnter(!!this.Jq);if(this.UJ()&&e&&t.preventDefault(),this.dn.removeSelectionHighlighting(this.Vq),this.UJ()&&this.Jq){const{selectedObject:t,selectedText:e}=this.xJ(this.Jq);return this.mutateElement((()=>{this.yJ(e,t),this.wJ()}))}return this.mutateElement((()=>{this.PJ(!1)}));case"Escape":return this.mutateElement((()=>{this.ML||(t.preventDefault(),this.DJ(),this.PJ(!1))}));case"Tab":if(this.UJ()&&this.Jq){t.preventDefault();const{selectedObject:e,selectedText:i}=this.xJ(this.Jq);return this.mutateElement((()=>{this.yJ(i,e)}))}return p();case"Backspace":return this.Dq=this.zq,p();default:return p()}}fJ(t){if(!this.ML){if(this.AJ(),!this.getFallback())throw t;this.ML=!0,this.toggleFallback(!0)}}isLayoutSupported(t){return"container"==t}};t.registerElement(lt,pt,"amp-autocomplete,amp-autocomplete>input,amp-autocomplete>textarea{font-family:sans-serif}amp-autocomplete>input,amp-autocomplete>textarea{border-radius:4px;box-sizing:border-box}.i-amphtml-autocomplete-results{position:absolute;top:100%;width:calc(100% + 1rem);min-width:calc(2em + 2rem);max-height:40vh;margin-top:.5rem;margin-left:-.5rem;border-radius:4px;overflow-y:auto;overflow-x:hidden;background-color:#fff;box-shadow:0px 2px 4px 0px rgba(0,0,0,.5);z-index:10}.i-amphtml-autocomplete-results-up{top:auto;bottom:100%;margin-bottom:.5rem}.i-amphtml-autocomplete-item{position:relative;padding:.5rem 1rem;cursor:pointer}.i-amphtml-autocomplete-item:first-child{border-radius:4px 4px 0px 0px}.i-amphtml-autocomplete-item:nth-last-child(2){border-radius:0px 0px 4px 4px}.i-amphtml-autocomplete-item-active:not([data-disabled]),.i-amphtml-autocomplete-item:hover:not([data-disabled]){background-color:rgba(0,0,0,.15)}.i-amphtml-autocomplete-item[data-disabled]{color:rgba(0,0,0,.33)}\n/*# sourceURL=/extensions/amp-autocomplete/0.1/amp-autocomplete.css*/")})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-autocomplete-0.1.mjs.map