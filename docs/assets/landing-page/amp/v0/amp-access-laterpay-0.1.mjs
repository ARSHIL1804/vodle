;
(self.AMP=self.AMP||[]).push({m:1,v:"2203281422000",n:"amp-access-laterpay",ev:"0.1",l:!1,f:function(t,e){(()=>{var{hasOwnProperty:e,toString:n}=Object.prototype;var s=self.AMP_CONFIG||{},i=("string"==typeof s.thirdPartyFrameRegex?new RegExp(s.thirdPartyFrameRegex):s.thirdPartyFrameRegex,("string"==typeof s.cdnProxyRegex?new RegExp(s.cdnProxyRegex):s.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/);function r(t){if(!self.document||!self.document.head)return null;if(self.location&&i.test(self.location.origin))return null;const e=self.document.head.querySelector(`meta[name="${t}"]`);return e&&e.getAttribute("content")||null}s.thirdPartyUrl,s.thirdPartyFrameHost,s.cdnUrl||r("runtime-host"),s.errorReportingUrl,s.betaErrorReportingUrl,s.localDev,s.geoApiUrl||r("amp-geo-api"),self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var a,c=self.__AMP_LOG;function o(t){return c.user||(c.user=l()),function(t,e){return e&&e.ownerDocument.defaultView!=t}(c.user.win,t)?c.userForEmbed||(c.userForEmbed=l()):c.user}function l(t){return function(t,e){throw new Error("failed to call initLogConstructor")}()}function u(t,e,n,s,i,r,a,c,o,l,u){return t}function h(t,e,n,s,i,r,a,c,l,u,h){return o().assert(t,e,n,s,i,r,a,c,l,u,h)}function p(){return a||(a=Promise.resolve(void 0))}function f(t,e){return b(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),e)}function d(t,e){return function(t,e){const n=P(t,e);if(n)return n;const s=g(t);return s[e]=function(){const t=new class{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}},{promise:e,reject:n,resolve:s}=t;return e.catch((()=>{})),{obj:null,promise:e,resolve:s,reject:n,context:null,ctor:null}}(),s[e].promise}(_(t),e)}function m(t,e){return P(_(t),e)}function y(t){return t.nodeType?(e=t,n=(e.ownerDocument||e).defaultView,f(n,"ampdoc")).getAmpDoc(t):t;var e,n}function _(t){const e=y(t);return e.isSingleDoc()?e.win:e}function b(t,e){u(function(t,e){const n=t.__AMP_SERVICES&&t.__AMP_SERVICES[e];return!(!n||!n.ctor)}(t,e));const n=g(t)[e];return n.obj||(u(n.ctor),u(n.context),n.obj=new n.ctor(n.context),u(n.obj),n.context=null,n.resolve&&n.resolve(n.obj)),n.obj}function P(t,e){const n=g(t)[e];return n?n.promise?n.promise:(b(t,e),n.promise=Promise.resolve(n.obj)):null}function g(t){let e=t.__AMP_SERVICES;return e||(e=t.__AMP_SERVICES={}),e}function x(t,e,n,s){return function(t,e,n,s){const i=m(t,e);if(i)return i;const r=y(t);return r.whenExtensionsKnown().then((()=>{const t=r.getExtensionVersion(n);return t?f(r.win,"extensions").waitForExtension(n,t):null})).then((n=>n?s?m(t,e):d(t,e):null))}(t,e,n,s).then((t=>function(t,e,n){return h(t,"Service %s was requested to be provided through %s, but %s is not loaded in the current page. To fix this problem load the JavaScript file for %s in this page.",e,n,n,n)}(t,e,n)))}var A,v=t=>function(t,e){return b(_(y(t)),e)}(t,"viewport");function w(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function R(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function E(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?R(Object(n),!0).forEach((function(e){w(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function I(t,e,n,s){return function(t,e,n,s){let i=t,r=n,a=t=>{try{return r(t)}catch(t){var e,n;throw null===(e=(n=self).__AMP_REPORT_ERROR)||void 0===e||e.call(n,t),t}};const c=function(){if(void 0!==A)return A;A=!1;try{const t={get capture(){return A=!0,!1}};self.addEventListener("test-options",null,t),self.removeEventListener("test-options",null,t)}catch(t){}return A}(),o=!(null==s||!s.capture);return i.addEventListener(e,a,c?s:o),()=>{null==i||i.removeEventListener(e,a,c?s:o),r=null,i=null,a=null}}(t,e,n,s)}function T(t,e,n){if(e[n])return e[n];const s=t.querySelector(`style[${n}], link[${n}]`);return s?(e[n]=s,s):null}function O(t,e){const n=t.styleSheets;for(let t=0;t<n.length;t++)if(n[t].ownerNode==e)return!0;return!1}var j="amp-access-laterpay",M={live:{eu:"https://connector.laterpay.net",us:"https://connector.uselaterpay.com"},sandbox:{eu:"https://connector.sandbox.laterpaytest.net",us:"https://connector.sandbox.uselaterpaytest.com"}},V={premiumContentTitle:"Buy only this article",payLaterButton:"Buy Now, Pay Later",payNowButton:"Buy Now",defaultButton:"Buy Now",alreadyPurchasedLink:"I already bought this",sandbox:"Site in test mode. No payment required."};t.registerServiceForDoc("laterpay",(function(t){return(t=>x(t,"access","amp-access"))(t.getHeadNode()).then((t=>{const e=t.getVendorSource("laterpay"),n=new class{constructor(t,e){this.ampdoc=t.ampdoc,this.tR=e,this.bn=v(this.ampdoc),this.cct=this.tR.getAdapterConfig(),this.lct=null,this.hct=null,this.pct=null,this.fct=[],this.dct=!0,this.mct=null,this.yct=null,this._ct=null,this.bct=this.cct.locale||"en",this.gct=E(E({},V),this.cct.localeMessages||{}),this.Pct=this.xct()+"/api/v1/public/amp?article_url=CANONICAL_URL&amp_reader_id=READER_ID&return_url=RETURN_URL";const n=this.cct.articleId;n&&(this.Pct+="&article_id="+encodeURIComponent(n)),this.Ee=b(this.ampdoc.win,"timer"),this.br=(t=>f(t,"vsync"))(this.ampdoc.win),this.eR=(t=>f(t,"xhr"))(this.ampdoc.win),function(t,e,n,s,i){const r=t.getHeadNode(),a=function(t,e,n,s){let i=t.__AMP_CSS_SM;i||(i=t.__AMP_CSS_SM=Object.create(null));const r=`amp-extension=${s}`;if(r){const n=T(t,i,r);if(n)return"STYLE"==n.tagName&&n.textContent!==e&&(n.textContent=e),n}const a=(t.ownerDocument||t).createElement("style");a.textContent=e;let c=null;return a.setAttribute("amp-extension",s),c=T(t,i,"amp-runtime"),function(t,e,n=null){if(!n)return void function(t,e){t.insertBefore(e,t.firstChild)}(t,e);const s=n.nextSibling;t.insertBefore(e,s)}(t,a,c),r&&(i[r]=a),a}(r,function(t,e){const n=t.__AMP_CSS_TR;return n?n(e):e}(r,".amp-access-laterpay{position:relative}@media (min-width:420px){.amp-access-laterpay{width:420px}}.amp-access-laterpay ul{width:100%;padding:0;margin:0 0 40px}.amp-access-laterpay li{list-style:none;display:-ms-flexbox;display:flex;margin-bottom:20px}.amp-access-laterpay label{display:-ms-flexbox;display:flex;padding-right:10px}.amp-access-laterpay input{width:20px}.amp-access-laterpay-container{padding:16px 24px 16px 16px;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-align:center;align-items:center;border-radius:12px;box-shadow:0 0 10px -1px rgba(0,0,0,.25)}.amp-access-laterpay-sandbox{width:112%;padding:15px 10px;background-color:#f2902a;color:#fff;font-weight:700;text-align:center}.amp-access-laterpay-badge{text-align:center;color:#999}.amp-access-laterpay-badge a{color:#8db444}.amp-access-laterpay-header{font-size:1.2em;margin-bottom:40px}.amp-access-laterpay-metadata{width:92%}.amp-access-laterpay-title{font-size:1.1em;margin:0;padding:0}.amp-access-laterpay-description{font-size:0.9em;margin:0;padding:0}.amp-access-laterpay-price-container{margin-top:0;margin-left:auto}.amp-access-laterpay-price{font-size:1.5em}.amp-access-laterpay-currency{font-size:0.7em}.amp-access-laterpay-purchase-button{font-size:1.1em;padding:0.5em 0.8em;background-color:#8db444;border-radius:4px;border:0;color:#fff;width:70%}.amp-access-laterpay-already-purchased-link-container{font-size:0.9em}\n/*# sourceURL=/extensions/amp-access-laterpay/0.1/amp-access-laterpay.css*/"),0,"amp-access-laterpay");if(n){const e=t.getRootNode();if(O(e,a))return a;const n=setInterval((()=>{O(e,a)&&clearInterval(n)}),4)}}(this.ampdoc,0,(()=>{}))}xct(){const t=this.cct.region||"eu";return this.cct.sandbox?M.sandbox[t]:M.live[t]}authorize(){return this.Act().then((t=>{if(204===t.status)throw o().createError("No merchant domains have been matched for this article, or no paid content configurations are setup.");return this.cct.scrollToTopAfterAuth&&this.br.mutate((()=>this.bn.setScrollTop(0))),this.vct(),{access:t.access}}),(t=>{if(!t||!t.response)throw t;const{response:e}=t;if(402!==e.status)throw t;return e.json().catch((()=>{})).then((t=>(this.lct=t,this.vct().then(this.Rct.bind(this)),{access:!1})))}))}Act(){const t=this.Pct+"&article_title="+encodeURIComponent(this.Ect());return this.tR.buildUrl(t,!1).then((t=>this.tR.getLoginUrl(t))).then((t=>this.Ee.timeoutPromise(3e3,this.eR.fetchJson(t,{credentials:"include"})).then((t=>t.json()))))}Ict(t){return this.ampdoc.win.document.createElement(t)}Ect(){const t=this.ampdoc.getRootNode().querySelector(this.cct.articleTitleSelector);return h(t,"No article title element found with selector %s",this.cct.articleTitleSelector),t.textContent.trim()}pR(){const t=j+"-dialog",e=this.ampdoc.getElementById(t);return o().assertElement(e,"No element found with id "+t)}vct(){if(this.dct)return p();let t;for(;t=this.fct.shift();)t();return this.hct&&(this.hct(),this.hct=null),this.pct&&(this.pct(),this.pct=null),this.br.mutatePromise((()=>{this.dct=!0,this.mct=null,function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}(this.pR())}))}Rct(){const t=this.pR();this.mct=this.Ict("div"),this.mct.className=j+"-container",this.cct.sandbox&&this.Tct("sandbox"),this.Tct("header");const e=this.Ict("ul");this.lct.premiumcontent.title=this.gct.premiumContentTitle,this.lct.premiumcontent.description=this.Ect(),e.appendChild(this.Oct(this.lct.premiumcontent)),this.lct.timepasses.forEach((t=>{e.appendChild(this.Oct(t))})),this.lct.subscriptions.forEach((t=>{e.appendChild(this.Oct(t))}));const n=this.Ict("button");n.className=j+"-purchase-button",n.textContent=this.gct.defaultButton,this._ct=n,this.hct=I(n,"click",(t=>{const{value:e}=this.yct,n=this.yct.dataset.purchaseType;this.jct(t,e,n)})),this.mct.appendChild(e),this.mct.appendChild(n),this.mct.appendChild(this.Mct(this.lct.apl)),this.Tct("footer"),t.appendChild(this.mct),t.appendChild(this.Vct()),this.dct=!1,this.Lct(e.firstElementChild)}Lct(t){const e=t.querySelector('input[type="radio"]');e.checked=!0,this.kct(e)}Tct(t){if(this.gct[t]){const e=this.Ict("p");e.className=j+"-"+t,e.textContent=this.gct[t],this.mct.appendChild(e)}}Vct(){const t=this.Ict("a");t.href="https://laterpay.net",t.target="_blank",t.textContent="LaterPay";const e=this.Ict("p");return e.className=j+"-badge",e.textContent="Powered by ",e.appendChild(t),e}Oct(t){const e=this.Ict("li"),n=this.Ict("label");n.for=t.title,n.appendChild(this.Cct(t));const s=this.Ict("div");s.className=j+"-metadata";const i=this.Ict("span");i.className=j+"-title",i.textContent=t.title,s.appendChild(i);const r=this.Ict("p");return r.className=j+"-description",r.textContent=t.description,s.appendChild(r),n.appendChild(s),e.appendChild(n),e.appendChild(this.Nct(t.price)),e}Cct(t){const e=this.Ict("input");e.name="purchaseOption",e.type="radio",e.id=t.title,e.value=t.purchase_url;const n="ppu"===t.purchase_type?"payLater":"payNow",s=this.gct[n+"Button"];return e.setAttribute("data-purchase-action-label",s),e.setAttribute("data-purchase-type",n),this.fct.push(I(e,"change",this.Bct.bind(this))),e}Nct(t){const e=Object.keys(t)[0],n=this.zct(t[e]),s=this.Ict("span");s.className=j+"-price",s.textContent=n;const i=this.Ict("sup");i.className=j+"-currency",i.textContent=e;const r=this.Ict("p");return r.className=j+"-price-container",r.appendChild(s),r.appendChild(i),r}zct(t){return(t/100).toLocaleString(this.bct,{style:"decimal",minimumFractionDigits:0})}Mct(t){const e=this.Ict("p");e.className=j+"-already-purchased-link-container";const n=this.Ict("a");return n.href=t,n.textContent=this.gct.alreadyPurchasedLink,this.pct=I(n,"click",(e=>{this.jct(e,t,"alreadyPurchased")})),e.appendChild(n),e}Bct(t){t.preventDefault(),this.kct(t.target)}kct(t){const e=j+"-selected",n=this.yct,s=t.dataset.purchaseActionLabel;n&&n.classList.contains(e)&&n.classList.remove(e),this.yct=t,this.yct.classList.add(e),this._ct.textContent=s}jct(t,e,n){return t.preventDefault(),this.tR.buildUrl(e,!1).then((t=>{this.tR.loginWithUrl(t,n)}))}pingback(){return p()}}(t,e);return e.getAdapter().registerVendor(n),n}))}))})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-access-laterpay-0.1.mjs.map